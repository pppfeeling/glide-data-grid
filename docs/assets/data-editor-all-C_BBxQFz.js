const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./image-window-loader-CvVz5YUq.js","./iframe-BCyg8ypy.js","./preload-helper-C1FmrZbK.js","./throttle-PvXwe8rS.js","./marked.esm-C2vt5mN_.js","./index-DkVHgzmp.js","./image-window-loader-Bm61kU6i.css"])))=>i.map(i=>d[i]);
import{r as l,R as me}from"./iframe-BCyg8ypy.js";import{_ as pi}from"./preload-helper-C1FmrZbK.js";import{r as Ci}from"./index-DkVHgzmp.js";import{G as B,d as jo,e as wi,f as Zo,r as yr,h as en,C as ne,g as Ir,j as yi,w as Ct,k as bi,l as xi,m as Ln,n as br,I as Ht,p as ki,o as Ri,t as xr,q as Mi,s as Xt,v as kr,x as Si,y as Jo,z as Ft,A as Ei,B as Ti,D as zi,E as Ii,F as Li,H as Rr,i as $t,J as Di,K as Hi,L as Mr,M as Fi,b as Dn,N as $i,O as Ai,T as Gi,P as Ki,Q as Pi,R as Sr,S as Ni,U as Wi}from"./image-window-loader-CvVz5YUq.js";import{m as At,r as Yt,g as Vi}from"./throttle-PvXwe8rS.js";import{u as Bi,f as Er}from"./flatten-DVhM32tQ.js";import{G as Ui}from"./scrolling-data-grid-Bf9EOU5a.js";import{s as tn}from"./marked.esm-C2vt5mN_.js";const re='<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg">',Oi=t=>{const r=t.fgColor,c=t.bgColor;return`
    ${re}<rect x="2" y="2" width="16" height="16" rx="2" fill="${c}"/><path d="M15.75 4h-1.5a.25.25 0 0 0-.177.074L9.308 8.838a3.75 3.75 0 1 0 1.854 1.854l1.155-1.157.967.322a.5.5 0 0 0 .65-.55l-.18-1.208.363-.363.727.331a.5.5 0 0 0 .69-.59l-.254-.904.647-.647A.25.25 0 0 0 16 5.75v-1.5a.25.25 0 0 0-.25-.25zM7.5 13.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0z" fill="${r}"/></svg>`},_i=t=>{const r=t.fgColor,c=t.bgColor;return`
    ${re}<rect x="2" y="2" width="16" height="16" rx="4" fill="${c}"/><path d="m12.223 13.314 3.052-2.826a.65.65 0 0 0 0-.984l-3.052-2.822c-.27-.25-.634-.242-.865.022-.232.263-.206.636.056.882l2.601 2.41-2.601 2.41c-.262.245-.288.619-.056.882.231.263.595.277.865.026Zm-4.444.005c.266.25.634.241.866-.027.231-.263.206-.636-.06-.882L5.983 10l2.602-2.405c.266-.25.291-.62.06-.887-.232-.263-.596-.272-.866-.022L4.723 9.51a.653.653 0 0 0 0 .983l3.056 2.827Z" fill="${r}"/></svg>`},Xi=t=>{const r=t.fgColor,c=t.bgColor;return`${re}
    <path d="M16.22 2H3.78C2.8 2 2 2.8 2 3.78v12.44C2 17.2 2.8 18 3.78 18h12.44c.98 0 1.77-.8 1.77-1.78L18 3.78C18 2.8 17.2 2 16.22 2z" fill="${c}"/>
    <path d="M6.52 12.78H5.51V8.74l-1.33.47v-.87l2.29-.83h.05v5.27zm5.2 0H8.15v-.69l1.7-1.83a6.38 6.38 0 0 0 .34-.4c.09-.11.16-.22.22-.32s.1-.19.12-.27a.9.9 0 0 0 0-.56.63.63 0 0 0-.15-.23.58.58 0 0 0-.22-.15.75.75 0 0 0-.29-.05c-.27 0-.48.08-.62.23a.95.95 0 0 0-.2.65H8.03c0-.24.04-.46.13-.67a1.67 1.67 0 0 1 .97-.91c.23-.1.49-.14.77-.14.26 0 .5.04.7.11.21.08.38.18.52.32.14.13.25.3.32.48a1.74 1.74 0 0 1 .03 1.13 2.05 2.05 0 0 1-.24.47 4.16 4.16 0 0 1-.35.47l-.47.5-1 1.05h2.32v.8zm1.8-3.08h.55c.28 0 .48-.06.61-.2a.76.76 0 0 0 .2-.55.8.8 0 0 0-.05-.28.56.56 0 0 0-.13-.22.6.6 0 0 0-.23-.15.93.93 0 0 0-.32-.05.92.92 0 0 0-.29.05.72.72 0 0 0-.23.12.57.57 0 0 0-.21.46H12.4a1.3 1.3 0 0 1 .5-1.04c.15-.13.33-.23.54-.3a2.48 2.48 0 0 1 1.4 0c.2.06.4.15.55.28.15.13.27.28.36.47.08.19.13.4.13.65a1.15 1.15 0 0 1-.2.65 1.36 1.36 0 0 1-.58.49c.15.05.28.12.38.2a1.14 1.14 0 0 1 .43.62c.03.13.05.26.05.4 0 .25-.05.47-.14.66a1.42 1.42 0 0 1-.4.49c-.16.13-.35.23-.58.3a2.51 2.51 0 0 1-.73.1c-.22 0-.44-.03-.65-.09a1.8 1.8 0 0 1-.57-.28 1.43 1.43 0 0 1-.4-.47 1.41 1.41 0 0 1-.15-.66h1a.66.66 0 0 0 .22.5.87.87 0 0 0 .58.2c.25 0 .45-.07.6-.2a.71.71 0 0 0 .21-.56.97.97 0 0 0-.06-.36.61.61 0 0 0-.18-.25.74.74 0 0 0-.28-.15 1.33 1.33 0 0 0-.37-.04h-.55V9.7z" fill="${r}"/>
  </svg>`},Yi=t=>{const r=t.fgColor,c=t.bgColor;return`${re}
  <path d="M16.222 2H3.778C2.8 2 2 2.8 2 3.778v12.444C2 17.2 2.8 18 3.778 18h12.444c.978 0 1.77-.8 1.77-1.778L18 3.778C18 2.8 17.2 2 16.222 2z" fill="${c}"/>
  <path d="M8.182 12.4h3.636l.655 1.6H14l-3.454-8H9.455L6 14h1.527l.655-1.6zM10 7.44l1.36 3.651H8.64L10 7.441z" fill="${r}"/>
</svg>`},qi=t=>{const r=t.fgColor,c=t.bgColor;return`${re}
    <path
        d="M16.2222 2H3.77778C2.8 2 2 2.8 2 3.77778V16.2222C2 17.2 2.8 18 3.77778 18H16.2222C17.2 18 17.9911 17.2 17.9911 16.2222L18 3.77778C18 2.8 17.2 2 16.2222 2Z"
        fill="${c}"
    />
    <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M7.66667 6.66669C5.73368 6.66669 4.16667 8.15907 4.16667 10C4.16667 11.841 5.73368 13.3334 7.66667 13.3334H12.3333C14.2663 13.3334 15.8333 11.841 15.8333 10C15.8333 8.15907 14.2663 6.66669 12.3333 6.66669H7.66667ZM12.5 12.5C13.8807 12.5 15 11.3807 15 10C15 8.61931 13.8807 7.50002 12.5 7.50002C11.1193 7.50002 10 8.61931 10 10C10 11.3807 11.1193 12.5 12.5 12.5Z"
        fill="${r}"
    />
</svg>`},Lr=t=>{const r=t.fgColor,c=t.bgColor;return`${re}
<path d="M16.222 2H3.778C2.8 2 2 2.8 2 3.778v12.444C2 17.2 2.8 18 3.778 18h12.444c.978 0 1.77-.8 1.77-1.778L18 3.778C18 2.8 17.2 2 16.222 2z" fill="${c}"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M10.29 4.947a3.368 3.368 0 014.723.04 3.375 3.375 0 01.041 4.729l-.009.009-1.596 1.597a3.367 3.367 0 01-5.081-.364.71.71 0 011.136-.85 1.95 1.95 0 002.942.21l1.591-1.593a1.954 1.954 0 00-.027-2.733 1.95 1.95 0 00-2.732-.027l-.91.907a.709.709 0 11-1.001-1.007l.915-.911.007-.007z" fill="${r}"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M6.55 8.678a3.368 3.368 0 015.082.364.71.71 0 01-1.136.85 1.95 1.95 0 00-2.942-.21l-1.591 1.593a1.954 1.954 0 00.027 2.733 1.95 1.95 0 002.73.028l.906-.906a.709.709 0 111.003 1.004l-.91.91-.008.01a3.368 3.368 0 01-4.724-.042 3.375 3.375 0 01-.041-4.728l.009-.009L6.55 8.678z" fill="${r}"/>
</svg>
  `},Zi=t=>{const r=t.bgColor;return`${re}
    <path stroke="${r}" stroke-width="2" d="M12 3v14"/>
    <path stroke="${r}" stroke-width="2" stroke-linecap="round" d="M10 4h4m-4 12h4"/>
    <path d="M11 14h4a3 3 0 0 0 3-3V9a3 3 0 0 0-3-3h-4v2h4a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-4v2ZM9.5 8H5a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h4.5v2H5a3 3 0 0 1-3-3V9a3 3 0 0 1 3-3h4.5v2Z" fill="${r}"/>
  </svg>
`},Ji=Lr,Qi=t=>{const r=t.fgColor,c=t.bgColor;return`${re}
  <path d="M16.222 2H3.778C2.8 2 2 2.8 2 3.778v12.444C2 17.2 2.8 18 3.778 18h12.444c.978 0 1.77-.8 1.77-1.778L18 3.778C18 2.8 17.2 2 16.222 2z" fill="${c}"/>
  <path fill-rule="evenodd" clip-rule="evenodd" d="M7 13.138a.5.5 0 00.748.434l5.492-3.138a.5.5 0 000-.868L7.748 6.427A.5.5 0 007 6.862v6.276z" fill="${r}"/>
</svg>`},ji=t=>{const r=t.fgColor,c=t.bgColor;return`
    ${re}
    <path d="M10 5a5 5 0 1 0 0 10 5 5 0 0 0 0-10zm0 9.17A4.17 4.17 0 0 1 5.83 10 4.17 4.17 0 0 1 10 5.83 4.17 4.17 0 0 1 14.17 10 4.17 4.17 0 0 1 10 14.17z" fill="${r}"/>
    <path d="M8.33 8.21a.83.83 0 1 0-.03 1.67.83.83 0 0 0 .03-1.67zm3.34 0a.83.83 0 1 0-.04 1.67.83.83 0 0 0 .04-1.67z" fill="${r}"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M14.53 13.9a2.82 2.82 0 0 1-5.06 0l.77-.38a1.97 1.97 0 0 0 3.52 0l.77.39z" fill="${r}"/>
    <path d="M16.22 2H3.78C2.8 2 2 2.8 2 3.78v12.44C2 17.2 2.8 18 3.78 18h12.44c.98 0 1.77-.8 1.77-1.78L18 3.78C18 2.8 17.2 2 16.22 2z" fill="${c}"/>
    <path d="M10 4a6 6 0 1 0 0 12 6 6 0 0 0 0-12zm0 11a5 5 0 1 1 .01-10.01A5 5 0 0 1 10 15z" fill="${r}"/>
    <path d="M8 7.86a1 1 0 1 0-.04 2 1 1 0 0 0 .04-2zm4 0a1 1 0 1 0-.04 2 1 1 0 0 0 .04-2z" fill="${r}"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M12.53 11.9a2.82 2.82 0 0 1-5.06 0l.77-.38a1.97 1.97 0 0 0 3.52 0l.77.39z" fill="${r}"/>
  </svg>`},es=t=>{const r=t.fgColor,c=t.bgColor;return`${re}
  <path d="M16.222 2H3.778C2.8 2 2 2.8 2 3.778v12.444C2 17.2 2.8 18 3.778 18h12.444c.978 0 1.77-.8 1.77-1.778L18 3.778C18 2.8 17.2 2 16.222 2z" fill="${c}"/>
  <path opacity=".5" fill-rule="evenodd" clip-rule="evenodd" d="M12.499 10.801a.5.5 0 01.835 0l2.698 4.098a.5.5 0 01-.418.775H10.22a.5.5 0 01-.417-.775l2.697-4.098z" fill="${r}"/>
  <path fill-rule="evenodd" clip-rule="evenodd" d="M8.07 8.934a.5.5 0 01.824 0l4.08 5.958a.5.5 0 01-.412.782h-8.16a.5.5 0 01-.413-.782l4.08-5.958zM13.75 8.333a2.083 2.083 0 100-4.166 2.083 2.083 0 000 4.166z" fill="${r}"/>
</svg>`},ts=t=>{const r=t.fgColor,c=t.bgColor;return`
    ${re}
    <path fill="${r}" d="M3 3h14v14H3z"/>
    <path d="M16.22 2H3.78C2.8 2 2 2.8 2 3.78v12.44C2 17.2 2.8 18 3.78 18h12.44c.98 0 1.77-.8 1.77-1.78L18 3.78C18 2.8 17.2 2 16.22 2zm-7.24 9.78h1.23c.15 0 .27.06.36.18l.98 1.28a.43.43 0 0 1-.05.58l-1.2 1.21a.45.45 0 0 1-.6.04A6.72 6.72 0 0 1 7.33 10c0-.61.1-1.2.25-1.78a6.68 6.68 0 0 1 2.12-3.3.44.44 0 0 1 .6.04l1.2 1.2c.16.17.18.42.05.59l-.98 1.29a.43.43 0 0 1-.36.17H8.98A5.38 5.38 0 0 0 8.67 10c0 .62.11 1.23.3 1.79z" fill="${c}"/>
  </svg>`},os=t=>{const r=t.fgColor,c=t.bgColor;return`
    ${re}
    <path d="M16.22 2H3.78C2.8 2 2 2.8 2 3.78v12.44C2 17.2 2.8 18 3.78 18h12.44c.98 0 1.77-.8 1.77-1.78L18 3.78C18 2.8 17.2 2 16.22 2z" fill="${c}"/>
    <path d="m13.49 13.15-2.32-3.27h1.4V7h1.86v2.88h1.4l-2.34 3.27zM11 13H9v-3l-1.5 1.92L6 10v3H4V7h2l1.5 2L9 7h2v6z" fill="${r}"/>
  </svg>`},ns=t=>{const r=t.fgColor,c=t.bgColor;return`${re}
  <path d="M16.222 2H3.778C2.8 2 2 2.8 2 3.778v12.444C2 17.2 2.8 18 3.778 18h12.444c.978 0 1.77-.8 1.77-1.778L18 3.778C18 2.8 17.2 2 16.222 2z" fill="${c}"/>
  <path d="M14.8 4.182h-.6V3H13v1.182H7V3H5.8v1.182h-.6c-.66 0-1.2.532-1.2 1.182v9.454C4 15.468 4.54 16 5.2 16h9.6c.66 0 1.2-.532 1.2-1.182V5.364c0-.65-.54-1.182-1.2-1.182zm0 10.636H5.2V7.136h9.6v7.682z" fill="${r}"/>
</svg>`},rs=t=>{const r=t.fgColor,c=t.bgColor;return`
    ${re}
    <path d="M16.22 2H3.78C2.8 2 2 2.8 2 3.78v12.44C2 17.2 2.8 18 3.78 18h12.44c.98 0 1.77-.8 1.77-1.78L18 3.78C18 2.8 17.2 2 16.22 2z" fill="${c}"/>
    <path d="M10 4a6 6 0 0 0-6 6 6 6 0 0 0 6 6 6 6 0 0 0 6-6 6 6 0 0 0-6-6zm0 10.8A4.8 4.8 0 0 1 5.2 10a4.8 4.8 0 1 1 4.8 4.8z" fill="${r}"/>
    <path d="M10 7H9v3.93L12.5 13l.5-.8-3-1.76V7z" fill="${r}"/>
  </svg>`},ls=t=>{const r=t.fgColor,c=t.bgColor;return`${re}
  <rect x="2" y="2" width="16" height="16" rx="2" fill="${c}"/>
  <path fill-rule="evenodd" clip-rule="evenodd" d="M10 8.643a1.357 1.357 0 100 2.714 1.357 1.357 0 000-2.714zM7.357 10a2.643 2.643 0 115.286 0 2.643 2.643 0 01-5.286 0z" fill="${r}"/>
  <path fill-rule="evenodd" clip-rule="evenodd" d="M7.589 4.898A5.643 5.643 0 0115.643 10v.5a2.143 2.143 0 01-4.286 0V8a.643.643 0 011.286 0v2.5a.857.857 0 001.714 0V10a4.357 4.357 0 10-1.708 3.46.643.643 0 01.782 1.02 5.643 5.643 0 11-5.842-9.582z" fill="${r}"/>
</svg>`},is=t=>{const r=t.fgColor,c=t.bgColor;return`
    ${re}
    <rect x="2" y="8" width="10" height="8" rx="2" fill="${c}"/>
    <rect x="8" y="4" width="10" height="8" rx="2" fill="${c}"/>
    <path d="M10.68 7.73V6l2.97 3.02-2.97 3.02v-1.77c-2.13 0-3.62.7-4.68 2.2.43-2.15 1.7-4.31 4.68-4.74z" fill="${r}"/>
  </svg>`},ss=t=>{const r=t.fgColor,c=t.bgColor;return`${re}
  <path fill="${r}" d="M4 3h12v14H4z"/>
  <path fill-rule="evenodd" clip-rule="evenodd" d="M3.6 2A1.6 1.6 0 002 3.6v12.8A1.6 1.6 0 003.6 18h12.8a1.6 1.6 0 001.6-1.6V3.6A1.6 1.6 0 0016.4 2H3.6zm11.3 10.8a.7.7 0 01.7.7v1.4a.7.7 0 01-.7.7h-1.4a.7.7 0 01-.7-.7v-1.4a.7.7 0 01.6-.693.117.117 0 00.1-.115V10.35a.117.117 0 00-.117-.116h-2.8a.117.117 0 00-.117.116v2.333c0 .064.053.117.117.117h.117a.7.7 0 01.7.7v1.4a.7.7 0 01-.7.7H9.3a.7.7 0 01-.7-.7v-1.4a.7.7 0 01.7-.7h.117a.117.117 0 00.117-.117V10.35a.117.117 0 00-.117-.117h-2.8a.117.117 0 00-.117.117v2.342c0 .058.042.106.1.115a.7.7 0 01.6.693v1.4a.7.7 0 01-.7.7H5.1a.7.7 0 01-.7-.7v-1.4a.7.7 0 01.7-.7h.35a.116.116 0 00.116-.117v-2.45c0-.515.418-.933.934-.933h2.917a.117.117 0 00.117-.117V6.85a.117.117 0 00-.117-.116h-2.45a.7.7 0 01-.7-.7V5.1a.7.7 0 01.7-.7h6.067a.7.7 0 01.7.7v.934a.7.7 0 01-.7.7h-2.45a.117.117 0 00-.118.116v2.333c0 .064.053.117.117.117H13.5c.516 0 .934.418.934.934v2.45c0 .063.052.116.116.116h.35z" fill="${c}"/>
</svg>`},cs=t=>{const r=t.fgColor,c=t.bgColor;return`
    ${re}
    <rect x="2" y="2" width="16" height="16" rx="2" fill="${c}"/>
    <path d="M9.98 13.33c.45 0 .74-.3.73-.75l-.01-.1-.16-1.67 1.45 1.05a.81.81 0 0 0 .5.18c.37 0 .72-.32.72-.76 0-.3-.17-.54-.49-.68l-1.63-.77 1.63-.77c.32-.14.49-.37.49-.67 0-.45-.34-.76-.71-.76a.81.81 0 0 0-.5.18l-1.47 1.03.16-1.74.01-.08c.01-.46-.27-.76-.72-.76-.46 0-.76.32-.75.76l.01.08.16 1.74-1.47-1.03a.77.77 0 0 0-.5-.18.74.74 0 0 0-.72.76c0 .3.17.53.49.67l1.63.77-1.62.77c-.32.14-.5.37-.5.68 0 .44.35.75.72.75a.78.78 0 0 0 .5-.17L9.4 10.8l-.16 1.68v.09c-.02.44.28.75.74.75z" fill="${r}"/>
  </svg>`},as=t=>{const r=t.fgColor,c=t.bgColor;return`
    ${re}
    <rect x="2" y="2" width="16" height="16" rx="2" fill="${c}"/>
    <path d="M8 5.83H5.83a.83.83 0 0 0 0 1.67h1.69A4.55 4.55 0 0 1 8 5.83zm-.33 3.34H5.83a.83.83 0 0 0 0 1.66h2.72a4.57 4.57 0 0 1-.88-1.66zM5.83 12.5a.83.83 0 0 0 0 1.67h7.5a.83.83 0 1 0 0-1.67h-7.5zm8.8-2.9a3.02 3.02 0 0 0 .46-1.6c0-1.66-1.32-3-2.94-3C10.52 5 9.2 6.34 9.2 8s1.31 3 2.93 3c.58 0 1.11-.17 1.56-.47l2.04 2.08.93-.94-2.04-2.08zm-2.48.07c-.9 0-1.63-.75-1.63-1.67s.73-1.67 1.63-1.67c.9 0 1.63.75 1.63 1.67s-.73 1.67-1.63 1.67z" fill="${r}"/>
  </svg>`},us=t=>{const r=t.fgColor,c=t.bgColor;return`${re}
  <rect x="2" y="2" width="16" height="16" rx="2" fill="${c}"/>
  <path d="M7.676 4.726V3l2.976 3.021-2.976 3.022v-1.77c-2.125 0-3.613.69-4.676 2.201.425-2.158 1.7-4.316 4.676-4.748zM10.182 14.4h3.636l.655 1.6H16l-3.454-8h-1.091L8 16h1.527l.655-1.6zM12 9.44l1.36 3.65h-2.72L12 9.44z" fill="${r}"/>
</svg>`},ds=t=>{const r=t.fgColor,c=t.bgColor;return`${re}
  <rect x="2" y="2" width="16" height="16" rx="2" fill="${c}"/>
  <path fill-rule="evenodd" clip-rule="evenodd" d="M4.167 5.417a.833.833 0 100 1.666h4.166a.833.833 0 100-1.666H4.167z" fill="${r}"/>
  <path fill-rule="evenodd" clip-rule="evenodd" d="M7.083 4.167a.833.833 0 10-1.666 0v4.166a.833.833 0 101.666 0V4.167zM11.667 5.417a.833.833 0 100 1.666h4.166a.833.833 0 100-1.666h-4.166zM5.367 11.688a.833.833 0 00-1.179 1.179l2.947 2.946a.833.833 0 001.178-1.178l-2.946-2.947z" fill="${r}"/>
  <path fill-rule="evenodd" clip-rule="evenodd" d="M8.313 12.867a.833.833 0 10-1.178-1.179l-2.947 2.947a.833.833 0 101.179 1.178l2.946-2.946z" fill="${r}"/>
  <path d="M10.833 12.5c0-.46.373-.833.834-.833h4.166a.833.833 0 110 1.666h-4.166a.833.833 0 01-.834-.833zM10.833 15c0-.46.373-.833.834-.833h4.166a.833.833 0 110 1.666h-4.166a.833.833 0 01-.834-.833z" fill="${r}"/>
</svg>`},fs=t=>{const r=t.fgColor,c=t.bgColor;return`
    ${re}
    <path d="M16.22 2H3.78C2.8 2 2 2.8 2 3.78v12.44C2 17.2 2.8 18 3.78 18h12.44c.98 0 1.77-.8 1.77-1.78L18 3.78C18 2.8 17.2 2 16.22 2z" fill="${c}"/>
    <path d="M10 8.84a1.16 1.16 0 1 0 0 2.32 1.16 1.16 0 0 0 0-2.32zm3.02 3.61a3.92 3.92 0 0 0 .78-3.28.49.49 0 1 0-.95.2c.19.87-.02 1.78-.58 2.47a2.92 2.92 0 1 1-4.13-4.08 2.94 2.94 0 0 1 2.43-.62.49.49 0 1 0 .17-.96 3.89 3.89 0 1 0 2.28 6.27zM10 4.17a5.84 5.84 0 0 0-5.44 7.93.49.49 0 1 0 .9-.35 4.86 4.86 0 1 1 2.5 2.67.49.49 0 1 0-.4.88c.76.35 1.6.54 2.44.53a5.83 5.83 0 0 0 0-11.66zm3.02 3.5a.7.7 0 1 0-1.4 0 .7.7 0 0 0 1.4 0zm-6.97 5.35a.7.7 0 1 1 0 1.4.7.7 0 0 1 0-1.4z" fill="${r}"/>
  </svg>`},hs=t=>{const r=t.fgColor,c=t.bgColor;return`${re}
  <rect x="2" y="2" width="16" height="16" rx="2" fill="${c}"/>
  <path d="M12.4 13.565c1.865-.545 3.645-2.083 3.645-4.396 0-1.514-.787-2.604-2.071-2.604C12.69 6.565 12 7.63 12 8.939c1.114.072 1.865.726 1.865 1.683 0 .933-.8 1.647-1.84 2.023l.375.92zM4 5h6v2H4zM4 9h5v2H4zM4 13h4v2H4z" fill="${r}"/>
</svg>`},gs=t=>{const r=t.fgColor,c=t.bgColor;return`
    ${re}
    <rect x="2" y="2" width="16" height="16" rx="2" fill="${c}"/>
    <path d="M12.4 13.56c1.86-.54 3.65-2.08 3.65-4.4 0-1.5-.8-2.6-2.08-2.6S12 7.64 12 8.95c1.11.07 1.86.73 1.86 1.68 0 .94-.8 1.65-1.83 2.03l.37.91zM4 5h6v2H4zm0 4h5v2H4zm0 4h4v2H4z" fill="${r}"/>
  </svg>`},ms=t=>{const r=t.fgColor,c=t.bgColor;return`${re}
  <path d="M16.222 2H3.778C2.8 2 2 2.8 2 3.778v12.444C2 17.2 2.8 18 3.778 18h12.444c.978 0 1.77-.8 1.77-1.778L18 3.778C18 2.8 17.2 2 16.222 2z" fill="${c}"/>
  <path d="M10 7a1 1 0 100-2v2zm0 6a1 1 0 100 2v-2zm0-8H7v2h3V5zm-3 6h5V9H7v2zm5 2h-2v2h2v-2zm1-1a1 1 0 01-1 1v2a3 3 0 003-3h-2zm-1-1a1 1 0 011 1h2a3 3 0 00-3-3v2zM4 8a3 3 0 003 3V9a1 1 0 01-1-1H4zm3-3a3 3 0 00-3 3h2a1 1 0 011-1V5z" fill="${r}"/>
  <path fill-rule="evenodd" clip-rule="evenodd" d="M4.856 12.014a.5.5 0 00-.712.702L5.409 14l-1.265 1.284a.5.5 0 00.712.702l1.255-1.274 1.255 1.274a.5.5 0 00.712-.702L6.813 14l1.265-1.284a.5.5 0 00-.712-.702L6.11 13.288l-1.255-1.274zM12.856 4.014a.5.5 0 00-.712.702L13.409 6l-1.265 1.284a.5.5 0 10.712.702l1.255-1.274 1.255 1.274a.5.5 0 10.712-.702L14.813 6l1.265-1.284a.5.5 0 00-.712-.702L14.11 5.288l-1.255-1.274z" fill="${r}"/>
</svg>`},vs=t=>{const r=t.fgColor,c=t.bgColor;return`${re}
  <rect x="2" y="2" width="16" height="16" rx="2" fill="${c}"/>
  <path fill-rule="evenodd" clip-rule="evenodd" d="M14.25 7.25a.75.75 0 000-1.5h-6.5a.75.75 0 100 1.5h6.5zM15 10a.75.75 0 01-.75.75h-6.5a.75.75 0 010-1.5h6.5A.75.75 0 0115 10zm-.75 4.25a.75.75 0 000-1.5h-6.5a.75.75 0 000 1.5h6.5zm-8.987-7a.75.75 0 100-1.5.75.75 0 000 1.5zm.75 2.75a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm-.75 4.25a.75.75 0 100-1.5.75.75 0 000 1.5z" fill="${r}"/>
</svg>`},ps=t=>{const r=t.fgColor;return`
    <svg width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M2 15v1h14v-2.5c0-.87-.44-1.55-.98-2.04a6.19 6.19 0 0 0-1.9-1.14 12.1 12.1 0 0 0-2.48-.67A4 4 0 1 0 5 6a4 4 0 0 0 2.36 3.65c-.82.13-1.7.36-2.48.67-.69.28-1.37.65-1.9 1.13A2.8 2.8 0 0 0 2 13.5V15z" fill="${t.bgColor}" stroke="${r}" stroke-width="2"/>
  </svg>`},Cs=t=>{const r=t.fgColor;return`
    <svg width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M12.43 6.04v-.18a3.86 3.86 0 0 0-7.72 0v.18A2.15 2.15 0 0 0 3 8.14v5.72C3 15.04 3.96 16 5.14 16H12c1.18 0 2.14-.96 2.14-2.14V8.14c0-1.03-.73-1.9-1.71-2.1zM7.86 6v-.14a.71.71 0 1 1 1.43 0V6H7.86z" fill="${t.bgColor}" stroke="${r}" stroke-width="2"/>
  </svg>
`},ws=t=>(t.fgColor,`
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="${t.bgColor}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" >
 <g transform="scale(0.833) translate(2, 2)">
    <path d="M8 18L12 22L16 18"/>
    <path d="M12 2V22"/>
  </g>
</svg>
  `),ys=t=>(t.fgColor,`
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="${t.bgColor}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" >
  <g transform="scale(0.833) translate(-4, 2)">
    <path d="M8 6L12 2L16 6"/>
    <path d="M12 2V22"/>
  </g>
</svg>
`),bs={headerRowID:Oi,headerNumber:Xi,headerCode:_i,headerString:Yi,headerBoolean:qi,headerAudioUri:Ji,headerVideoUri:Qi,headerEmoji:ji,headerImage:es,headerUri:Lr,headerPhone:ts,headerMarkdown:os,headerDate:ns,headerTime:rs,headerEmail:ls,headerReference:is,headerIfThenElse:ss,headerSingleValue:cs,headerLookup:as,headerTextTemplate:us,headerMath:ds,headerRollup:fs,headerJoinStrings:hs,headerSplitString:gs,headerGeoDistance:ms,headerArray:vs,rowOwnerOverlay:ps,protectedColumnOverlay:Cs,renameIcon:Zi,headerArrowDown:ws,headerArrowUp:ys},xs=tn("div")({name:"SearchWrapper",class:"slyseh9",propsAsIs:!1}),ks=l.createElement("svg",{className:"button-icon",viewBox:"0 0 512 512"},l.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"48",d:"M112 244l144-144 144 144M256 120v292"})),Rs=l.createElement("svg",{className:"button-icon",viewBox:"0 0 512 512"},l.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"48",d:"M112 268l144 144 144-144M256 392V100"})),Ms=l.createElement("svg",{className:"button-icon",viewBox:"0 0 512 512"},l.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M368 368L144 144M368 144L144 368"})),Ss=10,Es=t=>{const{canvasRef:r,cellYOffset:c,rows:g,columns:w,searchInputRef:k,searchValue:D,searchResults:b,onSearchValueChange:S,getCellsForSelection:H,onSearchResultsChanged:v,showSearch:y=!1,onSearchClose:E}=t,[W]=l.useState(()=>"search-box-"+Math.round(Math.random()*1e3)),[Y,U]=l.useState(""),de=D??Y,ve=l.useCallback(F=>{U(F),S==null||S(F)},[S]),[K,z]=l.useState(),Q=l.useRef(K);Q.current=K,l.useEffect(()=>{b!==void 0&&(b.length>0?z(F=>({rowsSearched:g,results:b.length,selectedIndex:(F==null?void 0:F.selectedIndex)??-1})):z(void 0))},[g,b]);const fe=l.useRef();fe.current===void 0&&(fe.current=new AbortController);const q=l.useRef(),[Z,te]=l.useState([]),se=b??Z,A=l.useCallback(()=>{q.current!==void 0&&(window.cancelAnimationFrame(q.current),q.current=void 0),fe.current!==void 0&&fe.current.abort(),fe.current=new AbortController},[]),Be=l.useRef(c);Be.current=c;const $e=l.useCallback(F=>{const le=new RegExp(F.replace(/([$()*+.?[\\\]^{|}-])/g,"\\$1"),"i");let we=Be.current,ye=Math.min(10,g),Je=0;z(void 0),te([]);const Se=[],Qe=async()=>{var Zt;if(H===void 0)return;const wt=performance.now(),yt=g-Je;let je=H({x:0,y:we,width:w.length,height:Math.min(ye,yt,g-we)},fe.current.signal);typeof je=="function"&&(je=await je());let vo=!1;for(const[it,st]of je.entries())for(const[xt,De]of st.entries()){let He;switch(De.kind){case B.Text:case B.Number:He=De.displayData;break;case B.Uri:case B.Markdown:He=De.data;break;case B.Boolean:He=typeof De.data=="boolean"?De.data.toString():void 0;break;case B.Image:case B.Bubble:He=De.data.join("üê≥");break;case B.Custom:He=De.copyData;break}He!==void 0&&le.test(He)&&(Se.push([xt,it+we]),vo=!0)}const on=performance.now();vo&&te([...Se]),Je+=je.length,jo(Je<=g);const po=((Zt=Q.current)==null?void 0:Zt.selectedIndex)??-1;z({results:Se.length,rowsSearched:Je,selectedIndex:po}),v==null||v(Se,po),we+ye>=g?we=0:we+=ye;const qt=on-wt,bt=Math.max(qt,1),nn=Ss/bt;ye=Math.ceil(ye*nn),Je<g&&Se.length<1e3&&(q.current=window.requestAnimationFrame(Qe))};A(),q.current=window.requestAnimationFrame(Qe)},[A,w.length,H,v,g]),Le=l.useCallback(()=>{var F;E==null||E(),z(void 0),te([]),v==null||v([],-1),A(),(F=r==null?void 0:r.current)==null||F.focus()},[A,r,E,v]),rt=l.useCallback(F=>{ve(F.target.value),b===void 0&&(F.target.value===""?(z(void 0),te([]),A()):$e(F.target.value))},[$e,A,ve,b]);l.useEffect(()=>{k.current!==null&&(ve(""),z(void 0),Z.length>0&&(te([]),v==null||v([],-1)),y?k.current.focus({preventScroll:!0}):A())},[y,k]);const Xe=l.useCallback(F=>{var we;if((we=F==null?void 0:F.stopPropagation)==null||we.call(F),K===void 0||K.results===0)return;const le=(K.selectedIndex+1)%K.results;z({...K,selectedIndex:le}),v==null||v(se,le)},[K,v,se]),Gt=l.useCallback(F=>{var we;if((we=F==null?void 0:F.stopPropagation)==null||we.call(F),K===void 0||K.results===0)return;let le=(K.selectedIndex-1)%K.results;le<0&&(le+=K.results),z({...K,selectedIndex:le}),v==null||v(se,le)},[v,se,K]),Ye=l.useCallback(F=>{(F.ctrlKey||F.metaKey)&&F.nativeEvent.code==="KeyF"||F.key==="Escape"?(Le(),F.stopPropagation(),F.preventDefault()):F.key==="Enter"&&(F.shiftKey?Gt():Xe())},[Le,Xe,Gt]);l.useEffect(()=>()=>{A()},[A]);const[lt,go]=l.useState(!1);l.useEffect(()=>{if(y)go(!0);else{const F=setTimeout(()=>go(!1),150);return()=>clearTimeout(F)}},[y]);const mo=l.useMemo(()=>{if(!y&&!lt)return null;let F;K!==void 0&&(F=K.results>=1e3?"over 1000":`${K.results} result${K.results!==1?"s":""}`,K.selectedIndex>=0&&(F=`${K.selectedIndex+1} of ${F}`));const le=Je=>{Je.stopPropagation()},ye={width:`${g>0?Math.floor(((K==null?void 0:K.rowsSearched)??0)/g*100):0}%`};return l.createElement(xs,{className:"gdg-search-bar"+(y?"":" out"),onMouseDown:le,onMouseMove:le,onMouseUp:le,onClick:le},l.createElement("div",{className:"gdg-search-bar-inner"},l.createElement("input",{id:W,"aria-hidden":!y,"data-testid":"search-input",ref:k,onChange:rt,value:de,tabIndex:y?void 0:-1,onKeyDownCapture:Ye}),l.createElement("button",{type:"button","aria-label":"Previous Result","aria-hidden":!y,tabIndex:y?void 0:-1,onClick:Gt,disabled:((K==null?void 0:K.results)??0)===0},ks),l.createElement("button",{type:"button","aria-label":"Next Result","aria-hidden":!y,tabIndex:y?void 0:-1,onClick:Xe,disabled:((K==null?void 0:K.results)??0)===0},Rs),E!==void 0&&l.createElement("button",{type:"button","aria-label":"Close Search","aria-hidden":!y,"data-testid":"search-close-button",tabIndex:y?void 0:-1,onClick:Le},Ms)),K!==void 0?l.createElement(l.Fragment,null,l.createElement("div",{className:"gdg-search-status"},l.createElement("div",{"data-testid":"search-result-area"},F)),l.createElement("div",{className:"gdg-search-progress",style:ye})):l.createElement("div",{className:"gdg-search-status"},l.createElement("label",{htmlFor:W},"Type to search")))},[y,lt,K,g,W,k,rt,de,Ye,Gt,Xe,E,Le]);return l.createElement(l.Fragment,null,l.createElement(Ui,{prelightCells:se,accessibilityHeight:t.accessibilityHeight,canvasRef:t.canvasRef,cellXOffset:t.cellXOffset,cellYOffset:t.cellYOffset,className:t.className,clientSize:t.clientSize,columns:t.columns,disabledRows:t.disabledRows,enableGroups:t.enableGroups,groupLevels:t.groupLevels,groupHeaderHeights:t.groupHeaderHeights,fillHandle:t.fillHandle,firstColAccessible:t.firstColAccessible,nonGrowWidth:t.nonGrowWidth,fixedShadowX:t.fixedShadowX,fixedShadowY:t.fixedShadowY,freezeColumns:t.freezeColumns,getCellContent:t.getCellContent,getCellRenderer:t.getCellRenderer,getGroupDetails:t.getGroupDetails,getRowThemeOverride:t.getRowThemeOverride,groupHeaderHeight:t.groupHeaderHeight,headerHeight:t.headerHeight,highlightRegions:t.highlightRegions,imageWindowLoader:t.imageWindowLoader,initialSize:t.initialSize,isFilling:t.isFilling,isFocused:t.isFocused,lockColumns:t.lockColumns,maxColumnWidth:t.maxColumnWidth,minColumnWidth:t.minColumnWidth,onHeaderMenuClick:t.onHeaderMenuClick,onHeaderIndicatorClick:t.onHeaderIndicatorClick,onMouseMove:t.onMouseMove,onVisibleRegionChanged:t.onVisibleRegionChanged,overscrollX:t.overscrollX,overscrollY:t.overscrollY,preventDiagonalScrolling:t.preventDiagonalScrolling,rightElement:t.rightElement,rightElementProps:t.rightElementProps,rowHeight:t.rowHeight,rows:t.rows,scrollRef:t.scrollRef,selection:t.selection,theme:t.theme,freezeTrailingRows:t.freezeTrailingRows,hasAppendRow:t.hasAppendRow,translateX:t.translateX,translateY:t.translateY,verticalBorder:t.verticalBorder,onColumnProposeMove:t.onColumnProposeMove,drawFocusRing:t.drawFocusRing,drawCell:t.drawCell,drawHeader:t.drawHeader,experimental:t.experimental,gridRef:t.gridRef,headerIcons:t.headerIcons,isDraggable:t.isDraggable,onCanvasBlur:t.onCanvasBlur,onCanvasFocused:t.onCanvasFocused,onCellFocused:t.onCellFocused,onColumnMoved:t.onColumnMoved,onColumnResize:t.onColumnResize,onColumnResizeEnd:t.onColumnResizeEnd,onColumnResizeStart:t.onColumnResizeStart,onContextMenu:t.onContextMenu,onDragEnd:t.onDragEnd,onDragLeave:t.onDragLeave,onDragOverCell:t.onDragOverCell,onDragStart:t.onDragStart,onDrop:t.onDrop,onItemHovered:t.onItemHovered,onKeyDown:t.onKeyDown,onKeyUp:t.onKeyUp,onMouseDown:t.onMouseDown,onMouseUp:t.onMouseUp,onRowMoved:t.onRowMoved,smoothScrollX:t.smoothScrollX,smoothScrollY:t.smoothScrollY,resizeIndicator:t.resizeIndicator}),mo)},Ts=()=>t=>Math.max(16,t.targetHeight-10),zs=tn("input")({name:"RenameInput",class:"r1fzhvm4",propsAsIs:!1,vars:{"r1fzhvm4-0":[Ts(),"px"]}}),Is=t=>{const{bounds:r,group:c,onClose:g,canvasBounds:w,onFinish:k}=t,[D,b]=me.useState(c);return me.createElement(wi,{style:{position:"absolute",left:r.x-w.left+1,top:r.y-w.top,width:r.width-2,height:r.height},className:"c181oggi",onClickOutside:g},me.createElement(zs,{targetHeight:r.height,"data-testid":"group-rename-input",value:D,onBlur:g,onFocus:S=>S.target.setSelectionRange(0,D.length),onChange:S=>b(S.target.value),onKeyDown:S=>{S.key==="Enter"?k(D):S.key==="Escape"&&g()},autoFocus:!0}))},Fn=150;function Ls(t,r,c,g){var k;const w=g(r);return((k=w==null?void 0:w.measure)==null?void 0:k.call(w,t,r,c))??Fn}function Dr(t,r,c,g,w,k,D,b,S){let H=0;const v=w===void 0?[]:w.map(W=>{const Y=Ls(t,W[g],r,S);return H=Math.max(H,Y),Y});if(v.length>5&&b){H=0;let W=0;for(const U of v)W+=U;const Y=W/v.length;for(let U=0;U<v.length;U++)v[U]>=Y*2?v[U]=0:H=Math.max(H,v[U])}const y=t.font;t.font=r.headerFontFull,H=Math.max(H,t.measureText(c.title).width+r.cellHorizontalPadding*2+(c.icon===void 0?0:28)),t.font=y;const E=Math.max(Math.ceil(k),Math.min(Math.floor(D),Math.ceil(H)));return{...c,width:E}}function Ds(t,r,c,g,w,k,D,b,S){const H=l.useRef(r),v=l.useRef(c),y=l.useRef(D);H.current=r,v.current=c,y.current=D;const[E,W]=l.useMemo(()=>{if(typeof window>"u")return[null,null];const K=document.createElement("canvas");return K.style.display="none",K.style.opacity="0",K.style.position="fixed",[K,K.getContext("2d",{alpha:!1})]},[]);l.useLayoutEffect(()=>(E&&document.documentElement.append(E),()=>{E==null||E.remove()}),[E]);const Y=l.useRef({}),U=l.useRef(),[de,ve]=l.useState();return l.useLayoutEffect(()=>{const K=v.current;if(K===void 0||t.every(Zo))return;let z=Math.max(1,10-Math.floor(t.length/1e4)),Q=0;z<H.current&&z>1&&(z--,Q=1);const fe={x:0,y:0,width:t.length,height:Math.min(H.current,z)},q={x:0,y:H.current-1,width:t.length,height:1};(async()=>{const te=K(fe,S.signal),se=Q>0?K(q,S.signal):void 0;let A;typeof te=="object"?A=te:A=await yr(te),se!==void 0&&(typeof se=="object"?A=[...A,...se]:A=[...A,...await yr(se)]),U.current=t,ve(A)})()},[S.signal,t]),l.useMemo(()=>{let z=t.every(Zo)?t:W===null?t.map(Z=>Zo(Z)?Z:{...Z,width:Fn}):(W.font=y.current.baseFontFull,t.map((Z,te)=>{if(Zo(Z))return Z;if(Y.current[Z.id]!==void 0)return{...Z,width:Y.current[Z.id]};if(de===void 0||U.current!==t||Z.id===void 0)return{...Z,width:Fn};const se=Dr(W,D,Z,te,de,w,k,!0,b);return Y.current[Z.id]=se.width,se})),Q=0,fe=0;const q=[];for(const[Z,te]of z.entries())Q+=te.width,te.grow!==void 0&&te.grow>0&&(fe+=te.grow,q.push(Z));if(Q<g&&q.length>0){const Z=[...z],te=g-Q;let se=te;for(let A=0;A<q.length;A++){const Be=q[A],$e=(z[Be].grow??0)/fe,Le=A===q.length-1?se:Math.min(se,Math.floor(te*$e));Z[Be]={...z[Be],growOffset:Le,width:z[Be].width+Le},se-=Le}z=Z}return{sizedColumns:z,nonGrowWidth:Q}},[g,t,W,de,D,w,k,b])}function Hs(t,r){return t===void 0?!1:t.length>1&&t.startsWith("_")?Number.parseInt(t.slice(1))===r.keyCode:t.length===1&&t>="a"&&t<="z"?t.toUpperCase().codePointAt(0)===r.keyCode:t===r.key}function O(t,r,c){const g=Hr(t,r);return g&&(c.didMatch=!0),g}function Hr(t,r){if(t.length===0)return!1;if(t.includes("|")){const S=t.split("|");for(const H of S)if(Hr(H,r))return!0;return!1}let c=!1,g=!1,w=!1,k=!1;const D=t.split("+"),b=D.pop();if(!Hs(b,r))return!1;if(D[0]==="any")return!0;for(const S of D)switch(S){case"ctrl":c=!0;break;case"shift":g=!0;break;case"alt":w=!0;break;case"meta":k=!0;break;case"primary":en.value?k=!0:c=!0;break}return r.altKey===w&&r.ctrlKey===c&&r.shiftKey===g&&r.metaKey===k}function Fs(t,r,c,g,w,k,D){const b=me.useCallback((v,y,E,W)=>{var z;(k==="cell"||k==="multi-cell")&&v!==void 0&&(v={...v,range:{x:v.cell[0],y:v.cell[1],width:1,height:1}}),!D&&v!==void 0&&v.range.width>1&&(v={...v,range:{...v.range,width:1,x:v.cell[0]}});const Y=c==="mixed"&&(E||W==="drag")||c==="additive",U=(g==="mixed"||g==="additive")&&Y,de=E||(w==="mixed"||w==="additive")&&Y;let ve={current:v===void 0?void 0:{...v,rangeStack:W==="drag"?((z=t.current)==null?void 0:z.rangeStack)??[]:[]},columns:U?t.columns:ne.empty(),rows:de?t.rows:ne.empty()};E&&(k==="multi-rect"||k==="multi-cell")&&ve.current!==void 0&&t.current!==void 0&&(ve={...ve,current:{...ve.current,rangeStack:[...t.current.rangeStack,t.current.range]}}),r(ve,y)},[g,t,c,k,D,w,r]),S=me.useCallback((v,y,E)=>{v=v??t.rows,y!==void 0&&(v=v.add(y));let W;if(w==="exclusive"&&v.length>0)W={current:void 0,columns:ne.empty(),rows:v};else{const Y=E&&c==="mixed"||c==="additive",U=E&&g==="mixed"||g==="additive";W={current:Y?t.current:void 0,columns:U?t.columns:ne.empty(),rows:v}}r(W,!1)},[g,t,c,w,r]),H=me.useCallback((v,y,E)=>{v=v??t.columns,y!==void 0&&(v=v.add(y));let W;if(g==="exclusive"&&v.length>0)W={current:void 0,rows:ne.empty(),columns:v};else{const Y=E&&c==="mixed"||c==="additive",U=E&&w==="mixed"||w==="additive";W={current:Y?t.current:void 0,rows:U?t.rows:ne.empty(),columns:v}}r(W,!1)},[g,t,c,w,r]);return[b,S,H]}function $s(t,r,c,g,w){const k=l.useCallback(H=>{if(t===!0){const v=[];for(let y=H.y;y<H.y+H.height;y++){const E=[];for(let W=H.x;W<H.x+H.width;W++)W<0||y>=w?E.push({kind:B.Loading,allowOverlay:!1}):E.push(r([W,y]));v.push(E)}return v}return(t==null?void 0:t(H,g.signal))??[]},[g.signal,r,t,w]),D=t!==void 0?k:void 0,b=l.useCallback(H=>{if(D===void 0)return[];const v={...H,x:H.x-c};if(v.x<0){v.x=0,v.width--;const y=D(v,g.signal);return typeof y=="function"?async()=>(await y()).map(E=>[{kind:B.Loading,allowOverlay:!1},...E]):y.map(E=>[{kind:B.Loading,allowOverlay:!1},...E])}return D(v,g.signal)},[g.signal,D,c]);return[t!==void 0?b:void 0,D]}function Tr(t){return typeof t=="string"?t:`${t}px`}const As=()=>t=>t.innerWidth,Gs=()=>t=>t.innerHeight,Ks=tn("div")({name:"Wrapper",class:"w2q57ts",propsAsIs:!1,vars:{"w2q57ts-0":[As()],"w2q57ts-1":[Gs()]}}),Ps=t=>{const{inWidth:r,inHeight:c,children:g,...w}=t;return l.createElement(Ks,{innerHeight:Tr(c),innerWidth:Tr(r),...w},g)},Ns=2,Ws=1300;function Vs(t,r,c){const g=me.useRef(0),[w,k]=t??[0,0];me.useEffect(()=>{if(w===0&&k===0){g.current=0;return}let D=!1,b=0;const S=H=>{var v;if(!D){if(b===0)b=H;else{const y=H-b;g.current=Math.min(1,g.current+y/Ws);const E=g.current**1.618*y*Ns;(v=r.current)==null||v.scrollBy(w*E,k*E),b=H,c==null||c()}window.requestAnimationFrame(S)}};return window.requestAnimationFrame(S),()=>{D=!0}},[r,w,k,c])}function Bs({rowHeight:t,headerHeight:r,groupHeaderHeight:c,theme:g,overscrollX:w,overscrollY:k,scaleToRem:D,remSize:b}){const[S,H,v,y,E,W]=me.useMemo(()=>{if(!D||b===16)return[t,r,c,g,w,k];const Y=b/16,U=t,de=Ir();return[typeof U=="number"?U*Y:ve=>Math.ceil(U(ve)*Y),Math.ceil(r*Y),Math.ceil(c*Y),{...g,headerIconSize:((g==null?void 0:g.headerIconSize)??de.headerIconSize)*Y,cellHorizontalPadding:((g==null?void 0:g.cellHorizontalPadding)??de.cellHorizontalPadding)*Y,cellVerticalPadding:((g==null?void 0:g.cellVerticalPadding)??de.cellVerticalPadding)*Y},Math.ceil((w??0)*Y),Math.ceil((k??0)*Y)]},[c,r,w,k,b,t,D,g]);return{rowHeight:S,headerHeight:H,groupHeaderHeight:v,theme:y,overscrollX:E,overscrollY:W}}const vt={downFill:!1,rightFill:!1,clear:!0,closeOverlay:!0,acceptOverlayDown:!0,acceptOverlayUp:!0,acceptOverlayLeft:!0,acceptOverlayRight:!0,copy:!0,paste:!0,cut:!0,search:!1,delete:!0,activateCell:!0,scrollToSelectedCell:!0,goToFirstCell:!0,goToFirstColumn:!0,goToFirstRow:!0,goToLastCell:!0,goToLastColumn:!0,goToLastRow:!0,goToNextPage:!0,goToPreviousPage:!0,selectToFirstCell:!0,selectToFirstColumn:!0,selectToFirstRow:!0,selectToLastCell:!0,selectToLastColumn:!0,selectToLastRow:!0,selectAll:!0,selectRow:!0,selectColumn:!0,goUpCell:!0,goRightCell:!0,goDownCell:!0,goLeftCell:!0,goUpCellRetainSelection:!0,goRightCellRetainSelection:!0,goDownCellRetainSelection:!0,goLeftCellRetainSelection:!0,selectGrowUp:!0,selectGrowRight:!0,selectGrowDown:!0,selectGrowLeft:!0};function _(t,r){return t===!0?r:t===!1?"":t}function zr(t){const r=en.value;return{activateCell:_(t.activateCell," |Enter|shift+Enter"),clear:_(t.clear,"any+Escape"),closeOverlay:_(t.closeOverlay,"any+Escape"),acceptOverlayDown:_(t.acceptOverlayDown,"Enter"),acceptOverlayUp:_(t.acceptOverlayUp,"shift+Enter"),acceptOverlayLeft:_(t.acceptOverlayLeft,"shift+Tab"),acceptOverlayRight:_(t.acceptOverlayRight,"Tab"),copy:t.copy,cut:t.cut,delete:_(t.delete,r?"Backspace|Delete":"Delete"),downFill:_(t.downFill,"primary+_68"),scrollToSelectedCell:_(t.scrollToSelectedCell,"primary+Enter"),goDownCell:_(t.goDownCell,"ArrowDown"),goDownCellRetainSelection:_(t.goDownCellRetainSelection,"alt+ArrowDown"),goLeftCell:_(t.goLeftCell,"ArrowLeft|shift+Tab"),goLeftCellRetainSelection:_(t.goLeftCellRetainSelection,"alt+ArrowLeft"),goRightCell:_(t.goRightCell,"ArrowRight|Tab"),goRightCellRetainSelection:_(t.goRightCellRetainSelection,"alt+ArrowRight"),goUpCell:_(t.goUpCell,"ArrowUp"),goUpCellRetainSelection:_(t.goUpCellRetainSelection,"alt+ArrowUp"),goToFirstCell:_(t.goToFirstCell,"primary+Home"),goToFirstColumn:_(t.goToFirstColumn,"Home|primary+ArrowLeft"),goToFirstRow:_(t.goToFirstRow,"primary+ArrowUp"),goToLastCell:_(t.goToLastCell,"primary+End"),goToLastColumn:_(t.goToLastColumn,"End|primary+ArrowRight"),goToLastRow:_(t.goToLastRow,"primary+ArrowDown"),goToNextPage:_(t.goToNextPage,"PageDown"),goToPreviousPage:_(t.goToPreviousPage,"PageUp"),paste:t.paste,rightFill:_(t.rightFill,"primary+_82"),search:_(t.search,"primary+f"),selectAll:_(t.selectAll,"primary+a"),selectColumn:_(t.selectColumn,"ctrl+ "),selectGrowDown:_(t.selectGrowDown,"shift+ArrowDown"),selectGrowLeft:_(t.selectGrowLeft,"shift+ArrowLeft"),selectGrowRight:_(t.selectGrowRight,"shift+ArrowRight"),selectGrowUp:_(t.selectGrowUp,"shift+ArrowUp"),selectRow:_(t.selectRow,"shift+ "),selectToFirstCell:_(t.selectToFirstCell,"primary+shift+Home"),selectToFirstColumn:_(t.selectToFirstColumn,"primary+shift+ArrowLeft"),selectToFirstRow:_(t.selectToFirstRow,"primary+shift+ArrowUp"),selectToLastCell:_(t.selectToLastCell,"primary+shift+End"),selectToLastColumn:_(t.selectToLastColumn,"primary+shift+ArrowRight"),selectToLastRow:_(t.selectToLastRow,"primary+shift+ArrowDown")}}function Us(t){const r=yi(t);return me.useMemo(()=>{if(r===void 0)return zr(vt);const c={...r,goToNextPage:(r==null?void 0:r.goToNextPage)??(r==null?void 0:r.pageDown)??vt.goToNextPage,goToPreviousPage:(r==null?void 0:r.goToPreviousPage)??(r==null?void 0:r.pageUp)??vt.goToPreviousPage,goToFirstCell:(r==null?void 0:r.goToFirstCell)??(r==null?void 0:r.first)??vt.goToFirstCell,goToLastCell:(r==null?void 0:r.goToLastCell)??(r==null?void 0:r.last)??vt.goToLastCell,selectToFirstCell:(r==null?void 0:r.selectToFirstCell)??(r==null?void 0:r.first)??vt.selectToFirstCell,selectToLastCell:(r==null?void 0:r.selectToLastCell)??(r==null?void 0:r.last)??vt.selectToLastCell};return zr({...vt,...c})},[r])}function Os(t){function r(g,w,k){if(typeof g=="number")return{headerIndex:g,isCollapsed:!1,depth:w,path:k};const D={headerIndex:g.headerIndex,isCollapsed:g.isCollapsed,depth:w,path:k};return g.subGroups!==void 0&&(D.subGroups=g.subGroups.map((b,S)=>r(b,w+1,[...k,S])).sort((b,S)=>b.headerIndex-S.headerIndex)),D}return t.map((g,w)=>r(g,0,[w])).sort((g,w)=>g.headerIndex-w.headerIndex)}function An(t,r){const c=[];function g(b,S,H=!1){let v=S!==null?S-b.headerIndex:r-b.headerIndex;if(b.subGroups!==void 0&&(v=b.subGroups[0].headerIndex-b.headerIndex),v--,c.push({rowIndex:-1,headerIndex:b.headerIndex,contentIndex:-1,skip:H,isCollapsed:b.isCollapsed,depth:b.depth,path:b.path,rows:v}),b.subGroups)for(let y=0;y<b.subGroups.length;y++){const E=y<b.subGroups.length-1?b.subGroups[y+1].headerIndex:S;g(b.subGroups[y],E,H||b.isCollapsed)}}const w=Os(t.groups);for(let b=0;b<w.length;b++){const S=b<w.length-1?w[b+1].headerIndex:null;g(w[b],S)}let k=0,D=0;for(const b of c)b.contentIndex=D,D+=b.rows,b.rowIndex=k,k+=b.isCollapsed?1:b.rows+1;return c.filter(b=>b.skip===!1).map(b=>{const{skip:S,...H}=b;return H})}function $n(t,r){if(r===void 0||An.length===0)return{path:[t],originalIndex:t,isGroupHeader:!1,groupIndex:t,contentIndex:t,groupRows:-1};let c=t;for(const g of r){if(c===0)return{path:[...g.path,-1],originalIndex:g.headerIndex,isGroupHeader:!0,groupIndex:-1,contentIndex:-1,groupRows:g.rows};if(g.isCollapsed)c--;else{if(c<=g.rows)return{path:[...g.path,c-1],originalIndex:g.headerIndex+c,isGroupHeader:!1,groupIndex:c-1,contentIndex:g.contentIndex+c-1,groupRows:g.rows};c=c-g.rows-1}}return{path:[t],originalIndex:t,isGroupHeader:!1,groupIndex:t,contentIndex:t,groupRows:-1}}function _s(t,r,c,g){const w=me.useMemo(()=>t===void 0?void 0:An(t,r),[t,r]),k=me.useMemo(()=>w==null?void 0:w.reduce((v,y)=>(v[y.rowIndex]=y,v),{}),[w]),D=me.useMemo(()=>w===void 0?r:w.reduce((v,y)=>v+(y.isCollapsed?1:y.rows+1),0),[w,r]),b=me.useMemo(()=>t===void 0||typeof c=="number"&&t.height===c?c:v=>k!=null&&k[v]?t.height:typeof c=="number"?c:c(v),[k,t,c]),S=me.useCallback(v=>{if(w===void 0)return v;let y=v;for(const E of w){if(y===0)return;if(y--,!E.isCollapsed){if(y<E.rows)return E.contentIndex+y;y-=E.rows}}return v},[w]),H=Ct(g??(t==null?void 0:t.themeOverride),me.useCallback(v=>{if(t===void 0)return g==null?void 0:g(v,v,v);if(g===void 0&&(t==null?void 0:t.themeOverride)===void 0)return;const{isGroupHeader:y,contentIndex:E,groupIndex:W}=$n(v,w);return y?t.themeOverride:g==null?void 0:g(v,W,E)},[w,g,t]));return t===void 0?{rowHeight:b,rows:r,rowNumberMapper:S,getRowThemeOverride:H}:{rowHeight:b,rows:D,rowNumberMapper:S,getRowThemeOverride:H}}function Xs(t,r){const c=me.useMemo(()=>t===void 0?void 0:An(t,r),[t,r]);return{getRowGroupingForPath:$r,updateRowGroupingByPath:Fr,mapper:me.useCallback(g=>{if(typeof g=="number")return $n(g,c);const w=$n(g[1],c);return{...w,originalIndex:[g[0],w.originalIndex]}},[c])}}function Fr(t,r,c){const[g,...w]=r;return w[0]===-1?t.map((k,D)=>D===g?{...k,...c}:k):t.map((k,D)=>D===g?{...k,subGroups:Fr(k.subGroups??[],w,c)}:k)}function $r(t,r){const[c,...g]=r;return g[0]===-1?t[c]:$r(t[c].subGroups??[],g)}function Ys(t,r){const[c]=l.useState(()=>({value:t,callback:r,facade:{get current(){return c.value},set current(g){const w=c.value;w!==g&&(c.value=g,c.callback(g,w))}}}));return c.callback=r,c.facade}function qs(t,r,c,g,w){const[k,D]=l.useMemo(()=>[r!==void 0&&typeof c=="number"?Math.floor(r/c):0,r!==void 0&&typeof c=="number"?-(r%c):0],[r,c]),b=l.useMemo(()=>({x:g.current.x,y:k,width:g.current.width??1,height:g.current.height??1,ty:D}),[g,D,k]),[S,H,v]=bi(b),y=l.useRef(w);y.current=w;const E=Ys(null,U=>{U!==null&&r!==void 0?U.scrollTop=r:U!==null&&t!==void 0&&(U.scrollLeft=t)}),W=(S.height??1)>1;l.useLayoutEffect(()=>{if(r!==void 0&&E.current!==null&&W){if(E.current.scrollTop===r)return;E.current.scrollTop=r,E.current.scrollTop!==r&&v(),y.current()}},[r,W,v,E]);const Y=(S.width??1)>1;return l.useLayoutEffect(()=>{if(t!==void 0&&E.current!==null&&Y){if(E.current.scrollLeft===t)return;E.current.scrollLeft=t,E.current.scrollLeft!==t&&v(),y.current()}},[t,Y,v,E]),{visibleRegion:S,setVisibleRegion:H,scrollRef:E}}const Zs=tn("textarea")({name:"GhostInputBox",class:"gxeqqyx",propsAsIs:!1}),Js=(t,r)=>{const{onInput:c,onCompositionStart:g,onCompositionEnd:w,onKeyDown:k,onKeyUp:D,onFocus:b,onBlur:S,disabled:H=!1}=t,v=l.useRef(null),y=l.useRef(!1),E=l.useRef({width:0,height:0}),W=l.useCallback(()=>{const z=v.current;if(!z||z.style.opacity==="0")return;const Q=E.current.width,fe=E.current.height;z.style.width=`${Q}px`,z.style.height=`${fe}px`;const q=Math.max(Q,z.scrollWidth+2),Z=Math.max(fe,z.scrollHeight+2);z.style.width=`${q}px`,z.style.height=`${Z}px`},[]);l.useImperativeHandle(r,()=>({focus:()=>{var z;(z=v.current)==null||z.focus({preventScroll:!0})},blur:()=>{var z;(z=v.current)==null||z.blur()},clear:()=>{v.current&&(v.current.value="",v.current.setSelectionRange(0,0))},getValue:()=>{var z;return((z=v.current)==null?void 0:z.value)??""},setValue:z=>{if(v.current){v.current.value=z;const Q=z.length;v.current.setSelectionRange(Q,Q)}},setPosition:(z,Q,fe,q)=>{const Z=v.current;Z&&(E.current={width:fe,height:q},Z.style.left=`${z}px`,Z.style.top=`${Q}px`,Z.style.width=`${fe}px`,Z.style.height=`${q}px`)},setVisible:z=>{const Q=v.current;Q&&(z?(Q.style.opacity="1",Q.style.pointerEvents="auto",Q.style.zIndex="10000"):(Q.style.left="-9999px",Q.style.top="0",Q.style.width="1px",Q.style.height="1px",Q.style.opacity="0",Q.style.pointerEvents="none",Q.style.zIndex="0"))}}));const Y=l.useCallback(z=>{const Q=z.currentTarget;c(Q.value,y.current),W()},[c,W]),U=l.useCallback(()=>{y.current=!0,g()},[g]),de=l.useCallback(z=>{y.current=!1,w(z.currentTarget.value)},[w]),ve=l.useCallback(z=>{k(z)},[k]),K=l.useCallback(z=>{D==null||D(z)},[D]);return l.createElement(Zs,{ref:v,defaultValue:"",tabIndex:H?-1:0,disabled:H,onInput:Y,onCompositionStart:U,onCompositionEnd:de,onKeyDown:ve,onKeyUp:K,onFocus:b,onBlur:S,"aria-label":"Grid input",wrap:"off",rows:1,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1})},Qs=l.memo(l.forwardRef(Js)),js=l.lazy(async()=>await pi(()=>import("./image-window-loader-CvVz5YUq.js").then(t=>t.$),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url));let ec=0;function tc(t){return Bi(Er(Er(t).filter(r=>r.span!==void 0).map(r=>{var c,g;return Yt((((c=r.span)==null?void 0:c[0])??0)+1,(((g=r.span)==null?void 0:g[1])??0)+1)})))}function Qo(t,r){return t===void 0||r===0||t.columns.length===0&&t.current===void 0?t:{current:t.current===void 0?void 0:{cell:[t.current.cell[0]+r,t.current.cell[1]],range:{...t.current.range,x:t.current.range.x+r},rangeStack:t.current.rangeStack.map(c=>({...c,x:c.x+r}))},rows:t.rows,columns:t.columns.offset(r)}}const pt={kind:B.Loading,allowOverlay:!1},Hn={columns:ne.empty(),rows:ne.empty(),current:void 0},oc=(t,r)=>{var pr,Cr,wr;const[c,g]=l.useState(Hn),[w,k]=l.useState(),D=l.useRef(null),b=l.useRef(null),[S,H]=l.useState(),v=l.useRef(void 0),y=l.useRef(null),[E,W]=l.useState(!1),Y=l.useRef(E);Y.current=E;const U=l.useRef(w);U.current=w;const de=typeof window>"u"?null:window,{imageEditorOverride:ve,getRowThemeOverride:K,markdownDivCreateNode:z,width:Q,height:fe,columns:q,rows:Z,getCellContent:te,onCellClicked:se,onCellActivated:A,onFillPattern:Be,onFinishedEditing:$e,coercePasteValue:Le,drawHeader:rt,drawCell:Xe,editorBloom:Gt,onHeaderClicked:Ye,onColumnProposeMove:lt,rangeSelectionColumnSpanning:go=!0,spanRangeBehavior:mo="default",onGroupHeaderClicked:F,onCellContextMenu:le,className:we,onHeaderContextMenu:ye,getCellsForSelection:Je,onGroupHeaderContextMenu:Se,onGroupHeaderRenamed:Qe,onCellEdited:wt,onCellsEdited:yt,onSearchResultsChanged:je,searchResults:vo,onSearchValueChange:on,searchValue:po,onKeyDown:qt,onKeyUp:bt,keybindings:nn,editOnType:Zt=!0,onRowAppended:it,onColumnAppended:st,onColumnMoved:xt,validateCell:De,highlightRegions:He,rangeSelect:kt="rect",columnSelect:Fe="multi",rowSelect:Ae="multi",rangeSelectionBlending:Ar="exclusive",columnSelectionBlending:Gr="exclusive",rowSelectionBlending:Kr="exclusive",onDelete:rn,onDragStart:Co,onMouseMove:wo,onPaste:Rt,copyHeaders:Gn=!1,freezeColumns:et=0,cellActivationBehavior:yo="second-click",rowSelectionMode:ln="auto",columnSelectionMode:Jt="auto",onHeaderMenuClick:bo,onHeaderIndicatorClick:xo,getGroupDetails:ko,rowGrouping:ct,onSearchClose:sn,onItemHovered:Ro,onSelectionCleared:at,showSearch:Pr,onVisibleRegionChanged:Mo,gridSelection:Mt,onGridSelectionChange:cn,minColumnWidth:Nr=50,maxColumnWidth:Wr=500,maxColumnAutoWidth:Vr,provideEditor:Br,trailingRowOptions:j,freezeTrailingRows:tt=0,allowedFillDirections:Kn="orthogonal",scrollOffsetX:Ur,scrollOffsetY:Or,verticalBorder:Kt,onDragOverCell:_r,onDrop:Xr,onColumnResize:Qt,onColumnResizeEnd:jt,onColumnResizeStart:eo,customRenderers:So,fillHandle:Yr,experimental:he,fixedShadowX:qr,fixedShadowY:Zr,headerIcons:Jr,imageWindowLoader:Qr,initialSize:jr,isDraggable:el,onDragLeave:tl,onRowMoved:to,overscrollX:ol,overscrollY:nl,preventDiagonalScrolling:rl,rightElement:ll,rightElementProps:il,trapFocus:Pn=!1,smoothScrollX:sl,smoothScrollY:cl,scaleToRem:al=!1,rowHeight:ul=34,headerHeight:Nn=36,groupHeaderHeight:dl=Nn,theme:fl,isOutsideClick:hl,renderers:an,resizeIndicator:gl,scrollToActiveCell:Wn=!0,drawFocusRing:Vn=!0,portalElementRef:Eo,onRowStatus:To,onRowId:zo}=t,Bn=Vn==="no-editor"?w===void 0:Vn,N=typeof t.rowMarkers=="string"?void 0:t.rowMarkers,ml=(N==null?void 0:N.rowNumber)??!1;let Io=(N==null?void 0:N.kind)??t.rowMarkers??"none",ot=ml;(Io==="both"||Io==="checkbox-and-number")&&(Io="checkbox",ot=!0);const Ge=Io,vl=(N==null?void 0:N.width)??t.rowMarkerWidth,un=(N==null?void 0:N.startIndex)??t.rowMarkerStartIndex??1,dn=(N==null?void 0:N.theme)??t.rowMarkerTheme,fn=N==null?void 0:N.headerTheme,Un=N==null?void 0:N.headerAlwaysVisible,Lo=Ae!=="multi"||(N==null?void 0:N.headerDisabled)===!0,Pt=(N==null?void 0:N.checkboxStyle)??"square",pl=(N==null?void 0:N.rowStatus)??!1,On=(N==null?void 0:N.rowStatusWidth)??40,Do=N==null?void 0:N.rowStatusTheme,Cl=(N==null?void 0:N.rowId)??!1,_n=(N==null?void 0:N.rowIdWidth)??80,Ho=N==null?void 0:N.rowIdTheme,Nt=Math.max(Nr,20),Fo=Math.max(Wr,Nt),wl=Math.max(Vr??Fo,Nt),Xn=l.useMemo(()=>typeof window>"u"?{fontSize:"16px"}:window.getComputedStyle(document.documentElement),[]),{rows:G,rowNumberMapper:hn,rowHeight:yl,getRowThemeOverride:nt}=_s(ct,Z,ul,K),bl=l.useMemo(()=>Number.parseFloat(Xn.fontSize),[Xn]),{rowHeight:ut,headerHeight:Yn,groupHeaderHeight:gn,theme:qn,overscrollX:xl,overscrollY:kl}=Bs({groupHeaderHeight:dl,headerHeight:Nn,overscrollX:ol,overscrollY:nl,remSize:bl,rowHeight:yl,scaleToRem:al,theme:fl}),dt=Us(nn),St=vl??(Z>1e4?48:Z>1e3?44:Z>100?36:32),qe=Ge!=="none",oo=pl===!0,no=Cl===!0,d=(qe?ot?2:1:0)+(oo?1:0)+(no?1:0),ce=j!==void 0,ro=(j==null?void 0:j.sticky)===!0,[Rl,Zn]=l.useState(!1),Ml=Pr??Rl,Sl=l.useCallback(()=>{sn!==void 0?sn():Zn(!1)},[sn]),h=l.useMemo(()=>Mt===void 0?void 0:Qo(Mt,d),[Mt,d])??c,Ke=l.useRef(new AbortController);l.useEffect(()=>()=>Ke==null?void 0:Ke.current.abort(),[]);const[pe,El]=$s(Je,te,d,Ke.current,G),Tl=l.useCallback((e,o,n)=>{if(De===void 0)return!0;const i=[e[0]-d,e[1]];return De==null?void 0:De(i,o,n)},[d,De]),$o=l.useRef(Mt),Pe=l.useCallback((e,o)=>{o&&(e=xi(e,pe,d,mo,Ke.current)),cn!==void 0?($o.current=Qo(e,-d),cn($o.current)):g(e)},[cn,pe,d,mo]),Wt=Ct(Qt,l.useCallback((e,o,n,i)=>{Qt==null||Qt(q[n-d],o,n-d,i)},[Qt,d,q])),zl=Ct(jt,l.useCallback((e,o,n,i)=>{jt==null||jt(q[n-d],o,n-d,i)},[jt,d,q])),Il=Ct(eo,l.useCallback((e,o,n,i)=>{eo==null||eo(q[n-d],o,n-d,i)},[eo,d,q])),Ll=Ct(rt,l.useCallback((e,o)=>(rt==null?void 0:rt({...e,columnIndex:e.columnIndex-d},o))??!1,[rt,d])),Dl=Ct(Xe,l.useCallback((e,o)=>(Xe==null?void 0:Xe({...e,col:e.col-d},o))??!1,[Xe,d])),ft=l.useCallback(e=>{if(rn!==void 0){const o=rn(Qo(e,-d));return typeof o=="boolean"?o:Qo(o,d)}return!0},[rn,d]),[Ce,Re,ge]=Fs(h,Pe,Ar,Gr,Kr,kt,go),be=l.useMemo(()=>Ln(Ir(),qn),[qn]),[mn,Hl]=l.useState([0,0,0]),Jn=l.useMemo(()=>{if(an===void 0)return{};const e={};for(const o of an)e[o.kind]=o;return e},[an]),Me=l.useCallback(e=>e.kind!==B.Custom?Jn[e.kind]:So==null?void 0:So.find(o=>o.isMatch(e)),[So,Jn]);let{sizedColumns:Ne,nonGrowWidth:Qn}=Ds(q,G,El,mn[0]-(d===0?0:St)-mn[2],Nt,wl,be,Me,Ke.current);Ge!=="none"&&(Qn+=St);const lo=l.useMemo(()=>{let e=0;for(const o of Ne)o.group!==void 0&&(typeof o.group=="string"?e=Math.max(e,1):e=Math.max(e,o.group.length));return e},[Ne]),jn=lo>0,er=l.useMemo(()=>lo===0?[]:Array(lo).fill(gn),[lo,gn]),Fl=er.reduce((e,o)=>e+o,0),io=Yn+Fl,tr=h.rows.length,or=Ge==="none"?void 0:tr===0?!1:tr===G?!0:void 0,J=l.useMemo(()=>{const e=[];return Ge!=="none"&&(ot&&e.push({title:"",width:St,icon:void 0,hasMenu:!1,style:"normal",themeOverride:dn,rowMarker:Pt,rowMarkerChecked:!1,headerRowMarkerTheme:fn,headerRowMarkerAlwaysVisible:!1,headerRowMarkerDisabled:!0}),e.push({title:"",width:St,icon:void 0,hasMenu:!1,style:"normal",themeOverride:dn,rowMarker:Pt,rowMarkerChecked:or,headerRowMarkerTheme:fn,headerRowMarkerAlwaysVisible:Un,headerRowMarkerDisabled:Lo})),oo&&e.push({title:"",width:On,icon:void 0,hasMenu:!1,style:"normal",themeOverride:Do}),no&&e.push({title:"ID",width:_n,icon:void 0,hasMenu:!1,style:"normal",themeOverride:Ho}),[...e,...Ne]},[oo,On,Do,no,_n,Ho,Ge,Ne,St,dn,Pt,or,fn,Un,Lo,ot]),Ee=l.useRef({height:1,width:1,x:0,y:0}),Ao=l.useRef(!1),{setVisibleRegion:nr,visibleRegion:Et,scrollRef:ee}=qs(Ur,Or,ut,Ee,()=>Ao.current=!0);Ee.current=Et;const $l=Et.x+d,Go=Et.y,ae=l.useRef(null),xe=l.useCallback(e=>{var o;e===!0?(o=y.current)==null||o.focus():window.requestAnimationFrame(()=>{var n;(n=y.current)==null||n.focus()})},[]),ke=ce?G+1:G,Te=l.useCallback(e=>{console.log("[mangledOnCellsEdited] items:",e),console.log("[mangledOnCellsEdited] rowMarkerOffset:",d);const o=d===0?e:e.map(i=>({...i,location:[i.location[0]-d,i.location[1]]}));console.log("[mangledOnCellsEdited] mangledItems:",o),console.log("[mangledOnCellsEdited] onCellsEdited:",yt);const n=yt==null?void 0:yt(o);if(console.log("[mangledOnCellsEdited] onCellsEdited result:",n),n!==!0){console.log("[mangledOnCellsEdited] calling onCellEdited for each item, onCellEdited:",wt);for(const i of o)console.log("[mangledOnCellsEdited] calling onCellEdited with:",i.location,i.value),wt==null||wt(i.location,i.value)}return n},[wt,yt,d]),[Tt,vn]=l.useState(),Ko=h.current!==void 0&&h.current.range.width*h.current.range.height>1?h.current.range:void 0,Vt=Bn?(pr=h.current)==null?void 0:pr.cell:void 0,Po=Vt==null?void 0:Vt[0],No=Vt==null?void 0:Vt[1],Al=l.useMemo(()=>{if((He===void 0||He.length===0)&&(Ko??Po??No??Tt)===void 0)return;const e=[];if(He!==void 0)for(const o of He){const n=J.length-o.range.x-d;n>0&&e.push({color:o.color,range:{...o.range,x:o.range.x+d,width:Math.min(n,o.range.width)},style:o.style})}return Tt!==void 0&&e.push({color:br(be.accentColor,0),range:Tt,style:"dashed"}),Ko!==void 0&&e.push({color:br(be.accentColor,.5),range:Ko,style:"solid-outline"}),Po!==void 0&&No!==void 0&&e.push({color:be.accentColor,range:{x:Po,y:No,width:1,height:1},style:"solid-outline"}),e.length>0?e:void 0},[Tt,Ko,Po,No,He,J.length,be.accentColor,d]),rr=l.useRef(J);rr.current=J;const ue=l.useCallback(([e,o],n=!1)=>{var p,C,R,x,X,M,V,$,T;const i=ce&&o===ke-1;let s=0,f=-1,a=-1,u=-1,m=-1;if(qe&&ot&&(f=s++),qe&&(a=s++),oo&&(u=s++),no&&(m=s++),e===f){if(i)return pt;const L=hn(o);return L===void 0?pt:{kind:Ht.Marker,allowOverlay:!1,checkboxStyle:Pt,checked:!1,markerKind:"number",row:un+L,drawHandle:!1,cursor:void 0,disabled:((p=t.disabledRows)==null?void 0:p.call(t,o))===!0}}if(e===a){if(i)return pt;const L=hn(o);if(L===void 0)return pt;let P;return ot?P=Ge==="checkbox-visible"?"checkbox-visible":"checkbox":Ge==="clickable-number"?P="number":P=Ge,{kind:Ht.Marker,allowOverlay:!1,checkboxStyle:Pt,checked:(h==null?void 0:h.rows.hasIndex(o))===!0,markerKind:P,row:un+L,drawHandle:to!==void 0,cursor:ot?void 0:Ge==="clickable-number"?"pointer":void 0,disabled:((C=t.disabledRows)==null?void 0:C.call(t,o))===!0}}if(e===u){if(i)return pt;const L=To==null?void 0:To(o);return{kind:Ht.RowStatus,allowOverlay:!1,status:L,themeOverride:Do}}if(e===m){if(i)return pt;const L=zo==null?void 0:zo(o);return{kind:Ht.RowId,allowOverlay:!1,rowId:L,themeOverride:Ho}}if(i){const P=e===d?(j==null?void 0:j.hint)??"":"",I=rr.current[e];if(((R=I==null?void 0:I.trailingRowOptions)==null?void 0:R.disabled)===!0)return pt;{const oe=((x=I==null?void 0:I.trailingRowOptions)==null?void 0:x.hint)??P,ze=((X=I==null?void 0:I.trailingRowOptions)==null?void 0:X.addIcon)??(j==null?void 0:j.addIcon);return{kind:Ht.NewRow,hint:oe,allowOverlay:!1,icon:ze}}}else{const L=e-d;if(n||(he==null?void 0:he.strict)===!0){const I=Ee.current,oe=I.x>L||L>I.x+I.width||I.y>o||o>I.y+I.height||o>=yn.current,ze=L===((V=(M=I.extras)==null?void 0:M.selected)==null?void 0:V[0])&&o===(($=I.extras)==null?void 0:$.selected[1]);let Ie=!1;if(((T=I.extras)==null?void 0:T.freezeRegions)!==void 0){for(const Ve of I.extras.freezeRegions)if(ki(Ve,L,o)){Ie=!0;break}}if(oe&&!ze&&!Ie)return pt}let P=te([L,o]);return d!==0&&P.span!==void 0&&(P={...P,span:[P.span[0]+d,P.span[1]+d]}),P}},[ce,ke,oo,To,Do,no,zo,Ho,qe,hn,Pt,h==null?void 0:h.rows,Ge,un,to,d,j==null?void 0:j.hint,j==null?void 0:j.addIcon,he==null?void 0:he.strict,te,ot]),pn=l.useCallback(e=>{let o=(ko==null?void 0:ko(e))??{name:e};return Qe!==void 0&&e!==""&&(o={icon:o.icon,name:o.name,overrideTheme:o.overrideTheme,actions:[...o.actions??[],{title:"Rename",icon:"renameIcon",onClick:n=>xn({group:o.name,bounds:n.bounds})}]}),o},[ko,Qe]),Wo=l.useCallback(e=>{var u;const[o,n]=e.cell,i=J[o],s=(i==null?void 0:i.group)!==void 0?(u=pn(i.group))==null?void 0:u.overrideTheme:void 0,f=i==null?void 0:i.themeOverride,a=nt==null?void 0:nt(n);k({...e,theme:Ln(be,s,f,a,e.content.themeOverride)})},[nt,J,pn,be]),Ue=l.useCallback((e,o,n)=>{var a,u,m,p;if(h.current===void 0)return;const[i,s]=h.current.cell,f=ue([i,s]);if(f.kind!==B.Boolean&&f.allowOverlay){let C=f;if(n!==void 0)switch(C.kind){case B.Number:{const x=Ri(()=>n==="-"?-0:Number.parseFloat(n),0);C={...C,data:Number.isNaN(x)?0:x};break}case B.Text:case B.Markdown:case B.Uri:C={...C,data:n};break}Wo({target:e,content:C,initialValue:n,cell:[i,s],highlight:n===void 0,forceEditMode:n!==void 0,activation:o}),n!==void 0&&((a=y.current)==null||a.setPosition(e.x,e.y,e.width,e.height),n.length>0&&((u=y.current)==null||u.setValue(n)),(m=y.current)==null||m.setVisible(!0),W(!0))}else f.kind===B.Boolean&&o.inputType==="keyboard"&&f.readonly!==!0&&(Te([{location:h.current.cell,value:{...f,data:xr(f.data)}}]),(p=ae.current)==null||p.damage([{cell:h.current.cell}]))},[ue,h,Te,Wo]),lr=l.useCallback((e,o)=>{var s;const n=(s=ae.current)==null?void 0:s.getBounds(e,o);if(n===void 0||ee.current===null)return;const i=ue([e,o]);i.allowOverlay&&Wo({target:n,content:i,initialValue:void 0,highlight:!0,cell:[e,o],forceEditMode:!0,activation:{inputType:"keyboard",key:"Enter"}})},[ue,ee,Wo]),ie=l.useCallback((e,o,n="both",i=0,s=0,f=void 0)=>{if(ee.current!==null){const a=ae.current,u=b.current,m=typeof e!="number"?e.unit==="cell"?e.amount:void 0:e,p=typeof o!="number"?o.unit==="cell"?o.amount:void 0:o,C=typeof e!="number"&&e.unit==="px"?e.amount:void 0,R=typeof o!="number"&&o.unit==="px"?o.amount:void 0;if(a!==null&&u!==null){let x={x:0,y:0,width:0,height:0},X=0,M=0;if((m!==void 0||p!==void 0)&&(x=a.getBounds((m??0)+d,p??0)??x,x.width===0||x.height===0))return;const V=u.getBoundingClientRect(),$=V.width/u.offsetWidth;if(C!==void 0&&(x={...x,x:C-V.left-ee.current.scrollLeft,width:1}),R!==void 0&&(x={...x,y:R+V.top-ee.current.scrollTop,height:1}),x!==void 0){const T={x:x.x-i,y:x.y-s,width:x.width+2*i,height:x.height+2*s};let L=0;for(let In=0;In<et;In++)L+=Ne[In].width;let P=0;const I=tt+(ro?1:0);I>0&&(P=Mi(ke,I,ut));let oe=L*$+V.left+d*St*$,ze=V.right,Ie=V.top+io*$,Ve=V.bottom-P*$;const Yo=x.width+i*2;switch(f==null?void 0:f.hAlign){case"start":ze=oe+Yo;break;case"end":oe=ze-Yo;break;case"center":oe=Math.floor((oe+ze)/2)-Yo/2,ze=oe+Yo;break}const qo=x.height+s*2;switch(f==null?void 0:f.vAlign){case"start":Ve=Ie+qo;break;case"end":Ie=Ve-qo;break;case"center":Ie=Math.floor((Ie+Ve)/2)-qo/2,Ve=Ie+qo;break}oe>T.x?X=T.x-oe:ze<T.x+T.width&&(X=T.x+T.width-ze),Ie>T.y?M=T.y-Ie:Ve<T.y+T.height&&(M=T.y+T.height-Ve),n==="vertical"||typeof e=="number"&&e<et?X=0:(n==="horizontal"||typeof o=="number"&&o>=ke-I)&&(M=0),(X!==0||M!==0)&&($!==1&&(X/=$,M/=$),ee.current.scrollTo({left:X+ee.current.scrollLeft,top:M+ee.current.scrollTop,behavior:(f==null?void 0:f.behavior)??"auto"}))}}}},[d,tt,St,ee,io,et,Ne,ke,ro,ut]),Cn=l.useRef(lr),wn=l.useRef(te);Cn.current=lr,wn.current=te;const yn=l.useRef(G);yn.current=G;const ir=l.useRef(J.length);ir.current=J.length;const ht=l.useCallback(async(e,o=!0,n)=>{var p;const i=J[e];if(((p=i==null?void 0:i.trailingRowOptions)==null?void 0:p.disabled)===!0)return;const s=it==null?void 0:it();let f,a=!0;s!==void 0&&(f=await s,f==="top"&&(a=!1),typeof f=="number"&&(a=!1));let u=0;const m=()=>{if(yn.current<=G){u<500&&window.setTimeout(m,u),u=50+u*2;return}const C=typeof f=="number"?f:a?G:0;Xo.current(e-d,C,"both",0,20,n?{behavior:n}:void 0),Ce({cell:[e,C],range:{x:e,y:C,width:1,height:1}},!1,!1,"edit");const R=wn.current([e-d,C]);R.allowOverlay&&Ft(R)&&R.readonly!==!0&&o&&window.setTimeout(()=>{Cn.current(e,C)},0)};m()},[J,it,d,G,Ce]),Vo=l.useCallback(async(e,o=!0)=>{const n=st==null?void 0:st();let i,s=!0;n!==void 0&&(i=await n,i==="left"&&(s=!1),typeof i=="number"&&(s=!1));let f=0;const a=()=>{if(ir.current<=J.length){f<500&&window.setTimeout(a,f),f=50+f*2;return}const u=typeof i=="number"?i:s?J.length:0;ie(u-d,e),Ce({cell:[u,e],range:{x:u,y:e,width:1,height:1}},!1,!1,"edit");const m=wn.current([u-d,e]);m.allowOverlay&&Ft(m)&&m.readonly!==!0&&o&&window.setTimeout(()=>{Cn.current(u,e)},0)};a()},[J,st,d,ie,Ce]),Bt=l.useCallback(e=>{var n,i;const o=((i=(n=Ne[e])==null?void 0:n.trailingRowOptions)==null?void 0:i.targetColumn)??(j==null?void 0:j.targetColumn);if(typeof o=="number")return o+(qe?1:0);if(typeof o=="object"){const s=q.indexOf(o);if(s>=0)return s+(qe?1:0)}},[Ne,q,qe,j==null?void 0:j.targetColumn]),gt=l.useRef(void 0),Ut=l.useRef(void 0),so=l.useCallback((e,o)=>{var s;const[n,i]=o;return Ln(be,(s=J[n])==null?void 0:s.themeOverride,nt==null?void 0:nt(i),e.themeOverride)},[nt,J,be]),{mapper:zt}=Xs(ct,Z),Oe=ct==null?void 0:ct.navigationBehavior,co=l.useCallback(e=>{var p,C,R;const o=en.value?e.metaKey:e.ctrlKey,n=o&&Ae==="multi",[i,s]=e.location,f=h.columns,a=h.rows,[u,m]=((p=h.current)==null?void 0:p.cell)??[];if(e.kind==="cell"){if(Ut.current=void 0,It.current=[i,s],i===(ot?1:0)&&qe){if(ce===!0&&s===G||Ge==="number"||Ae==="none")return;const M=ue(e.location);if(M.kind!==Ht.Marker||M.disabled===!0)return;if(to!==void 0){const T=Me(M);jo((T==null?void 0:T.kind)===Ht.Marker);const L=(C=T==null?void 0:T.onClick)==null?void 0:C.call(T,{...e,cell:M,posX:e.localEventX,posY:e.localEventY,bounds:e.bounds,theme:so(M,e.location),preventDefault:()=>{}});if(L===void 0||L.checked===M.checked)return}k(void 0),xe();const V=a.hasIndex(s),$=gt.current;if(Ae==="multi"&&(e.shiftKey||e.isLongTouch===!0)&&$!==void 0&&a.hasIndex($)){const T=[Math.min($,s),Math.max($,s)+1];n||ln==="multi"?Re(void 0,T,!0):Re(ne.fromSingleSelection(T),void 0,n)}else Ae==="multi"&&(n||e.isTouch||ln==="multi")?V?Re(a.remove(s),void 0,!0):(Re(void 0,s,!0),gt.current=s):V&&a.length===1?Re(ne.empty(),void 0,o):(Re(ne.fromSingleSelection(s),void 0,o),gt.current=s)}else if(i>=d&&ce&&s===G){const M=Bt(i);ht(M??i)}else if(u!==i||m!==s){const M=ue(e.location),V=Me(M);if((V==null?void 0:V.onSelect)!==void 0){let L=!1;if(V.onSelect({...e,cell:M,posX:e.localEventX,posY:e.localEventY,bounds:e.bounds,preventDefault:()=>L=!0,theme:so(M,e.location)}),L)return}if(Oe==="block"&&zt(s).isGroupHeader)return;const $=ro&&s===G,T=ro&&h!==void 0&&((R=h.current)==null?void 0:R.cell[1])===G;if((e.shiftKey||e.isLongTouch===!0)&&u!==void 0&&m!==void 0&&h.current!==void 0&&!T){if($)return;const L=Math.min(i,u),P=Math.max(i,u),I=Math.min(s,m),oe=Math.max(s,m);Ce({...h.current,range:{x:L,y:I,width:P-L+1,height:oe-I+1}},!0,o,"click"),gt.current=void 0,xe()}else{const L=h.rows.length>0;Ce({cell:[i,s],range:{x:i,y:s,width:1,height:1}},!0,o||L,"click"),gt.current=void 0,k(void 0),xe()}}}else if(e.kind==="header")if(It.current=[i,s],k(void 0),qe&&i===0)gt.current=void 0,Ut.current=void 0,!Lo&&Ae==="multi"&&(a.length!==G?Re(ne.fromSingleSelection([0,G]),void 0,o):Re(ne.empty(),void 0,o),xe());else{const x=Ut.current;if(Fe==="multi"&&(e.shiftKey||e.isLongTouch===!0)&&x!==void 0&&f.hasIndex(x)){const X=[Math.min(x,i),Math.max(x,i)+1];o||e.isTouch||Jt==="multi"?ge(void 0,X,o):ge(ne.fromSingleSelection(X),void 0,o)}else Fe==="multi"&&(o||e.isTouch||Jt==="multi")?(f.hasIndex(i)?ge(f.remove(i),void 0,o):ge(void 0,i,o),Ut.current=i):Fe!=="none"&&(f.hasIndex(i)?ge(f.remove(i),void 0,o):ge(ne.fromSingleSelection(i),void 0,o),Ut.current=i);gt.current=void 0,xe()}else e.kind===Xt?It.current=[i,s]:e.kind===kr&&!e.isMaybeScrollbar&&(Pe(Hn,!1),k(void 0),xe(),at==null||at(),gt.current=void 0,Ut.current=void 0)},[Ae,Fe,h,qe,d,ce,G,Ge,ue,to,xe,ln,Jt,Me,so,Re,Bt,ht,Oe,zt,ro,Ce,Lo,ge,Pe,at]),ao=l.useRef(!1),It=l.useRef(void 0),sr=l.useRef(Et),We=l.useRef(void 0),Gl=l.useCallback(e=>{if(Ot.current=!1,sr.current=Ee.current,e.button!==0&&e.button!==1){We.current=void 0;return}const o=performance.now();We.current={button:e.button,time:o,location:e.location},(e==null?void 0:e.kind)==="header"&&(ao.current=!0);const n=e.kind==="cell"&&e.isFillHandle;!n&&e.kind!=="cell"&&e.isEdge||(H({previousSelection:h,fillHandle:n}),It.current=void 0,!e.isTouch&&e.button===0&&!n?co(e):!e.isTouch&&e.button===1&&(It.current=e.location))},[h,co]),[bn,xn]=l.useState(),cr=l.useCallback(e=>{if(e.kind!==Xt||Fe!=="multi")return;const o=en.value?e.metaKey:e.ctrlKey,[n,i]=e.location,s=h.columns;if(n<d)return;const f=J[n];let a=n,u=n;const m=i<=-2?-(i+2):0,p=Array.isArray(f.group)?f.group.length:1,C=(R,x)=>p>1?Ki(R,x,m,p):Pi(R,x);for(let R=n-1;R>=d&&C(f.group,J[R].group);R--)a--;for(let R=n+1;R<J.length&&C(f.group,J[R].group);R++)u++;if(xe(),o||e.isTouch||Jt==="multi")if(s.hasAll([a,u+1])){let R=s;for(let x=a;x<=u;x++)R=R.remove(x);ge(R,void 0,o)}else ge(void 0,[a,u+1],o);else ge(ne.fromSingleSelection([a,u+1]),void 0,o)},[Fe,xe,h.columns,J,d,ge,Jt]),Ot=l.useRef(!1),Bo=l.useCallback(async e=>{if(pe!==void 0&&Wt!==void 0){const o=Ee.current.y,n=Ee.current.height;let i=pe({x:e,y:o,width:1,height:Math.min(n,G-o)},Ke.current.signal);typeof i!="object"&&(i=await i());const s=Ne[e-d],a=document.createElement("canvas").getContext("2d",{alpha:!1});if(a!==null){a.font=be.baseFontFull;const u=Dr(a,be,s,0,i,Nt,Fo,!1,Me);Wt==null||Wt(s,u.width,e,u.width)}}},[Ne,pe,Fo,be,Nt,Wt,d,G,Me]),[Kl,kn]=l.useState(),_t=l.useCallback(async(e,o)=>{var u,m;const n=(u=e.current)==null?void 0:u.range;if(n===void 0||pe===void 0||o.current===void 0)return;const i=o.current.range;if(Be!==void 0){let p=!1;if(Be({fillDestination:{...i,x:i.x-d},patternSource:{...n,x:n.x-d},preventDefault:()=>p=!0}),p)return}let s=pe(n,Ke.current.signal);typeof s!="object"&&(s=await s());const f=s,a=[];for(let p=0;p<i.width;p++)for(let C=0;C<i.height;C++){const R=[i.x+p,i.y+C];if(Si(R,n))continue;const x=f[C%n.height][p%n.width];Jo(x)||!Ft(x)||a.push({location:R,value:{...x}})}Te(a),(m=ae.current)==null||m.damage(a.map(p=>({cell:p.location})))},[pe,Te,Be,d]),ar=l.useCallback(()=>{if(h.current===void 0||h.current.range.width<=1)return;const e={...h,current:{...h.current,range:{...h.current.range,width:1}}};_t(e,h)},[_t,h]),ur=l.useCallback(()=>{if(h.current===void 0||h.current.range.height<=1)return;const e={...h,current:{...h.current,range:{...h.current.range,height:1}}};_t(e,h)},[_t,h]),Pl=l.useCallback((e,o)=>{var C,R;const n=S;if(H(void 0),vn(void 0),kn(void 0),ao.current=!1,o)return;if((n==null?void 0:n.fillHandle)===!0&&h.current!==void 0&&((C=n.previousSelection)==null?void 0:C.current)!==void 0){if(Tt===void 0)return;const x={...h,current:{...h.current,range:Ei(n.previousSelection.current.range,Tt)}};_t(n.previousSelection,x),Pe(x,!0);return}const[i,s]=e.location,[f,a]=It.current??[],u=()=>{Ot.current=!0},m=x=>{var M,V,$;const X=x.isTouch||f===i&&a===s;if(X&&(se==null||se([i-d,s],{...x,preventDefault:u})),x.button===1)return!Ot.current;if(!Ot.current){const T=ue(e.location),L=Me(T);if(L!==void 0&&L.onClick!==void 0&&X){const I=L.onClick({...x,cell:T,posX:x.localEventX,posY:x.localEventY,bounds:x.bounds,theme:so(T,e.location),preventDefault:u});I!==void 0&&!Jo(I)&&$t(I)&&(Te([{location:x.location,value:I}]),(M=ae.current)==null||M.damage([{cell:x.location}]))}if(Ot.current||h.current===void 0)return!1;let P=!1;switch(T.activationBehaviorOverride??yo){case"double-click":case"second-click":{if((($=(V=n==null?void 0:n.previousSelection)==null?void 0:V.current)==null?void 0:$.cell)===void 0)break;const[I,oe]=h.current.cell,[ze,Ie]=n.previousSelection.current.cell;P=i===I&&i===ze&&s===oe&&s===Ie&&(x.isDoubleClick===!0||yo==="second-click");break}case"single-click":{P=!0;break}}if(P){const oe={inputType:"pointer",pointerActivation:x.isDoubleClick===!0?"double-click":T.activationBehaviorOverride??yo,pointerType:x.isTouch?"touch":"mouse"};return A==null||A([i-d,s],oe),Ue(x.bounds,oe),!0}}return!1},p=e.location[0]-d;if(e.isTouch){const x=Ee.current,X=sr.current;if(x.x!==X.x||x.y!==X.y)return;if(e.isLongTouch===!0){if(e.kind==="cell"&&Ti((R=h.current)==null?void 0:R.cell,e.location)){le==null||le([p,e.location[1]],{...e,preventDefault:u});return}else if(e.kind==="header"&&h.columns.hasIndex(i)){ye==null||ye(p,{...e,preventDefault:u});return}else if(e.kind===Xt){if(p<0)return;Se==null||Se(p,{...e,preventDefault:u});return}}e.kind==="cell"?m(e)||co(e):e.kind===Xt?F==null||F(p,{...e,preventDefault:u}):(e.kind===zi&&(Ye==null||Ye(p,{...e,preventDefault:u})),co(e));return}if(e.kind==="header"){if(p<0)return;e.isEdge?e.isDoubleClick===!0&&Bo(i):e.button===0&&i===f&&s===a&&(Ye==null||Ye(p,{...e,preventDefault:u}))}if(e.kind===Xt){if(p<0)return;e.button===0&&i===f&&s===a&&(F==null||F(p,{...e,preventDefault:u}),Ot.current||cr(e))}e.kind==="cell"&&(e.button===0||e.button===1)&&m(e),It.current=void 0},[S,h,d,Tt,_t,Pe,se,ue,Me,yo,so,Te,A,Ue,le,ye,Se,co,F,Ye,Bo,cr]),Nl=l.useCallback(e=>{const o={...e,location:[e.location[0]-d,e.location[1]]};wo==null||wo(o),S!==void 0&&e.buttons===0&&(H(void 0),vn(void 0),kn(void 0),ao.current=!1),kn(n=>{var i;return ao.current?[e.scrollEdge[0],0]:e.scrollEdge[0]===(n==null?void 0:n[0])&&e.scrollEdge[1]===n[1]?n:S===void 0||(((i=We.current)==null?void 0:i.location[0])??0)<d?void 0:e.scrollEdge})},[S,wo,d]),Wl=l.useCallback((e,o)=>{bo==null||bo(e-d,o)},[bo,d]),Vl=l.useCallback((e,o)=>{xo==null||xo(e-d,o)},[xo,d]);l.useEffect(()=>{if(w===void 0)return;const e=i=>{const s=[];let f=i.parentElement;for(;f&&f!==document.documentElement;){const a=window.getComputedStyle(f),u=a.overflow+a.overflowY+a.overflowX;(u.includes("scroll")||u.includes("auto"))&&s.push(f),f=f.parentElement}return s},o=i=>{const s=i.target;ee.current&&!ee.current.contains(s)&&k(void 0)},n=[];if(ee.current){const i=e(ee.current);n.push(...i)}return n.forEach(i=>{i.addEventListener("scroll",o)}),window.addEventListener("scroll",o),document.addEventListener("scroll",o,!0),()=>{n.forEach(i=>{i.removeEventListener("scroll",o)}),window.removeEventListener("scroll",o),document.removeEventListener("scroll",o,!0)}},[w,k,ee]);const Ze=(Cr=h==null?void 0:h.current)==null?void 0:Cr.cell,Bl=l.useCallback((e,o,n,i,s,f)=>{if(Ao.current=!1,w!==void 0){const C=Ee.current;(C.x!==e.x||C.y!==e.y)&&k(void 0)}let a=Ze;a!==void 0&&(a=[a[0]-d,a[1]]);const u=et===0?void 0:{x:0,y:e.y,width:et,height:e.height},m=[];u!==void 0&&m.push(u),tt>0&&(m.push({x:e.x-d,y:G-tt,width:e.width,height:tt}),et>0&&m.push({x:0,y:G-tt,width:et,height:tt}));const p={x:e.x-d,y:e.y,width:e.width,height:ce&&e.y+e.height>=G?e.height-1:e.height,tx:s,ty:f,extras:{selected:a,freezeRegion:u,freezeRegions:m}};Ee.current=p,nr(p),Hl([o,n,i]),Mo==null||Mo(p,p.tx,p.ty,p.extras)},[Ze,w,d,ce,G,et,tt,k,nr,Mo]),Ul=Ct(lt,l.useCallback((e,o)=>(lt==null?void 0:lt(e-d,o-d))!==!1,[lt,d])),Ol=Ct(xt,l.useCallback((e,o)=>{xt==null||xt(e-d,o-d),Fe!=="none"&&ge(ne.fromSingleSelection(o),void 0,!0)},[Fe,xt,d,ge])),Rn=l.useRef(!1),_l=l.useCallback(e=>{if(e.location[0]===0&&d>0){e.preventDefault();return}Co==null||Co({...e,location:[e.location[0]-d,e.location[1]]}),e.defaultPrevented()||(Rn.current=!0),H(void 0)},[Co,d]),Xl=l.useCallback(()=>{Rn.current=!1},[]),dr=ct==null?void 0:ct.selectionBehavior,Uo=l.useCallback(e=>{if(dr!=="block-spanning")return;const{isGroupHeader:o,path:n,groupRows:i}=zt(e);if(o)return[e,e];const s=n[n.length-1],f=e-s,a=e+i-s-1;return[f,a]},[zt,dr]),Mn=l.useRef(void 0),Sn=l.useCallback(e=>{var o,n,i;if(!Ii(e,Mn.current)&&(Mn.current=e,!(((o=We==null?void 0:We.current)==null?void 0:o.button)!==void 0&&We.current.button>=1))){if(e.buttons!==0&&S!==void 0&&((n=We.current)==null?void 0:n.location[0])===0&&d===1&&Ae==="multi"&&S.previousSelection&&!S.previousSelection.rows.hasIndex(We.current.location[1])&&h.rows.hasIndex(We.current.location[1])){const s=Math.min(We.current.location[1],e.location[1]),f=Math.max(We.current.location[1],e.location[1])+1;Re(ne.fromSingleSelection([s,f]),void 0,!1)}else if(e.buttons!==0&&S!==void 0&&h.current!==void 0&&!Rn.current&&!ao.current&&(kt==="rect"||kt==="multi-rect")){const[s,f]=h.current.cell;let[a,u]=e.location;if(u<0&&(u=Ee.current.y),S.fillHandle===!0&&((i=S.previousSelection)==null?void 0:i.current)!==void 0){const m=S.previousSelection.current.range;u=Math.min(u,ce?G-1:G);const p=Li(m,a,u,Kn);vn(p)}else{if(ce&&f===G)return;if(ce&&u===G)if(e.kind===kr)u--;else return;a=Math.max(a,d);const C=Uo(f);u=C===void 0?u:At(u,C[0],C[1]);const R=a-s,x=u-f,X={x:R>=0?s:a,y:x>=0?f:u,width:Math.abs(R)+1,height:Math.abs(x)+1};Ce({...h.current,range:X},!0,!1,"drag")}}Ro==null||Ro({...e,location:[e.location[0]-d,e.location[1]]})}},[S,d,Ae,h,kt,Ro,Re,ce,G,Kn,Uo,Ce]),Yl=l.useCallback(()=>{var a,u;const e=Mn.current;if(e===void 0)return;const[o,n]=e.scrollEdge;let[i,s]=e.location;const f=Ee.current;o===-1?i=((u=(a=f.extras)==null?void 0:a.freezeRegion)==null?void 0:u.x)??f.x:o===1&&(i=f.x+f.width),n===-1?s=Math.max(0,f.y):n===1&&(s=Math.min(G-1,f.y+f.height)),i=At(i,0,J.length-1),s=At(s,0,G-1),Sn({...e,location:[i,s]})},[J.length,Sn,G]);Vs(Kl,ee,Yl);const _e=l.useCallback(e=>{if(h.current===void 0)return;const[o,n]=e,[i,s]=h.current.cell,f=h.current.range;let a=f.x,u=f.x+f.width,m=f.y,p=f.y+f.height;const[C,R]=Uo(s)??[0,G-1],x=R+1;if(n!==0)switch(n){case 2:{p=x,m=s,ie(0,p,"vertical");break}case-2:{m=C,p=s+1,ie(0,m,"vertical");break}case 1:{m<s?(m++,ie(0,m,"vertical")):(p=Math.min(x,p+1),ie(0,p,"vertical"));break}case-1:{p>s+1?(p--,ie(0,p,"vertical")):(m=Math.max(C,m-1),ie(0,m,"vertical"));break}default:Rr()}if(o!==0)if(o===2)u=J.length,a=i,ie(u-1-d,0,"horizontal");else if(o===-2)a=d,u=i+1,ie(a-d,0,"horizontal");else{let X=[];if(pe!==void 0){const M=pe({x:a,y:m,width:u-a-d,height:p-m},Ke.current.signal);typeof M=="object"&&(X=tc(M))}if(o===1){let M=!1;if(a<i){if(X.length>0){const V=Yt(a+1,i+1).find($=>!X.includes($-d));V!==void 0&&(a=V,M=!0)}else a++,M=!0;M&&ie(a,0,"horizontal")}M||(u=Math.min(J.length,u+1),ie(u-1-d,0,"horizontal"))}else if(o===-1){let M=!1;if(u>i+1){if(X.length>0){const V=Yt(u-1,i,-1).find($=>!X.includes($-d));V!==void 0&&(u=V,M=!0)}else u--,M=!0;M&&ie(u-d,0,"horizontal")}M||(a=Math.max(d,a-1),ie(a-d,0,"horizontal"))}else Rr()}Ce({cell:h.current.cell,range:{x:a,y:m,width:u-a,height:p-m}},!0,!1,"keyboard-select")},[pe,Uo,h,J.length,d,G,ie,Ce]),En=l.useRef(Wn);En.current=Wn;const mt=l.useCallback((e,o,n,i)=>{const s=ke-(n?0:1);e=At(e,d,Ne.length-1+d),o=At(o,0,s);const f=Ze==null?void 0:Ze[0],a=Ze==null?void 0:Ze[1];if(e===f&&o===a)return!1;if(i&&h.current!==void 0){const u=[...h.current.rangeStack];(h.current.range.width>1||h.current.range.height>1)&&u.push(h.current.range),Pe({...h,current:{cell:[e,o],range:{x:e,y:o,width:1,height:1},rangeStack:u}},!0)}else Ce({cell:[e,o],range:{x:e,y:o,width:1,height:1}},!0,!1,"keyboard-nav");return v.current!==void 0&&v.current[0]===e&&v.current[1]===o&&(v.current=void 0),En.current&&ie(e-d,o,"both",0,20),!0},[ke,d,Ne.length,Ze,h,ie,Pe,Ce]),uo=l.useCallback((e,o)=>{var C,R,x,X;const n=U.current,i=Y.current;console.log("[onFinishEditing] isGhostMode:",i),console.log("[onFinishEditing] currentOverlay:",n),console.log("[onFinishEditing] ghostInputRef.current:",y.current),console.log("[onFinishEditing] ghostText:",(C=y.current)==null?void 0:C.getValue());let s=e;const f=((R=y.current)==null?void 0:R.getValue())??"";if(console.log("[onFinishEditing] ghostText from GhostInput:",f),(n==null?void 0:n.cell)!==void 0&&f.length>0&&n.content!==void 0){console.log("[onFinishEditing] Using ghostText from GhostInput");const M=n.content;if(console.log("[onFinishEditing] cellContent.kind:",M.kind),M.kind===B.Text)s={...M,data:f,displayData:f};else if(M.kind===B.Number){const V=Number.parseFloat(f),$=Number.isNaN(V)?0:V;s={...M,data:$,displayData:$.toLocaleString()}}else M.kind===B.Uri?s={...M,data:f,displayData:f}:M.kind===B.Markdown&&(s={...M,data:f})}if(s!==void 0&&f.length===0)if(s.kind===B.Text&&s.data!==s.displayData)s={...s,displayData:s.data};else if(s.kind===B.Number){const M=s.data!==void 0?s.data.toLocaleString():"0";s.displayData!==M&&(s={...s,displayData:M})}else s.kind===B.Uri&&s.data!==s.displayData&&(s={...s,displayData:s.data});console.log("[onFinishEditing] finalValue:",s),console.log("[onFinishEditing] isEditableGridCell:",s!==void 0?$t(s):"N/A"),console.log("[onFinishEditing] condition check - cell:",n==null?void 0:n.cell,"finalValue:",s!==void 0,"isEditable:",s!==void 0&&$t(s));const a=n==null?void 0:n.content,u=()=>{if(s===void 0||a===void 0)return!1;if(s.kind!==a.kind)return!0;switch(s.kind){case B.Text:case B.Uri:case B.Markdown:return s.data!==a.data;case B.Number:return s.data!==a.data;case B.Boolean:return s.data!==a.data;default:return!0}};(n==null?void 0:n.cell)!==void 0&&s!==void 0&&$t(s)&&u()&&(console.log("[onFinishEditing] CALLING mangledOnCellsEdited with:",{location:n.cell,value:s}),Te([{location:n.cell,value:s}]),window.requestAnimationFrame(()=>{var M;(M=ae.current)==null||M.damage([{cell:n.cell}])})),(x=y.current)==null||x.clear(),(X=y.current)==null||X.setVisible(!1),W(!1),xe(!0),U.current=void 0,k(void 0);const[m,p]=o;if(h.current!==void 0&&(m!==0||p!==0)){const M=h.current.cell[1]===ke-1;if(M&&p===1){$e==null||$e(e,[0,0]);return}const V=h.current.cell[0]===J.length-1&&e!==void 0;let $=!0;if(M&&p===1&&it!==void 0){$=!1;const T=h.current.cell[0]+m,L=Bt(T);ht(L??T,!1)}if(V&&m===1&&st!==void 0){$=!1;const T=h.current.cell[1]+p;Vo(T,!1)}if($){const T=At(h.current.cell[0]+m,d,J.length-1),L=At(h.current.cell[1]+p,0,ke-1);mt(T,L,M,!1),window.requestAnimationFrame(()=>{var P;(P=y.current)==null||P.focus()})}}$e==null||$e(e,o)},[xe,h,$e,Te,ke,mt,J.length,ht,Vo,it,st,Bt,d]),ql=l.useMemo(()=>`gdg-overlay-${ec++}`,[]),Lt=l.useCallback(e=>{var n,i,s,f;xe();const o=[];for(let a=e.x;a<e.x+e.width;a++)for(let u=e.y;u<e.y+e.height;u++){const m=te([a-d,u]);if(!m.allowOverlay&&m.kind!==B.Boolean)continue;let p;if(m.kind===B.Custom){const C=Me(m),R=(n=C==null?void 0:C.provideEditor)==null?void 0:n.call(C,{...m,location:[a-d,u]});(C==null?void 0:C.onDelete)!==void 0?p=C.onDelete(m):Di(R)&&(p=(i=R==null?void 0:R.deletedValue)==null?void 0:i.call(R,m))}else if($t(m)&&m.allowOverlay||m.kind===B.Boolean){const C=Me(m);p=(s=C==null?void 0:C.onDelete)==null?void 0:s.call(C,m)}p!==void 0&&!Jo(p)&&$t(p)&&o.push({location:[a,u],value:p})}Te(o),(f=ae.current)==null||f.damage(o.map(a=>({cell:a.location})))},[xe,te,Me,Te,d]),fo=w!==void 0,fr=l.useCallback(e=>{var V,$,T,L;const o=()=>{e.stopPropagation(),e.preventDefault()},n={didMatch:!1},{bounds:i}=e,s=h.columns,f=h.rows,a=dt;if(!fo&&O(a.clear,e,n)){const P=((V=h.current)==null?void 0:V.cell)??[d,0];Pe({columns:ne.empty(),rows:ne.empty(),current:{cell:P,range:{x:P[0],y:P[1],width:1,height:1},rangeStack:[]}},!1),at==null||at(),xe()}else if(!fo&&O(a.selectAll,e,n))Pe({columns:ne.empty(),rows:ne.empty(),current:{cell:(($=h.current)==null?void 0:$.cell)??[d,0],range:{x:d,y:0,width:q.length,height:G},rangeStack:[]}},!1);else if(O(a.search,e,n))(T=D==null?void 0:D.current)==null||T.focus({preventScroll:!0}),Zn(!0);else if(O(a.delete,e,n)){const P=(ft==null?void 0:ft(h))??!0;if(P!==!1){const I=P===!0?h:P;if(I.current!==void 0){Lt(I.current.range);for(const oe of I.current.rangeStack)Lt(oe)}for(const oe of I.rows)Lt({x:d,y:oe,width:q.length,height:1});for(const oe of I.columns)Lt({x:oe,y:0,width:1,height:G})}}if(n.didMatch)return o(),!0;if(h.current===void 0)return!1;let[u,m]=h.current.cell;const[,p]=h.current.cell;let C=!1,R=!1;if(O(a.scrollToSelectedCell,e,n))Xo.current(u-d,m);else if(Fe!=="none"&&O(a.selectColumn,e,n))s.hasIndex(u)?ge(s.remove(u),void 0,!0):Fe==="single"?ge(ne.fromSingleSelection(u),void 0,!0):ge(void 0,u,!0);else if(Ae!=="none"&&O(a.selectRow,e,n))f.hasIndex(m)?Re(f.remove(m),void 0,!0):Ae==="single"?Re(ne.fromSingleSelection(m),void 0,!0):Re(void 0,m,!0);else if(!fo&&i!==void 0&&O(a.activateCell,e,n))if(m===G&&ce)window.setTimeout(()=>{const P=Bt(u);ht(P??u)},0);else{const P={inputType:"keyboard",key:e.key},I=ue([u,m]);console.log("[handleFixedKeybindings] activateCell triggered",{cellKind:I.kind,isBoolean:I.kind===B.Boolean,readonly:I.readonly,eventKey:e.key}),I.kind===B.Boolean&&I.readonly!==!0?(console.log("[handleFixedKeybindings] Boolean cell detected, handling Space/Enter"),A==null||A([u-d,m],P),e.key===" "?(console.log("[handleFixedKeybindings] Space key on Boolean cell - toggling value"),Te([{location:[u,m],value:{...I,data:xr(I.data)}}]),(L=ae.current)==null||L.damage([{cell:[u,m]}])):e.key==="Enter"&&(m+=1)):(A==null||A([u-d,m],P),Ue(i,P))}else h.current.range.height>1&&O(a.downFill,e,n)?ur():h.current.range.width>1&&O(a.rightFill,e,n)?ar():O(a.goToNextPage,e,n)?m+=Math.max(1,Ee.current.height-4):O(a.goToPreviousPage,e,n)?m-=Math.max(1,Ee.current.height-4):O(a.goToFirstCell,e,n)?(k(void 0),m=0,u=0):O(a.goToLastCell,e,n)?(k(void 0),m=Number.MAX_SAFE_INTEGER,u=Number.MAX_SAFE_INTEGER):O(a.selectToFirstCell,e,n)?(k(void 0),_e([-2,-2])):O(a.selectToLastCell,e,n)?(k(void 0),_e([2,2])):fo?(O(a.closeOverlay,e,n)&&k(void 0),O(a.acceptOverlayDown,e,n)&&(k(void 0),m++),O(a.acceptOverlayUp,e,n)&&(k(void 0),m--),O(a.acceptOverlayLeft,e,n)&&(k(void 0),u--),O(a.acceptOverlayRight,e,n)&&(k(void 0),u++)):(O(a.goDownCell,e,n)?m+=1:O(a.goUpCell,e,n)?m-=1:O(a.goRightCell,e,n)?u+=1:O(a.goLeftCell,e,n)?u-=1:O(a.goDownCellRetainSelection,e,n)?(m+=1,C=!0):O(a.goUpCellRetainSelection,e,n)?(m-=1,C=!0):O(a.goRightCellRetainSelection,e,n)?(u+=1,C=!0):O(a.goLeftCellRetainSelection,e,n)?(u-=1,C=!0):O(a.goToLastRow,e,n)?m=G-1:O(a.goToFirstRow,e,n)?m=Number.MIN_SAFE_INTEGER:O(a.goToLastColumn,e,n)?u=Number.MAX_SAFE_INTEGER:O(a.goToFirstColumn,e,n)?u=Number.MIN_SAFE_INTEGER:(kt==="rect"||kt==="multi-rect")&&(O(a.selectGrowDown,e,n)?_e([0,1]):O(a.selectGrowUp,e,n)?_e([0,-1]):O(a.selectGrowRight,e,n)?_e([1,0]):O(a.selectGrowLeft,e,n)?_e([-1,0]):O(a.selectToLastRow,e,n)?_e([0,2]):O(a.selectToFirstRow,e,n)?_e([0,-2]):O(a.selectToLastColumn,e,n)?_e([2,0]):O(a.selectToFirstColumn,e,n)&&_e([-2,0])),R=n.didMatch);if(Oe!==void 0&&Oe!=="normal"&&m!==p){const P=Oe==="skip-up"||Oe==="skip"||Oe==="block",I=Oe==="skip-down"||Oe==="skip"||Oe==="block",oe=m<p;if(oe&&P){for(;m>=0&&zt(m).isGroupHeader;)m--;m<0&&(m=p)}else if(!oe&&I){for(;m<G&&zt(m).isGroupHeader;)m++;m>=G&&(m=p)}}const X=mt(u,m,!1,C),M=n.didMatch;return M&&(X||!R||Pn)&&o(),M},[Oe,fo,h,dt,Fe,Ae,kt,d,zt,G,mt,Pe,at,q.length,ft,Pn,Lt,ge,Re,ce,Bt,ht,A,Ue,ur,ar,_e,ue,Te]),Dt=l.useCallback(e=>{let o=!1;if(qt!==void 0&&qt({...e,...e.location&&{location:[e.location[0]-d,e.location[1]]},cancel:()=>{o=!0}}),o||fr(e)||h.current===void 0)return;const[n,i]=h.current.cell,s=Ee.current,f=e.keyCode===229,a=Zt&&!e.metaKey&&!e.ctrlKey&&e.key.length===1&&/[\p{L}\p{M}\p{N}\p{S}\p{P}]/u.test(e.key);if((f||a)&&e.bounds!==void 0&&Ft(te([n-d,Math.max(0,Math.min(i,G-1))]))){if((!ce||i!==G)&&(s.y>i||i>s.y+s.height||s.x>n||n>s.x+s.width))return;if(e.stopPropagation(),e.preventDefault(),f){const u={inputType:"keyboard",key:""};A==null||A([n-d,i],u),Ue(e.bounds,u,"")}else{const u={inputType:"keyboard",key:e.key};A==null||A([n-d,i],u),Ue(e.bounds,u,e.key)}}},[Zt,qt,fr,h,te,d,G,ce,A,Ue]),Zl=l.useCallback((e,o)=>{var n;if(console.log("[onGhostInput] value:",e,"composing:",o,"overlay:",U.current!==void 0),U.current!==void 0){console.log("[onGhostInput] overlay already open, returning");return}if(!o&&e.length>0&&e.trim().length>0&&h.current!==void 0){const[i,s]=h.current.cell,f=ue([i,s]);if(f.kind===B.Custom)return;if(f.allowOverlay&&Ft(f)&&f.readonly!==!0){const a=(n=ae.current)==null?void 0:n.getBounds(i,s);if(a!==void 0){const u={inputType:"keyboard",key:e};A==null||A([i-d,s],u),Ue(a,u,e)}}}},[h,ue,d,A,Ue]),Jl=l.useCallback(()=>{var i,s,f,a,u;if(console.log("[onGhostCompositionStart] called"),console.log("[onGhostCompositionStart] gridSelection.current:",h.current),console.log("[onGhostCompositionStart] overlayRef.current:",U.current),h.current===void 0)return;const[e,o]=h.current.cell,n=(i=U.current)==null?void 0:i.cell;if(n!==void 0&&(n[0]!==e||n[1]!==o)&&(console.log("[onGhostCompositionStart] Different cell detected, closing previous overlay"),(s=y.current)==null||s.clear(),(f=y.current)==null||f.setVisible(!1),W(!1),U.current=void 0,k(void 0)),U.current===void 0){const m=ue([e,o]);if(m.kind===B.Custom)return;if(m.allowOverlay&&Ft(m)&&m.readonly!==!0){const p=(a=ae.current)==null?void 0:a.getBounds(e,o);if(p!==void 0){(u=y.current)==null||u.clear();const C={inputType:"keyboard",key:""};A==null||A([e-d,o],C),Ue(p,C,"")}}}},[h,ue,d,A,Ue]),Ql=l.useCallback(e=>{},[]),jl=l.useCallback(e=>{var f,a;if(console.log("[onGhostKeyDown] key:",e.key,"isComposing:",e.nativeEvent.isComposing),e.nativeEvent.isComposing){console.log("[onGhostKeyDown] IGNORED due to isComposing");return}if(U.current!==void 0&&Y.current){const u=e.key;if(u==="Escape"){e.preventDefault(),e.stopPropagation(),uo(void 0,[0,0]);return}if(u==="Enter"&&!e.shiftKey){e.preventDefault(),e.stopPropagation(),uo(void 0,[0,1]);return}if(u==="Tab"){e.preventDefault(),e.stopPropagation(),uo(void 0,e.shiftKey?[-1,0]:[1,0]);return}}{const u=e.key;if(u.length===1&&!e.ctrlKey&&!e.metaKey&&!e.altKey)if(u===" "&&h.current!==void 0){const p=h.current.cell,C=ue(p);if(!(C.kind===B.Boolean&&C.readonly!==!0))return}else return}if(U.current!==void 0&&Y.current){const u=e.key;if(u==="Backspace"||u==="Delete"||(u==="ArrowLeft"||u==="ArrowRight"||u==="ArrowUp"||u==="ArrowDown"||u==="Home"||u==="End"))return}const o=(f=h.current)==null?void 0:f.cell,n=o!==void 0?(a=ae.current)==null?void 0:a.getBounds(o[0],o[1]):void 0;let i=!1;const s={bounds:n,cancel:()=>{i=!0},stopPropagation:()=>e.stopPropagation(),preventDefault:()=>e.preventDefault(),ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,altKey:e.altKey,key:e.key,keyCode:e.keyCode,rawEvent:e,location:o};Dt(s),i&&(e.preventDefault(),e.stopPropagation())},[h,Dt,uo,ue]),ei=l.useCallback(e=>{var s,f;const o=(s=h.current)==null?void 0:s.cell,i={bounds:o!==void 0?(f=ae.current)==null?void 0:f.getBounds(o[0],o[1]):void 0,cancel:()=>{},stopPropagation:()=>e.stopPropagation(),preventDefault:()=>e.preventDefault(),ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,altKey:e.altKey,key:e.key,keyCode:e.keyCode,rawEvent:e,location:o};bt==null||bt(i)},[h,bt]),ti=l.useCallback(()=>{zn(!0)},[]),oi=l.useCallback(()=>{zn(!1)},[]),ni=l.useCallback((e,o)=>{const n=e.location[0]-d;if(e.kind==="header"&&(ye==null||ye(n,{...e,preventDefault:o})),e.kind===Xt){if(n<0)return;Se==null||Se(n,{...e,preventDefault:o})}if(e.kind==="cell"){const[i,s]=e.location;le==null||le([n,s],{...e,preventDefault:o}),Hi(h,e.location)||mt(i,s,!1,!1)}},[h,le,Se,ye,d,mt]),Tn=l.useCallback(async e=>{var a,u,m;if(!dt.paste)return;function o(p,C,R,x){var M,V;const X=typeof R=="object"?(R==null?void 0:R.join(`
`))??"":(R==null?void 0:R.toString())??"";if(!Jo(p)&&Ft(p)&&p.readonly!==!0){const $=Le==null?void 0:Le(X,p);if($!==void 0&&$t($))return{location:C,value:$};const T=Me(p);if(T===void 0)return;if(T.kind===B.Custom){jo(p.kind===B.Custom);const L=(M=T.onPaste)==null?void 0:M.call(T,X,p.data);return L===void 0?void 0:{location:C,value:{...p,data:L}}}else{const L=(V=T.onPaste)==null?void 0:V.call(T,X,p,{formatted:x,formattedString:typeof x=="string"?x:x==null?void 0:x.join(`
`),rawValue:R});return L===void 0?void 0:(jo(L.kind===p.kind),{location:C,value:L})}}}const n=h.columns,i=h.rows,s=((a=ee.current)==null?void 0:a.contains(document.activeElement))===!0||((u=b.current)==null?void 0:u.contains(document.activeElement))===!0;let f;if(h.current!==void 0?f=[h.current.range.x,h.current.range.y]:n.length===1?f=[n.first()??0,0]:i.length===1&&(f=[d,i.first()??0]),s&&f!==void 0){let p,C;const R="text/plain",x="text/html";if(navigator.clipboard.read!==void 0){const $=await navigator.clipboard.read();for(const T of $){if(T.types.includes(x)){const P=await(await T.getType(x)).text(),I=Mr(P);if(I!==void 0){p=I;break}}T.types.includes(R)&&(C=await(await T.getType(R)).text())}}else if(navigator.clipboard.readText!==void 0)C=await navigator.clipboard.readText();else if(e!==void 0&&(e==null?void 0:e.clipboardData)!==null){if(e.clipboardData.types.includes(x)){const $=e.clipboardData.getData(x);p=Mr($)}p===void 0&&e.clipboardData.types.includes(R)&&(C=e.clipboardData.getData(R))}else return;const[X,M]=f,V=[];do{if(Rt===void 0){const $=ue(f),T=C??(p==null?void 0:p.map(P=>P.map(I=>I.rawValue).join("	")).join("	"))??"",L=o($,f,T,void 0);L!==void 0&&V.push(L);break}if(p===void 0){if(C===void 0)return;p=Fi(C)}if(Rt===!1||typeof Rt=="function"&&(Rt==null?void 0:Rt([f[0]-d,f[1]],p.map($=>$.map(T=>{var L;return((L=T.rawValue)==null?void 0:L.toString())??""}))))!==!0)return;for(const[$,T]of p.entries()){if($+M>=G)break;for(const[L,P]of T.entries()){const I=[L+X,$+M],[oe,ze]=I;if(oe>=J.length||ze>=ke)continue;const Ie=ue(I),Ve=o(Ie,I,P.rawValue,P.formatted);Ve!==void 0&&V.push(Ve)}}}while(!1);Te(V),(m=ae.current)==null||m.damage(V.map($=>({cell:$.location})))}},[Le,Me,ue,h,dt.paste,ee,J.length,Te,ke,Rt,d,G]);Dn("paste",Tn,de,!1,!0);const ho=l.useCallback(async(e,o)=>{var a,u;if(!dt.copy)return;const n=o===!0||((a=ee.current)==null?void 0:a.contains(document.activeElement))===!0||((u=b.current)==null?void 0:u.contains(document.activeElement))===!0,i=h.columns,s=h.rows,f=(m,p)=>{if(!Gn)Sr(m,p,e);else{const C=p.map(R=>({kind:B.Text,data:q[R].title,displayData:q[R].title,allowOverlay:!1}));Sr([C,...m],p,e)}};if(n&&pe!==void 0){if(h.current!==void 0){let m=pe(h.current.range,Ke.current.signal);typeof m!="object"&&(m=await m()),f(m,Yt(h.current.range.x-d,h.current.range.x+h.current.range.width-d))}else if(s!==void 0&&s.length>0){const p=[...s].map(C=>{const R=pe({x:d,y:C,width:q.length,height:1},Ke.current.signal);return typeof R=="object"?R[0]:R().then(x=>x[0])});if(p.some(C=>C instanceof Promise)){const C=await Promise.all(p);f(C,Yt(q.length))}else f(p,Yt(q.length))}else if(i.length>0){const m=[],p=[];for(const C of i){let R=pe({x:C,y:0,width:1,height:G},Ke.current.signal);typeof R!="object"&&(R=await R()),m.push(R),p.push(C-d)}if(m.length===1)f(m[0],p);else{const C=m.reduce((R,x)=>R.map((X,M)=>[...X,...x[M]]));f(C,p)}}}},[q,pe,h,dt.copy,d,ee,G,Gn]);Dn("copy",ho,de,!1,!1);const ri=l.useCallback(async e=>{var n,i;if(!(!dt.cut||!(((n=ee.current)==null?void 0:n.contains(document.activeElement))===!0||((i=b.current)==null?void 0:i.contains(document.activeElement))===!0))&&(await ho(e),h.current!==void 0)){let s={current:{cell:h.current.cell,range:h.current.range,rangeStack:[]},rows:ne.empty(),columns:ne.empty()};const f=ft==null?void 0:ft(s);if(f===!1||(s=f===!0?s:f,s.current===void 0))return;Lt(s.current.range)}},[Lt,h,dt.cut,ho,ee,ft]);Dn("cut",ri,de,!1,!1);const li=l.useCallback((e,o)=>{if(je!==void 0){d!==0&&(e=e.map(s=>[s[0]-d,s[1]])),je(e,o);return}if(e.length===0||o===-1)return;const[n,i]=e[o];v.current!==void 0&&v.current[0]===n&&v.current[1]===i||(v.current=[n,i],mt(n,i,!1,!1))},[je,d,mt]),[Oo,_o]=((wr=Mt==null?void 0:Mt.current)==null?void 0:wr.cell)??[],Xo=l.useRef(ie);Xo.current=ie,l.useLayoutEffect(()=>{var e,o,n,i;En.current&&!Ao.current&&Oo!==void 0&&_o!==void 0&&(Oo!==((o=(e=$o.current)==null?void 0:e.current)==null?void 0:o.cell[0])||_o!==((i=(n=$o.current)==null?void 0:n.current)==null?void 0:i.cell[1]))&&Xo.current(Oo,_o),Ao.current=!1},[Oo,_o]);const hr=h.current!==void 0&&(h.current.cell[0]>=J.length||h.current.cell[1]>=ke);l.useLayoutEffect(()=>{hr&&Pe(Hn,!1)},[hr,Pe]);const ii=l.useMemo(()=>ce===!0&&(j==null?void 0:j.tint)===!0?ne.fromSingleSelection(ke-1):ne.empty(),[ke,ce,j==null?void 0:j.tint]),si=l.useCallback(e=>typeof Kt=="boolean"?Kt:(Kt==null?void 0:Kt(e-d))??!0,[d,Kt]),ci=l.useMemo(()=>{if(bn===void 0||b.current===null)return null;const{bounds:e,group:o}=bn,n=b.current.getBoundingClientRect();return l.createElement(Is,{bounds:e,group:o,canvasBounds:n,onClose:()=>xn(void 0),onFinish:i=>{xn(void 0),Qe==null||Qe(o,i)}})},[Qe,bn]),ai=Math.min(J.length,et+d);l.useImperativeHandle(r,()=>({appendRow:(e,o)=>ht(e+d,o),appendColumn:(e,o)=>Vo(e,o),updateCells:e=>{var o;return d!==0&&(e=e.map(n=>({cell:[n.cell[0]+d,n.cell[1]]}))),(o=ae.current)==null?void 0:o.damage(e)},getBounds:(e,o)=>{var n;if(!((b==null?void 0:b.current)===null||(ee==null?void 0:ee.current)===null)){if(e===void 0&&o===void 0){const i=b.current.getBoundingClientRect(),s=i.width/ee.current.clientWidth;return{x:i.x-ee.current.scrollLeft*s,y:i.y-ee.current.scrollTop*s,width:ee.current.scrollWidth*s,height:ee.current.scrollHeight*s}}return(n=ae.current)==null?void 0:n.getBounds((e??0)+d,o)}},focus:()=>{var e;return(e=ae.current)==null?void 0:e.focus()},emit:async e=>{switch(e){case"delete":Dt({bounds:void 0,cancel:()=>{},stopPropagation:()=>{},preventDefault:()=>{},ctrlKey:!1,key:"Delete",keyCode:46,metaKey:!1,shiftKey:!1,altKey:!1,rawEvent:void 0,location:void 0});break;case"fill-right":Dt({bounds:void 0,cancel:()=>{},stopPropagation:()=>{},preventDefault:()=>{},ctrlKey:!0,key:"r",keyCode:82,metaKey:!1,shiftKey:!1,altKey:!1,rawEvent:void 0,location:void 0});break;case"fill-down":Dt({bounds:void 0,cancel:()=>{},stopPropagation:()=>{},preventDefault:()=>{},ctrlKey:!0,key:"d",keyCode:68,metaKey:!1,shiftKey:!1,altKey:!1,rawEvent:void 0,location:void 0});break;case"copy":await ho(void 0,!0);break;case"paste":await Tn();break}},scrollTo:ie,remeasureColumns:e=>{for(const o of e)Bo(o+d)},getMouseArgsForPosition:(e,o,n)=>{if((ae==null?void 0:ae.current)===null)return;const i=ae.current.getMouseArgsForPosition(e,o,n);if(i!==void 0)return{...i,location:[i.location[0]-d,i.location[1]]}}}),[ht,Vo,Bo,ee,ho,Dt,Tn,d,ie]);const[gr,mr]=Ze??[],ui=l.useCallback(e=>{const[o,n]=e;if(n===-1){Fe!=="none"&&(ge(ne.fromSingleSelection(o),void 0,!1),xe());return}gr===o&&mr===n||(Ce({cell:e,range:{x:o,y:n,width:1,height:1}},!0,!1,"keyboard-nav"),ie(o,n))},[Fe,xe,ie,gr,mr,Ce,ge]),[di,zn]=l.useState(!1),vr=l.useRef(Vi(e=>{zn(e)},5)),fi=l.useCallback(()=>{vr.current(!0),h.current===void 0&&h.columns.length===0&&h.rows.length===0&&S===void 0&&Ce({cell:[d,Go],range:{x:d,y:Go,width:1,height:1}},!0,!1,"keyboard-select")},[Go,h,S,d,Ce]),hi=l.useCallback(()=>{vr.current(!1)},[]),[gi,mi]=l.useMemo(()=>{let e;const o=(he==null?void 0:he.scrollbarWidthOverride)??$i(),n=G+(ce?1:0);if(typeof ut=="number")e=io+n*ut;else{let s=0;const f=Math.min(n,10);for(let a=0;a<f;a++)s+=ut(a);s=Math.floor(s/f),e=io+n*s}e+=o;const i=J.reduce((s,f)=>f.width+s,0)+o;return[`${Math.min(1e5,i)}px`,`${Math.min(1e5,e)}px`]},[J,he==null?void 0:he.scrollbarWidthOverride,ut,G,ce,io]),vi=l.useMemo(()=>Ai(be),[be]);return l.createElement(Gi.Provider,{value:be},l.createElement(Ps,{style:vi,className:we,inWidth:Q??gi,inHeight:fe??mi},l.createElement(Es,{fillHandle:Yr,drawFocusRing:Bn,experimental:he,fixedShadowX:qr,fixedShadowY:Zr,getRowThemeOverride:nt,headerIcons:Jr,imageWindowLoader:Qr,initialSize:jr,isDraggable:el,onDragLeave:tl,onRowMoved:to,overscrollX:xl,overscrollY:kl,preventDiagonalScrolling:rl,rightElement:ll,rightElementProps:il,smoothScrollX:sl,smoothScrollY:cl,className:we,enableGroups:jn,onCanvasFocused:fi,onCanvasBlur:hi,canvasRef:b,onContextMenu:ni,theme:be,cellXOffset:$l,cellYOffset:Go,accessibilityHeight:Et.height,onDragEnd:Xl,columns:J,nonGrowWidth:Qn,drawHeader:Ll,onColumnProposeMove:Ul,drawCell:Dl,disabledRows:ii,freezeColumns:ai,lockColumns:d,firstColAccessible:d===0,getCellContent:ue,minColumnWidth:Nt,maxColumnWidth:Fo,searchInputRef:D,showSearch:Ml,onSearchClose:Sl,highlightRegions:Al,getCellsForSelection:pe,getGroupDetails:pn,headerHeight:Yn,isFocused:di,groupHeaderHeight:jn?gn:0,groupLevels:lo,groupHeaderHeights:er,freezeTrailingRows:tt+(ce&&(j==null?void 0:j.sticky)===!0?1:0),hasAppendRow:ce,onColumnResize:Wt,onColumnResizeEnd:zl,onColumnResizeStart:Il,onCellFocused:ui,onColumnMoved:Ol,onDragStart:_l,onHeaderMenuClick:Wl,onHeaderIndicatorClick:Vl,onItemHovered:Sn,isFilling:(S==null?void 0:S.fillHandle)===!0,onMouseMove:Nl,onKeyDown:Dt,onKeyUp:bt,onMouseDown:Gl,onMouseUp:Pl,onDragOverCell:_r,onDrop:Xr,onSearchResultsChanged:li,onVisibleRegionChanged:Bl,clientSize:mn,rowHeight:ut,searchResults:vo,searchValue:po,onSearchValueChange:on,rows:ke,scrollRef:ee,selection:h,translateX:Et.tx,translateY:Et.ty,verticalBorder:si,gridRef:ae,getCellRenderer:Me,resizeIndicator:gl}),ci,w!==void 0&&l.createElement(l.Suspense,{fallback:null},l.createElement(js,{...w,validateCell:Tl,bloom:Gt,id:ql,getCellRenderer:Me,className:(he==null?void 0:he.isSubGrid)===!0?"click-outside-ignore":void 0,provideEditor:Br,imageEditorOverride:ve,portalElementRef:Eo,onFinishEditing:uo,markdownDivCreateNode:z,isOutsideClick:hl,customEventTarget:he==null?void 0:he.eventTarget,isGhostMode:E}))),(()=>{const e=(Eo==null?void 0:Eo.current)??document.getElementById("portal");return e===null?null:Ci.createPortal(l.createElement(Qs,{ref:y,onInput:Zl,onCompositionStart:Jl,onCompositionEnd:Ql,onKeyDown:jl,onKeyUp:ei,onFocus:ti,onBlur:oi}),e)})())},nc=l.forwardRef(oc),rc=(t,r)=>{const c=l.useMemo(()=>({...bs,...t.headerIcons}),[t.headerIcons]),g=l.useMemo(()=>t.renderers??Ni,[t.renderers]),w=l.useMemo(()=>t.imageWindowLoader??new Wi,[t.imageWindowLoader]);return l.createElement(nc,{...t,renderers:g,headerIcons:c,ref:r,imageWindowLoader:w})},gc=l.forwardRef(rc);export{gc as D,vt as k,Xs as u};
