import{r}from"./iframe-CI-U1wEL.js";import{r as U}from"./index-4z8rmTOn.js";import{C as Z}from"./data-editor-all-rOHfFJK2.js";import{i as z,x as ee,H as te,T as re,N as ie}from"./image-window-loader-DSpFIgLX.js";import{s as se}from"./marked.esm-BmZ9459z.js";import"./preload-helper-C1FmrZbK.js";import"./throttle-CrC0zd7y.js";import"./flatten-Cjd8EGAb.js";import"./scrolling-data-grid-CsWNz2CK.js";const ne=()=>t=>t.targetX,oe=()=>t=>t.targetY,ae=()=>t=>t.targetWidth,le=()=>t=>t.targetHeight,ce=()=>t=>t.targetY+10,de=()=>t=>Math.max(0,(t.targetHeight-28)/2),ue=se("div")({name:"DataGridOverlayEditorStyle",class:"d16c1ze1",propsAsIs:!1,vars:{"d16c1ze1-0":[oe(),"px"],"d16c1ze1-1":[ne(),"px"],"d16c1ze1-2":[ae(),"px"],"d16c1ze1-3":[le(),"px"],"d16c1ze1-4":[ce(),"px"],"d16c1ze1-5":[de(),"px"]}});function fe(){const[t,n]=r.useState();return[t??void 0,n]}function ge(){const[t,n]=fe(),[s,v]=r.useState(0),[p,O]=r.useState(!0);r.useLayoutEffect(()=>{if(t===void 0||!("IntersectionObserver"in window))return;const o=new IntersectionObserver(a=>{a.length!==0&&O(a[0].isIntersecting)},{threshold:1});return o.observe(t),()=>o.disconnect()},[t]),r.useEffect(()=>{if(p||t===void 0)return;let o;const a=()=>{const{right:R}=t.getBoundingClientRect();v(m=>Math.min(m+window.innerWidth-R-10,0)),o=requestAnimationFrame(a)};return o=requestAnimationFrame(a),()=>{o!==void 0&&cancelAnimationFrame(o)}},[t,p]);const k=r.useMemo(()=>({transform:`translateX(${s}px)`}),[s]);return{ref:n,style:k}}const Se=t=>{const{target:n,content:s,onFinishEditing:v,forceEditMode:p,initialValue:O,imageEditorOverride:k,markdownDivCreateNode:o,highlight:a,className:R,theme:m,id:A,cell:h,bloom:u,portalElementRef:y,validateCell:l,getCellRenderer:T,provideEditor:E,isOutsideClick:V,customEventTarget:Y,activation:I}=t,[c,j]=r.useState(p?s:void 0),D=r.useRef(c??s);D.current=c??s;const[x,F]=r.useState(()=>l===void 0?!0:!(z(s)&&(l==null?void 0:l(h,s,D.current))===!1)),f=r.useCallback((e,i)=>{v(x?e:void 0,i)},[x,v]),K=r.useCallback(e=>{if(l!==void 0&&e!==void 0&&z(e)){const i=l(h,e,D.current);i===!1?F(!1):(typeof i=="object"&&(e=i),F(!0))}j(e)},[h,l]),C=r.useRef(!1),g=r.useRef(void 0),L=r.useCallback(()=>{f(c,[0,0]),C.current=!0},[c,f]),q=r.useCallback((e,i)=>{f(e,i??g.current??[0,0]),C.current=!0},[f]),B=r.useCallback(async e=>{if(e.nativeEvent.isComposing)return;let i=!1;e.key==="Escape"?(e.stopPropagation(),e.preventDefault(),g.current=[0,0]):e.key==="Enter"&&!e.shiftKey?(e.stopPropagation(),e.preventDefault(),g.current=[0,1],i=!0):e.key==="Tab"&&(e.stopPropagation(),e.preventDefault(),g.current=[e.shiftKey?-1:1,0],i=!0),window.setTimeout(()=>{!C.current&&g.current!==void 0&&(f(i?c:void 0,g.current),C.current=!0)},0)},[f,c]),P=c??s,[d,$]=r.useMemo(()=>{var S,X;if(ee(s))return[];const e={...s,location:h,activation:I},i=E==null?void 0:E(e);return i!==void 0?[i,!1]:[(X=(S=T(s))==null?void 0:S.provideEditor)==null?void 0:X.call(S,e),!1]},[h,s,T,E,I]),{ref:J,style:Q}=ge();let _=!0,H,M=!0,b;if(d!==void 0){_=d.disablePadding!==!0,M=d.disableStyling!==!0;const e=te(d);e&&(b=d.styleOverride);const i=e?d.editor:d;H=r.createElement(i,{portalElementRef:y,isHighlighted:a,activation:I,onChange:K,value:P,initialValue:O,onFinishedEditing:q,validatedSelection:z(P)?P.selectionRange:void 0,forceEditMode:p,target:n,imageEditorOverride:k,markdownDivCreateNode:o,isValid:x,theme:m})}b={...b,...Q};const G=(y==null?void 0:y.current)??document.getElementById("portal");if(G===null)return console.error('Cannot open Data Grid overlay editor, because portal not found. Please, either provide a portalElementRef or add `<div id="portal" />` as the last child of your `<body>`.'),null;let w=M?"gdg-style":"gdg-unstyle";x||(w+=" gdg-invalid"),_&&(w+=" gdg-pad");const N=(u==null?void 0:u[0])??1,W=(u==null?void 0:u[1])??1;return U.createPortal(r.createElement(re.Provider,{value:m},r.createElement(Z,{style:ie(m),className:R,onClickOutside:L,isOutsideClick:V,customEventTarget:Y},r.createElement(ue,{ref:J,id:A,className:w,style:b,as:$===!0?"label":void 0,targetX:n.x-N,targetY:n.y-W,targetWidth:n.width+N*2,targetHeight:n.height+W*2},r.createElement("div",{className:"gdg-clip-region",onKeyDown:B},H)))),G)};export{Se as default};
