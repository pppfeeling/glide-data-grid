import{R as C}from"./iframe-WMPUn1pL.js";const w=t=>{if(typeof t!="string"||t.length<10||!isNaN(Number(t)))return!1;const a=Date.parse(t);return!isNaN(a)},N=(t,a,e,r)=>{const n=t==null,o=a==null;if(n||o)return n&&o?0:r==="first"?n?-1:1:n?1:-1;if(typeof t=="number"&&typeof a=="number")return e==="asc"?t-a:a-t;if(t instanceof Date&&a instanceof Date)return e==="asc"?t.getTime()-a.getTime():a.getTime()-t.getTime();if(typeof t=="string"&&typeof a=="string"){const c=w(t),p=w(a);if(c&&p){const i=new Date(t).getTime(),u=new Date(a).getTime();return e==="asc"?i-u:u-i}return e==="asc"?t.localeCompare(a,"ko-KR"):a.localeCompare(t,"ko-KR")}const s=String(t),m=String(a);return e==="asc"?s.localeCompare(m,"ko-KR"):m.localeCompare(s,"ko-KR")},F=(t,a)=>{const{sortOptions:e,defaultNullsPosition:r="last"}=a;return!e||e.length===0?t:[...t].sort((n,o)=>{for(const s of e){const{key:m,order:c}=s,p=s.nullsPosition||r,i=N(n[m],o[m],c,p);if(i!==0)return i}return 0})},v=(t,a,e)=>{if(t==null)return!1;const r=String(t).toLowerCase(),n=String(e).toLowerCase();switch(a){case"Contain":return r.includes(n);case"Not Contain":return!r.includes(n);case"Equals":return r===n;case"NotEqual":return r!==n;case"StartWith":return r.startsWith(n);case"EndWith":return r.endsWith(n);case"Great":return parseFloat(t)>parseFloat(e);case"GreatWithEqual":return parseFloat(t)>=parseFloat(e);case"Less":return parseFloat(t)<parseFloat(e);case"LessWithEqual":return parseFloat(t)<=parseFloat(e);case"Between":if(Array.isArray(e)&&e.length===2){const o=parseFloat(t),s=parseFloat(e[0]),m=parseFloat(e[1]);return o>=s&&o<=m}return!1;default:return!1}},R=(t,a)=>{const{filterOptions:e}=a;return!e||e.length===0?t:t.filter(r=>{let n=!0,o="AND";for(let s=0;s<e.length;s++){const m=e[s],{key:c,operator:p,value:i,condition:u="AND"}=m,f=v(r[c],p,i);s===0?n=f:o==="AND"?n=n&&f:n=n||f,o=u}return n})};function D(t,a,e,r,n){if(a.length===0||t.length===0)return t.length>=2?t.map((i,u)=>({...i,rowspan:[n,n+t.length]})):[...t];const[o,...s]=a,m=[],c=new Map;for(const i of t){const u=i[o];c.has(u)||c.set(u,[]),c.get(u).push(i)}let p=0;for(const i of c.values()){const u=n+p,f=D(i,s,e,r+1,u);if(i.length>=2){const y=u+f.length;for(const h of f)!("isGroupSummary"in h)&&h.rowspan===void 0&&(h.rowspan=[u,y])}m.push(...f);const d=b(i,o,e,r);m.push(d),p=m.length}return m}function M(t,a,e){if(a.length===0||t.length===0)return{groupedData:[...t],groupHeaderIndexes:[]};const r=D(t,a,e,0,0),n=[];for(const[o,s]of r.entries())"isGroupSummary"in s&&s.isGroupSummary&&s.level===0&&n.push(o);return{groupedData:r,groupHeaderIndexes:n}}function b(t,a,e,r){const n=String(t[0][a]),o={isGroupSummary:!0,groupName:n,count:t.length,level:r};for(const s of e){const c=t.map(p=>p[s.column]).filter(p=>typeof p=="number");switch(s.type){case"sum":{o[s.id]=c.reduce((p,i)=>p+i,0);break}case"avg":{c.length>0?o[s.id]=c.reduce((p,i)=>p+i,0)/c.length:o[s.id]=0;break}case"min":{o[s.id]=Math.min(...c);break}case"max":{o[s.id]=Math.max(...c);break}case"count":{o[s.id]=t.length;break}case"label":{o[s.id]=s.label??n;break}}}return o}function x(t,a){const e={isTotalSummary:!0};for(const r of a)switch(r.type){case"label":{e[r.id]=r.label??"총합계";break}case"sum":case"avg":case"min":case"max":{const n=t.map(o=>o[r.column]).filter(o=>typeof o=="number");n.length>0&&(r.type==="sum"&&(e[r.id]=n.reduce((o,s)=>o+s,0)),r.type==="avg"&&(e[r.id]=n.reduce((o,s)=>o+s,0)/n.length),r.type==="min"&&(e[r.id]=Math.min(...n)),r.type==="max"&&(e[r.id]=Math.max(...n)));break}case"count":{e[r.id]=t.length;break}}return e}const G=(t,a)=>{const{filterConfig:e=null,sortState:r=[],groupingState:n=[],groupingFunctions:o=new Map,groupingLabels:s=new Map,showTotals:m=!1,cols:c}=a,{processedData:p,totalSummaryRow:i}=C.useMemo(()=>{let u=[...t];e&&e.filterOptions.length>0&&(u=R(u,e));const f=c.map(l=>{const g=o.get(l.title);return g?g==="label"?{id:l.id??l.title,column:l.id??l.title,type:"label",label:s==null?void 0:s.get(l.title)}:{id:l.id??l.title,column:l.id??l.title,type:g}:null}).filter(l=>l!==null);let d=null;m&&(d=x(u,f));const y=n.map(l=>{const g=r.find(k=>k.key===l);return{key:l,order:(g==null?void 0:g.order)??"asc"}}),h=r.filter(l=>!n.includes(l.key)),S=[...y,...h];if(S.length>0&&(u=F(u,{sortOptions:S})),n.length>0){const{groupedData:l}=M(u,n,f);return{processedData:l,totalSummaryRow:d}}return{processedData:u,totalSummaryRow:d}},[t,e,r,n,o,s,m,c]);return{processedData:p,totalSummaryRow:i}};export{G as u};
