import{r as t}from"./iframe-DNtM7szx.js";import{r as ie}from"./index-11sBGtDm.js";import{C as se}from"./data-editor-all-NenJfBez.js";import{E as G,G as j,s as ne,F as oe,T as ae,M as ce}from"./image-window-loader-V3wfVhga.js";import{s as le}from"./marked.esm-Bk15hlo4.js";import"./preload-helper-C1FmrZbK.js";import"./throttle-DwxcRZC0.js";import"./flatten-Cfvwb28E.js";import"./scrolling-data-grid-Cva-q6bk.js";const ue=()=>r=>r.targetX,de=()=>r=>r.targetY,fe=()=>r=>r.targetWidth,ge=()=>r=>r.targetHeight,pe=()=>r=>r.targetY+10,me=()=>r=>Math.max(0,(r.targetHeight-28)/2),he=le("div")({name:"DataGridOverlayEditorStyle",class:"d16c1ze1",propsAsIs:!1,vars:{"d16c1ze1-0":[de(),"px"],"d16c1ze1-1":[ue(),"px"],"d16c1ze1-2":[fe(),"px"],"d16c1ze1-3":[ge(),"px"],"d16c1ze1-4":[pe(),"px"],"d16c1ze1-5":[me(),"px"]}});function ve(){const[r,n]=t.useState();return[r??void 0,n]}function ye(){const[r,n]=ve(),[s,y]=t.useState(0),[m,O]=t.useState(!0);t.useLayoutEffect(()=>{if(r===void 0||!("IntersectionObserver"in window))return;const o=new IntersectionObserver(c=>{c.length!==0&&O(c[0].isIntersecting)},{threshold:1});return o.observe(r),()=>o.disconnect()},[r]),t.useEffect(()=>{if(m||r===void 0)return;let o;const c=()=>{const{right:I}=r.getBoundingClientRect();y(h=>Math.min(h+window.innerWidth-I-10,0)),o=requestAnimationFrame(c)};return o=requestAnimationFrame(c),()=>{o!==void 0&&cancelAnimationFrame(o)}},[r,m]);const R=t.useMemo(()=>({transform:`translateX(${s}px)`}),[s]);return{ref:n,style:R}}const Te=r=>{const{target:n,content:s,onFinishEditing:y,forceEditMode:m,initialValue:O,imageEditorOverride:R,markdownDivCreateNode:o,highlight:c,className:I,theme:h,id:q,cell:v,bloom:d,portalElementRef:E,validateCell:l,getCellRenderer:H,provideEditor:C,isOutsideClick:B,customEventTarget:w,activation:T}=r,[a,$]=t.useState(m?s:void 0),D=t.useRef(a??s);D.current=a??s;const[x,F]=t.useState(()=>l===void 0?!0:!(G(s)&&(l==null?void 0:l(v,s,D.current))===!1)),f=t.useCallback((e,i)=>{y(x?e:void 0,i)},[x,y]),M=t.useCallback(e=>{if((e==null?void 0:e.kind)===j.Text&&(_.current=e.data),l!==void 0&&e!==void 0&&G(e)){const i=l(v,e,D.current);i===!1?F(!1):(typeof i=="object"&&(e=i),F(!0))}$(e)},[v,l]),b=t.useRef(!1),g=t.useRef(void 0),S=t.useRef(!1),_=t.useRef(""),J=t.useCallback(()=>{f(a,[0,0]),b.current=!0},[a,f]),Q=t.useCallback((e,i)=>{f(e,i??g.current??[0,0]),b.current=!0},[f]),U=t.useCallback(async e=>{let i=!1;e.nativeEvent.isComposing||S.current||(e.key==="Escape"?(e.stopPropagation(),e.preventDefault(),g.current=[0,0]):e.key==="Enter"&&!e.shiftKey?(e.stopPropagation(),e.preventDefault(),g.current=[0,1],i=!0):e.key==="Tab"&&(e.stopPropagation(),e.preventDefault(),g.current=[e.shiftKey?-1:1,0],i=!0),g.current!==void 0&&window.setTimeout(()=>{b.current||(f(i?a:void 0,g.current??[0,0]),b.current=!0)},0))},[f,a]),V=t.useCallback(()=>{S.current=!0},[]),Z=t.useCallback(e=>{if(S.current=!1,e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement){_.current=e.target.value;const i=a??s;if(i.kind===j.Text){const p={...i,data:e.target.value};M(p)}}setTimeout(()=>{S.current=!1},10)},[a,s,M]),P=a??s,[u,ee]=t.useMemo(()=>{var p,Y;if(ne(s))return[];const e={...s,location:v,activation:T},i=C==null?void 0:C(e);return i!==void 0?[i,!1]:[(Y=(p=H(s))==null?void 0:p.provideEditor)==null?void 0:Y.call(p,e),!1]},[v,s,H,C,T]),{ref:te,style:re}=ye();let A=!0,L,W=!0,k;if(u!==void 0){A=u.disablePadding!==!0,W=u.disableStyling!==!0;const e=oe(u);e&&(k=u.styleOverride);const i=e?u.editor:u;L=t.createElement(i,{portalElementRef:E,isHighlighted:c,activation:T,onChange:M,value:P,initialValue:O,onFinishedEditing:Q,validatedSelection:G(P)?P.selectionRange:void 0,forceEditMode:m,target:n,imageEditorOverride:R,markdownDivCreateNode:o,isValid:x,theme:h})}k={...k,...re};const X=(E==null?void 0:E.current)??document.getElementById("portal");if(X===null)return console.error('Cannot open Data Grid overlay editor, because portal not found. Please, either provide a portalElementRef or add `<div id="portal" />` as the last child of your `<body>`.'),null;let z=W?"gdg-style":"gdg-unstyle";x||(z+=" gdg-invalid"),A&&(z+=" gdg-pad");const K=(d==null?void 0:d[0])??1,N=(d==null?void 0:d[1])??1;return ie.createPortal(t.createElement(ae.Provider,{value:h},t.createElement(se,{style:ce(h),className:I,onClickOutside:J,isOutsideClick:B,customEventTarget:w},t.createElement(he,{ref:te,id:q,className:z,style:k,as:ee===!0?"label":void 0,targetX:n.x-K,targetY:n.y-N,targetWidth:n.width+K*2,targetHeight:n.height+N*2},t.createElement("div",{className:"gdg-clip-region",onKeyDown:U,onCompositionStart:V,onCompositionEnd:Z},L)))),X)};export{Te as default};
