import{r}from"./iframe-DXOPYGgQ.js";import{r as U}from"./index-ngu0pMN8.js";import{i as T,a as Z,b as ee,T as te,C as re,m as ne}from"./cell.stories-BXejJSQe.js";import{s as ie}from"./index-bI8WdHuM.js";import"./preload-helper-C1FmrZbK.js";import"./throttle-BQcim7ej.js";import"./toConsumableArray-Cg7-Q_9P.js";import"./flatten-B5nYkQZa.js";import"./marked.esm-BwtchnN9.js";import"./throttle--dN168Gr.js";const se=()=>t=>t.targetX,ae=()=>t=>t.targetY,oe=()=>t=>t.targetWidth,de=()=>t=>t.targetHeight,le=()=>t=>t.targetY+10,ue=()=>t=>Math.max(0,(t.targetHeight-28)/2),ce=ie("div")({name:"DataGridOverlayEditorStyle",class:"gdg-d19meir1",propsAsIs:!1,vars:{"d19meir1-0":[ae(),"px"],"d19meir1-1":[se(),"px"],"d19meir1-2":[oe(),"px"],"d19meir1-3":[de(),"px"],"d19meir1-4":[le(),"px"],"d19meir1-5":[ue(),"px"]}});function fe(){const[t,s]=r.useState();return[t??void 0,s]}function me(){const[t,s]=fe(),[i,y]=r.useState(0),[g,S]=r.useState(!0);r.useLayoutEffect(()=>{if(t===void 0||!("IntersectionObserver"in window))return;const a=new IntersectionObserver(o=>{o.length!==0&&S(o[0].isIntersecting)},{threshold:1});return a.observe(t),()=>a.disconnect()},[t]),r.useEffect(()=>{if(g||t===void 0)return;let a;const o=()=>{const{right:R}=t.getBoundingClientRect();y(p=>Math.min(p+window.innerWidth-R-10,0)),a=requestAnimationFrame(o)};return a=requestAnimationFrame(o),()=>{a!==void 0&&cancelAnimationFrame(a)}},[t,g]);const k=r.useMemo(()=>({transform:`translateX(${i}px)`}),[i]);return{ref:s,style:k}}const Se=t=>{const{target:s,content:i,onFinishEditing:y,forceEditMode:g,initialValue:S,imageEditorOverride:k,markdownDivCreateNode:a,highlight:o,className:R,theme:p,id:A,cell:h,bloom:c,portalElementRef:E,validateCell:d,getCellRenderer:M,provideEditor:v,isOutsideClick:K,customEventTarget:Y,activation:D}=t,[l,j]=r.useState(g?i:void 0),I=r.useRef(l??i);I.current=l??i;const[C,w]=r.useState(()=>d===void 0?!0:!(T(i)&&(d==null?void 0:d(h,i,I.current))===!1)),f=r.useCallback((e,n)=>{y(C?e:void 0,n)},[C,y]),L=r.useCallback(e=>{if(d!==void 0&&e!==void 0&&T(e)){const n=d(h,e,I.current);n===!1?w(!1):(typeof n=="object"&&(e=n),w(!0))}j(e)},[h,d]),b=r.useRef(!1),m=r.useRef(void 0),q=r.useCallback(()=>{f(l,[0,0]),b.current=!0},[l,f]),B=r.useCallback((e,n)=>{f(e,n??m.current??[0,0]),b.current=!0},[f]),$=r.useCallback(async e=>{let n=!1;e.key==="Escape"?(e.stopPropagation(),e.preventDefault(),m.current=[0,0]):e.key==="Enter"&&!e.shiftKey?(e.stopPropagation(),e.preventDefault(),m.current=[0,1],n=!0):e.key==="Tab"&&(e.stopPropagation(),e.preventDefault(),m.current=[e.shiftKey?-1:1,0],n=!0),window.setTimeout(()=>{!b.current&&m.current!==void 0&&(f(n?l:void 0,m.current),b.current=!0)},0)},[f,l]),F=l??i,[u,z]=r.useMemo(()=>{var O,X;if(Z(i))return[];const e={...i,location:h,activation:D},n=v==null?void 0:v(e);return n!==void 0?[n,!1]:[(X=(O=M(i))==null?void 0:O.provideEditor)==null?void 0:X.call(O,e),!1]},[h,i,M,v,D]),{ref:J,style:Q}=me();let _=!0,N,V=!0,x;if(u!==void 0){_=u.disablePadding!==!0,V=u.disableStyling!==!0;const e=ee(u);e&&(x=u.styleOverride);const n=e?u.editor:u;N=r.createElement(n,{portalElementRef:E,isHighlighted:o,activation:D,onChange:L,value:F,initialValue:S,onFinishedEditing:B,validatedSelection:T(F)?F.selectionRange:void 0,forceEditMode:g,target:s,imageEditorOverride:k,markdownDivCreateNode:a,isValid:C,theme:p})}x={...x,...Q};const G=(E==null?void 0:E.current)??document.getElementById("portal");if(G===null)return console.error('Cannot open Data Grid overlay editor, because portal not found. Please, either provide a portalElementRef or add `<div id="portal" />` as the last child of your `<body>`.'),null;let P=V?"gdg-style":"gdg-unstyle";C||(P+=" gdg-invalid"),_&&(P+=" gdg-pad");const H=(c==null?void 0:c[0])??1,W=(c==null?void 0:c[1])??1;return U.createPortal(r.createElement(te.Provider,{value:p},r.createElement(re,{style:ne(p),className:R,onClickOutside:q,isOutsideClick:K,customEventTarget:Y},r.createElement(ce,{ref:J,id:A,className:P,style:x,as:z===!0?"label":void 0,targetX:s.x-H,targetY:s.y-W,targetWidth:s.width+H*2,targetHeight:s.height+W*2},r.createElement("div",{className:"gdg-clip-region",onKeyDown:$},N)))),G)};export{Se as default};
