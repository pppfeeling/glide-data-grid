const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./image-window-loader-DJOs-Z_J.js","./iframe-WMPUn1pL.js","./preload-helper-C1FmrZbK.js","./throttle-Bd7MXYl9.js","./marked.esm-09Xzqy-J.js","./index-VmO6qoem.js","./image-window-loader-Bm61kU6i.css"])))=>i.map(i=>d[i]);
import{r as l,R as ge}from"./iframe-WMPUn1pL.js";import{_ as vi}from"./preload-helper-C1FmrZbK.js";import{r as pi}from"./index-VmO6qoem.js";import{G as Q,d as jo,e as Ci,f as Zo,r as yr,h as en,C as oe,g as zr,j as wi,w as Ct,k as yi,l as bi,m as Ln,n as br,I as Ht,p as xi,o as ki,t as Ri,q as Mi,s as Xt,v as xr,x as Si,y as Jo,z as Ft,A as Ei,B as Ti,D as zi,E as Ii,F as Li,H as kr,i as $t,J as Di,K as Hi,L as Rr,M as Fi,b as Dn,N as $i,O as Ai,T as Gi,P as Ki,Q as Pi,R as Mr,S as Ni,U as Wi}from"./image-window-loader-DJOs-Z_J.js";import{m as At,r as Yt,g as Vi}from"./throttle-Bd7MXYl9.js";import{u as Oi,f as Sr}from"./flatten-CfNc2yDy.js";import{G as Bi}from"./scrolling-data-grid-DQxfRL_g.js";import{s as tn}from"./marked.esm-09Xzqy-J.js";const ne='<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg">',Ui=t=>{const r=t.fgColor,c=t.bgColor;return`
    ${ne}<rect x="2" y="2" width="16" height="16" rx="2" fill="${c}"/><path d="M15.75 4h-1.5a.25.25 0 0 0-.177.074L9.308 8.838a3.75 3.75 0 1 0 1.854 1.854l1.155-1.157.967.322a.5.5 0 0 0 .65-.55l-.18-1.208.363-.363.727.331a.5.5 0 0 0 .69-.59l-.254-.904.647-.647A.25.25 0 0 0 16 5.75v-1.5a.25.25 0 0 0-.25-.25zM7.5 13.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0z" fill="${r}"/></svg>`},_i=t=>{const r=t.fgColor,c=t.bgColor;return`
    ${ne}<rect x="2" y="2" width="16" height="16" rx="4" fill="${c}"/><path d="m12.223 13.314 3.052-2.826a.65.65 0 0 0 0-.984l-3.052-2.822c-.27-.25-.634-.242-.865.022-.232.263-.206.636.056.882l2.601 2.41-2.601 2.41c-.262.245-.288.619-.056.882.231.263.595.277.865.026Zm-4.444.005c.266.25.634.241.866-.027.231-.263.206-.636-.06-.882L5.983 10l2.602-2.405c.266-.25.291-.62.06-.887-.232-.263-.596-.272-.866-.022L4.723 9.51a.653.653 0 0 0 0 .983l3.056 2.827Z" fill="${r}"/></svg>`},Xi=t=>{const r=t.fgColor,c=t.bgColor;return`${ne}
    <path d="M16.22 2H3.78C2.8 2 2 2.8 2 3.78v12.44C2 17.2 2.8 18 3.78 18h12.44c.98 0 1.77-.8 1.77-1.78L18 3.78C18 2.8 17.2 2 16.22 2z" fill="${c}"/>
    <path d="M6.52 12.78H5.51V8.74l-1.33.47v-.87l2.29-.83h.05v5.27zm5.2 0H8.15v-.69l1.7-1.83a6.38 6.38 0 0 0 .34-.4c.09-.11.16-.22.22-.32s.1-.19.12-.27a.9.9 0 0 0 0-.56.63.63 0 0 0-.15-.23.58.58 0 0 0-.22-.15.75.75 0 0 0-.29-.05c-.27 0-.48.08-.62.23a.95.95 0 0 0-.2.65H8.03c0-.24.04-.46.13-.67a1.67 1.67 0 0 1 .97-.91c.23-.1.49-.14.77-.14.26 0 .5.04.7.11.21.08.38.18.52.32.14.13.25.3.32.48a1.74 1.74 0 0 1 .03 1.13 2.05 2.05 0 0 1-.24.47 4.16 4.16 0 0 1-.35.47l-.47.5-1 1.05h2.32v.8zm1.8-3.08h.55c.28 0 .48-.06.61-.2a.76.76 0 0 0 .2-.55.8.8 0 0 0-.05-.28.56.56 0 0 0-.13-.22.6.6 0 0 0-.23-.15.93.93 0 0 0-.32-.05.92.92 0 0 0-.29.05.72.72 0 0 0-.23.12.57.57 0 0 0-.21.46H12.4a1.3 1.3 0 0 1 .5-1.04c.15-.13.33-.23.54-.3a2.48 2.48 0 0 1 1.4 0c.2.06.4.15.55.28.15.13.27.28.36.47.08.19.13.4.13.65a1.15 1.15 0 0 1-.2.65 1.36 1.36 0 0 1-.58.49c.15.05.28.12.38.2a1.14 1.14 0 0 1 .43.62c.03.13.05.26.05.4 0 .25-.05.47-.14.66a1.42 1.42 0 0 1-.4.49c-.16.13-.35.23-.58.3a2.51 2.51 0 0 1-.73.1c-.22 0-.44-.03-.65-.09a1.8 1.8 0 0 1-.57-.28 1.43 1.43 0 0 1-.4-.47 1.41 1.41 0 0 1-.15-.66h1a.66.66 0 0 0 .22.5.87.87 0 0 0 .58.2c.25 0 .45-.07.6-.2a.71.71 0 0 0 .21-.56.97.97 0 0 0-.06-.36.61.61 0 0 0-.18-.25.74.74 0 0 0-.28-.15 1.33 1.33 0 0 0-.37-.04h-.55V9.7z" fill="${r}"/>
  </svg>`},Yi=t=>{const r=t.fgColor,c=t.bgColor;return`${ne}
  <path d="M16.222 2H3.778C2.8 2 2 2.8 2 3.778v12.444C2 17.2 2.8 18 3.778 18h12.444c.978 0 1.77-.8 1.77-1.778L18 3.778C18 2.8 17.2 2 16.222 2z" fill="${c}"/>
  <path d="M8.182 12.4h3.636l.655 1.6H14l-3.454-8H9.455L6 14h1.527l.655-1.6zM10 7.44l1.36 3.651H8.64L10 7.441z" fill="${r}"/>
</svg>`},qi=t=>{const r=t.fgColor,c=t.bgColor;return`${ne}
    <path
        d="M16.2222 2H3.77778C2.8 2 2 2.8 2 3.77778V16.2222C2 17.2 2.8 18 3.77778 18H16.2222C17.2 18 17.9911 17.2 17.9911 16.2222L18 3.77778C18 2.8 17.2 2 16.2222 2Z"
        fill="${c}"
    />
    <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M7.66667 6.66669C5.73368 6.66669 4.16667 8.15907 4.16667 10C4.16667 11.841 5.73368 13.3334 7.66667 13.3334H12.3333C14.2663 13.3334 15.8333 11.841 15.8333 10C15.8333 8.15907 14.2663 6.66669 12.3333 6.66669H7.66667ZM12.5 12.5C13.8807 12.5 15 11.3807 15 10C15 8.61931 13.8807 7.50002 12.5 7.50002C11.1193 7.50002 10 8.61931 10 10C10 11.3807 11.1193 12.5 12.5 12.5Z"
        fill="${r}"
    />
</svg>`},Ir=t=>{const r=t.fgColor,c=t.bgColor;return`${ne}
<path d="M16.222 2H3.778C2.8 2 2 2.8 2 3.778v12.444C2 17.2 2.8 18 3.778 18h12.444c.978 0 1.77-.8 1.77-1.778L18 3.778C18 2.8 17.2 2 16.222 2z" fill="${c}"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M10.29 4.947a3.368 3.368 0 014.723.04 3.375 3.375 0 01.041 4.729l-.009.009-1.596 1.597a3.367 3.367 0 01-5.081-.364.71.71 0 011.136-.85 1.95 1.95 0 002.942.21l1.591-1.593a1.954 1.954 0 00-.027-2.733 1.95 1.95 0 00-2.732-.027l-.91.907a.709.709 0 11-1.001-1.007l.915-.911.007-.007z" fill="${r}"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M6.55 8.678a3.368 3.368 0 015.082.364.71.71 0 01-1.136.85 1.95 1.95 0 00-2.942-.21l-1.591 1.593a1.954 1.954 0 00.027 2.733 1.95 1.95 0 002.73.028l.906-.906a.709.709 0 111.003 1.004l-.91.91-.008.01a3.368 3.368 0 01-4.724-.042 3.375 3.375 0 01-.041-4.728l.009-.009L6.55 8.678z" fill="${r}"/>
</svg>
  `},Zi=t=>{const r=t.bgColor;return`${ne}
    <path stroke="${r}" stroke-width="2" d="M12 3v14"/>
    <path stroke="${r}" stroke-width="2" stroke-linecap="round" d="M10 4h4m-4 12h4"/>
    <path d="M11 14h4a3 3 0 0 0 3-3V9a3 3 0 0 0-3-3h-4v2h4a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-4v2ZM9.5 8H5a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h4.5v2H5a3 3 0 0 1-3-3V9a3 3 0 0 1 3-3h4.5v2Z" fill="${r}"/>
  </svg>
`},Ji=Ir,Qi=t=>{const r=t.fgColor,c=t.bgColor;return`${ne}
  <path d="M16.222 2H3.778C2.8 2 2 2.8 2 3.778v12.444C2 17.2 2.8 18 3.778 18h12.444c.978 0 1.77-.8 1.77-1.778L18 3.778C18 2.8 17.2 2 16.222 2z" fill="${c}"/>
  <path fill-rule="evenodd" clip-rule="evenodd" d="M7 13.138a.5.5 0 00.748.434l5.492-3.138a.5.5 0 000-.868L7.748 6.427A.5.5 0 007 6.862v6.276z" fill="${r}"/>
</svg>`},ji=t=>{const r=t.fgColor,c=t.bgColor;return`
    ${ne}
    <path d="M10 5a5 5 0 1 0 0 10 5 5 0 0 0 0-10zm0 9.17A4.17 4.17 0 0 1 5.83 10 4.17 4.17 0 0 1 10 5.83 4.17 4.17 0 0 1 14.17 10 4.17 4.17 0 0 1 10 14.17z" fill="${r}"/>
    <path d="M8.33 8.21a.83.83 0 1 0-.03 1.67.83.83 0 0 0 .03-1.67zm3.34 0a.83.83 0 1 0-.04 1.67.83.83 0 0 0 .04-1.67z" fill="${r}"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M14.53 13.9a2.82 2.82 0 0 1-5.06 0l.77-.38a1.97 1.97 0 0 0 3.52 0l.77.39z" fill="${r}"/>
    <path d="M16.22 2H3.78C2.8 2 2 2.8 2 3.78v12.44C2 17.2 2.8 18 3.78 18h12.44c.98 0 1.77-.8 1.77-1.78L18 3.78C18 2.8 17.2 2 16.22 2z" fill="${c}"/>
    <path d="M10 4a6 6 0 1 0 0 12 6 6 0 0 0 0-12zm0 11a5 5 0 1 1 .01-10.01A5 5 0 0 1 10 15z" fill="${r}"/>
    <path d="M8 7.86a1 1 0 1 0-.04 2 1 1 0 0 0 .04-2zm4 0a1 1 0 1 0-.04 2 1 1 0 0 0 .04-2z" fill="${r}"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M12.53 11.9a2.82 2.82 0 0 1-5.06 0l.77-.38a1.97 1.97 0 0 0 3.52 0l.77.39z" fill="${r}"/>
  </svg>`},es=t=>{const r=t.fgColor,c=t.bgColor;return`${ne}
  <path d="M16.222 2H3.778C2.8 2 2 2.8 2 3.778v12.444C2 17.2 2.8 18 3.778 18h12.444c.978 0 1.77-.8 1.77-1.778L18 3.778C18 2.8 17.2 2 16.222 2z" fill="${c}"/>
  <path opacity=".5" fill-rule="evenodd" clip-rule="evenodd" d="M12.499 10.801a.5.5 0 01.835 0l2.698 4.098a.5.5 0 01-.418.775H10.22a.5.5 0 01-.417-.775l2.697-4.098z" fill="${r}"/>
  <path fill-rule="evenodd" clip-rule="evenodd" d="M8.07 8.934a.5.5 0 01.824 0l4.08 5.958a.5.5 0 01-.412.782h-8.16a.5.5 0 01-.413-.782l4.08-5.958zM13.75 8.333a2.083 2.083 0 100-4.166 2.083 2.083 0 000 4.166z" fill="${r}"/>
</svg>`},ts=t=>{const r=t.fgColor,c=t.bgColor;return`
    ${ne}
    <path fill="${r}" d="M3 3h14v14H3z"/>
    <path d="M16.22 2H3.78C2.8 2 2 2.8 2 3.78v12.44C2 17.2 2.8 18 3.78 18h12.44c.98 0 1.77-.8 1.77-1.78L18 3.78C18 2.8 17.2 2 16.22 2zm-7.24 9.78h1.23c.15 0 .27.06.36.18l.98 1.28a.43.43 0 0 1-.05.58l-1.2 1.21a.45.45 0 0 1-.6.04A6.72 6.72 0 0 1 7.33 10c0-.61.1-1.2.25-1.78a6.68 6.68 0 0 1 2.12-3.3.44.44 0 0 1 .6.04l1.2 1.2c.16.17.18.42.05.59l-.98 1.29a.43.43 0 0 1-.36.17H8.98A5.38 5.38 0 0 0 8.67 10c0 .62.11 1.23.3 1.79z" fill="${c}"/>
  </svg>`},os=t=>{const r=t.fgColor,c=t.bgColor;return`
    ${ne}
    <path d="M16.22 2H3.78C2.8 2 2 2.8 2 3.78v12.44C2 17.2 2.8 18 3.78 18h12.44c.98 0 1.77-.8 1.77-1.78L18 3.78C18 2.8 17.2 2 16.22 2z" fill="${c}"/>
    <path d="m13.49 13.15-2.32-3.27h1.4V7h1.86v2.88h1.4l-2.34 3.27zM11 13H9v-3l-1.5 1.92L6 10v3H4V7h2l1.5 2L9 7h2v6z" fill="${r}"/>
  </svg>`},ns=t=>{const r=t.fgColor,c=t.bgColor;return`${ne}
  <path d="M16.222 2H3.778C2.8 2 2 2.8 2 3.778v12.444C2 17.2 2.8 18 3.778 18h12.444c.978 0 1.77-.8 1.77-1.778L18 3.778C18 2.8 17.2 2 16.222 2z" fill="${c}"/>
  <path d="M14.8 4.182h-.6V3H13v1.182H7V3H5.8v1.182h-.6c-.66 0-1.2.532-1.2 1.182v9.454C4 15.468 4.54 16 5.2 16h9.6c.66 0 1.2-.532 1.2-1.182V5.364c0-.65-.54-1.182-1.2-1.182zm0 10.636H5.2V7.136h9.6v7.682z" fill="${r}"/>
</svg>`},rs=t=>{const r=t.fgColor,c=t.bgColor;return`
    ${ne}
    <path d="M16.22 2H3.78C2.8 2 2 2.8 2 3.78v12.44C2 17.2 2.8 18 3.78 18h12.44c.98 0 1.77-.8 1.77-1.78L18 3.78C18 2.8 17.2 2 16.22 2z" fill="${c}"/>
    <path d="M10 4a6 6 0 0 0-6 6 6 6 0 0 0 6 6 6 6 0 0 0 6-6 6 6 0 0 0-6-6zm0 10.8A4.8 4.8 0 0 1 5.2 10a4.8 4.8 0 1 1 4.8 4.8z" fill="${r}"/>
    <path d="M10 7H9v3.93L12.5 13l.5-.8-3-1.76V7z" fill="${r}"/>
  </svg>`},ls=t=>{const r=t.fgColor,c=t.bgColor;return`${ne}
  <rect x="2" y="2" width="16" height="16" rx="2" fill="${c}"/>
  <path fill-rule="evenodd" clip-rule="evenodd" d="M10 8.643a1.357 1.357 0 100 2.714 1.357 1.357 0 000-2.714zM7.357 10a2.643 2.643 0 115.286 0 2.643 2.643 0 01-5.286 0z" fill="${r}"/>
  <path fill-rule="evenodd" clip-rule="evenodd" d="M7.589 4.898A5.643 5.643 0 0115.643 10v.5a2.143 2.143 0 01-4.286 0V8a.643.643 0 011.286 0v2.5a.857.857 0 001.714 0V10a4.357 4.357 0 10-1.708 3.46.643.643 0 01.782 1.02 5.643 5.643 0 11-5.842-9.582z" fill="${r}"/>
</svg>`},is=t=>{const r=t.fgColor,c=t.bgColor;return`
    ${ne}
    <rect x="2" y="8" width="10" height="8" rx="2" fill="${c}"/>
    <rect x="8" y="4" width="10" height="8" rx="2" fill="${c}"/>
    <path d="M10.68 7.73V6l2.97 3.02-2.97 3.02v-1.77c-2.13 0-3.62.7-4.68 2.2.43-2.15 1.7-4.31 4.68-4.74z" fill="${r}"/>
  </svg>`},ss=t=>{const r=t.fgColor,c=t.bgColor;return`${ne}
  <path fill="${r}" d="M4 3h12v14H4z"/>
  <path fill-rule="evenodd" clip-rule="evenodd" d="M3.6 2A1.6 1.6 0 002 3.6v12.8A1.6 1.6 0 003.6 18h12.8a1.6 1.6 0 001.6-1.6V3.6A1.6 1.6 0 0016.4 2H3.6zm11.3 10.8a.7.7 0 01.7.7v1.4a.7.7 0 01-.7.7h-1.4a.7.7 0 01-.7-.7v-1.4a.7.7 0 01.6-.693.117.117 0 00.1-.115V10.35a.117.117 0 00-.117-.116h-2.8a.117.117 0 00-.117.116v2.333c0 .064.053.117.117.117h.117a.7.7 0 01.7.7v1.4a.7.7 0 01-.7.7H9.3a.7.7 0 01-.7-.7v-1.4a.7.7 0 01.7-.7h.117a.117.117 0 00.117-.117V10.35a.117.117 0 00-.117-.117h-2.8a.117.117 0 00-.117.117v2.342c0 .058.042.106.1.115a.7.7 0 01.6.693v1.4a.7.7 0 01-.7.7H5.1a.7.7 0 01-.7-.7v-1.4a.7.7 0 01.7-.7h.35a.116.116 0 00.116-.117v-2.45c0-.515.418-.933.934-.933h2.917a.117.117 0 00.117-.117V6.85a.117.117 0 00-.117-.116h-2.45a.7.7 0 01-.7-.7V5.1a.7.7 0 01.7-.7h6.067a.7.7 0 01.7.7v.934a.7.7 0 01-.7.7h-2.45a.117.117 0 00-.118.116v2.333c0 .064.053.117.117.117H13.5c.516 0 .934.418.934.934v2.45c0 .063.052.116.116.116h.35z" fill="${c}"/>
</svg>`},cs=t=>{const r=t.fgColor,c=t.bgColor;return`
    ${ne}
    <rect x="2" y="2" width="16" height="16" rx="2" fill="${c}"/>
    <path d="M9.98 13.33c.45 0 .74-.3.73-.75l-.01-.1-.16-1.67 1.45 1.05a.81.81 0 0 0 .5.18c.37 0 .72-.32.72-.76 0-.3-.17-.54-.49-.68l-1.63-.77 1.63-.77c.32-.14.49-.37.49-.67 0-.45-.34-.76-.71-.76a.81.81 0 0 0-.5.18l-1.47 1.03.16-1.74.01-.08c.01-.46-.27-.76-.72-.76-.46 0-.76.32-.75.76l.01.08.16 1.74-1.47-1.03a.77.77 0 0 0-.5-.18.74.74 0 0 0-.72.76c0 .3.17.53.49.67l1.63.77-1.62.77c-.32.14-.5.37-.5.68 0 .44.35.75.72.75a.78.78 0 0 0 .5-.17L9.4 10.8l-.16 1.68v.09c-.02.44.28.75.74.75z" fill="${r}"/>
  </svg>`},as=t=>{const r=t.fgColor,c=t.bgColor;return`
    ${ne}
    <rect x="2" y="2" width="16" height="16" rx="2" fill="${c}"/>
    <path d="M8 5.83H5.83a.83.83 0 0 0 0 1.67h1.69A4.55 4.55 0 0 1 8 5.83zm-.33 3.34H5.83a.83.83 0 0 0 0 1.66h2.72a4.57 4.57 0 0 1-.88-1.66zM5.83 12.5a.83.83 0 0 0 0 1.67h7.5a.83.83 0 1 0 0-1.67h-7.5zm8.8-2.9a3.02 3.02 0 0 0 .46-1.6c0-1.66-1.32-3-2.94-3C10.52 5 9.2 6.34 9.2 8s1.31 3 2.93 3c.58 0 1.11-.17 1.56-.47l2.04 2.08.93-.94-2.04-2.08zm-2.48.07c-.9 0-1.63-.75-1.63-1.67s.73-1.67 1.63-1.67c.9 0 1.63.75 1.63 1.67s-.73 1.67-1.63 1.67z" fill="${r}"/>
  </svg>`},us=t=>{const r=t.fgColor,c=t.bgColor;return`${ne}
  <rect x="2" y="2" width="16" height="16" rx="2" fill="${c}"/>
  <path d="M7.676 4.726V3l2.976 3.021-2.976 3.022v-1.77c-2.125 0-3.613.69-4.676 2.201.425-2.158 1.7-4.316 4.676-4.748zM10.182 14.4h3.636l.655 1.6H16l-3.454-8h-1.091L8 16h1.527l.655-1.6zM12 9.44l1.36 3.65h-2.72L12 9.44z" fill="${r}"/>
</svg>`},ds=t=>{const r=t.fgColor,c=t.bgColor;return`${ne}
  <rect x="2" y="2" width="16" height="16" rx="2" fill="${c}"/>
  <path fill-rule="evenodd" clip-rule="evenodd" d="M4.167 5.417a.833.833 0 100 1.666h4.166a.833.833 0 100-1.666H4.167z" fill="${r}"/>
  <path fill-rule="evenodd" clip-rule="evenodd" d="M7.083 4.167a.833.833 0 10-1.666 0v4.166a.833.833 0 101.666 0V4.167zM11.667 5.417a.833.833 0 100 1.666h4.166a.833.833 0 100-1.666h-4.166zM5.367 11.688a.833.833 0 00-1.179 1.179l2.947 2.946a.833.833 0 001.178-1.178l-2.946-2.947z" fill="${r}"/>
  <path fill-rule="evenodd" clip-rule="evenodd" d="M8.313 12.867a.833.833 0 10-1.178-1.179l-2.947 2.947a.833.833 0 101.179 1.178l2.946-2.946z" fill="${r}"/>
  <path d="M10.833 12.5c0-.46.373-.833.834-.833h4.166a.833.833 0 110 1.666h-4.166a.833.833 0 01-.834-.833zM10.833 15c0-.46.373-.833.834-.833h4.166a.833.833 0 110 1.666h-4.166a.833.833 0 01-.834-.833z" fill="${r}"/>
</svg>`},fs=t=>{const r=t.fgColor,c=t.bgColor;return`
    ${ne}
    <path d="M16.22 2H3.78C2.8 2 2 2.8 2 3.78v12.44C2 17.2 2.8 18 3.78 18h12.44c.98 0 1.77-.8 1.77-1.78L18 3.78C18 2.8 17.2 2 16.22 2z" fill="${c}"/>
    <path d="M10 8.84a1.16 1.16 0 1 0 0 2.32 1.16 1.16 0 0 0 0-2.32zm3.02 3.61a3.92 3.92 0 0 0 .78-3.28.49.49 0 1 0-.95.2c.19.87-.02 1.78-.58 2.47a2.92 2.92 0 1 1-4.13-4.08 2.94 2.94 0 0 1 2.43-.62.49.49 0 1 0 .17-.96 3.89 3.89 0 1 0 2.28 6.27zM10 4.17a5.84 5.84 0 0 0-5.44 7.93.49.49 0 1 0 .9-.35 4.86 4.86 0 1 1 2.5 2.67.49.49 0 1 0-.4.88c.76.35 1.6.54 2.44.53a5.83 5.83 0 0 0 0-11.66zm3.02 3.5a.7.7 0 1 0-1.4 0 .7.7 0 0 0 1.4 0zm-6.97 5.35a.7.7 0 1 1 0 1.4.7.7 0 0 1 0-1.4z" fill="${r}"/>
  </svg>`},hs=t=>{const r=t.fgColor,c=t.bgColor;return`${ne}
  <rect x="2" y="2" width="16" height="16" rx="2" fill="${c}"/>
  <path d="M12.4 13.565c1.865-.545 3.645-2.083 3.645-4.396 0-1.514-.787-2.604-2.071-2.604C12.69 6.565 12 7.63 12 8.939c1.114.072 1.865.726 1.865 1.683 0 .933-.8 1.647-1.84 2.023l.375.92zM4 5h6v2H4zM4 9h5v2H4zM4 13h4v2H4z" fill="${r}"/>
</svg>`},gs=t=>{const r=t.fgColor,c=t.bgColor;return`
    ${ne}
    <rect x="2" y="2" width="16" height="16" rx="2" fill="${c}"/>
    <path d="M12.4 13.56c1.86-.54 3.65-2.08 3.65-4.4 0-1.5-.8-2.6-2.08-2.6S12 7.64 12 8.95c1.11.07 1.86.73 1.86 1.68 0 .94-.8 1.65-1.83 2.03l.37.91zM4 5h6v2H4zm0 4h5v2H4zm0 4h4v2H4z" fill="${r}"/>
  </svg>`},ms=t=>{const r=t.fgColor,c=t.bgColor;return`${ne}
  <path d="M16.222 2H3.778C2.8 2 2 2.8 2 3.778v12.444C2 17.2 2.8 18 3.778 18h12.444c.978 0 1.77-.8 1.77-1.778L18 3.778C18 2.8 17.2 2 16.222 2z" fill="${c}"/>
  <path d="M10 7a1 1 0 100-2v2zm0 6a1 1 0 100 2v-2zm0-8H7v2h3V5zm-3 6h5V9H7v2zm5 2h-2v2h2v-2zm1-1a1 1 0 01-1 1v2a3 3 0 003-3h-2zm-1-1a1 1 0 011 1h2a3 3 0 00-3-3v2zM4 8a3 3 0 003 3V9a1 1 0 01-1-1H4zm3-3a3 3 0 00-3 3h2a1 1 0 011-1V5z" fill="${r}"/>
  <path fill-rule="evenodd" clip-rule="evenodd" d="M4.856 12.014a.5.5 0 00-.712.702L5.409 14l-1.265 1.284a.5.5 0 00.712.702l1.255-1.274 1.255 1.274a.5.5 0 00.712-.702L6.813 14l1.265-1.284a.5.5 0 00-.712-.702L6.11 13.288l-1.255-1.274zM12.856 4.014a.5.5 0 00-.712.702L13.409 6l-1.265 1.284a.5.5 0 10.712.702l1.255-1.274 1.255 1.274a.5.5 0 10.712-.702L14.813 6l1.265-1.284a.5.5 0 00-.712-.702L14.11 5.288l-1.255-1.274z" fill="${r}"/>
</svg>`},vs=t=>{const r=t.fgColor,c=t.bgColor;return`${ne}
  <rect x="2" y="2" width="16" height="16" rx="2" fill="${c}"/>
  <path fill-rule="evenodd" clip-rule="evenodd" d="M14.25 7.25a.75.75 0 000-1.5h-6.5a.75.75 0 100 1.5h6.5zM15 10a.75.75 0 01-.75.75h-6.5a.75.75 0 010-1.5h6.5A.75.75 0 0115 10zm-.75 4.25a.75.75 0 000-1.5h-6.5a.75.75 0 000 1.5h6.5zm-8.987-7a.75.75 0 100-1.5.75.75 0 000 1.5zm.75 2.75a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm-.75 4.25a.75.75 0 100-1.5.75.75 0 000 1.5z" fill="${r}"/>
</svg>`},ps=t=>{const r=t.fgColor;return`
    <svg width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M2 15v1h14v-2.5c0-.87-.44-1.55-.98-2.04a6.19 6.19 0 0 0-1.9-1.14 12.1 12.1 0 0 0-2.48-.67A4 4 0 1 0 5 6a4 4 0 0 0 2.36 3.65c-.82.13-1.7.36-2.48.67-.69.28-1.37.65-1.9 1.13A2.8 2.8 0 0 0 2 13.5V15z" fill="${t.bgColor}" stroke="${r}" stroke-width="2"/>
  </svg>`},Cs=t=>{const r=t.fgColor;return`
    <svg width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M12.43 6.04v-.18a3.86 3.86 0 0 0-7.72 0v.18A2.15 2.15 0 0 0 3 8.14v5.72C3 15.04 3.96 16 5.14 16H12c1.18 0 2.14-.96 2.14-2.14V8.14c0-1.03-.73-1.9-1.71-2.1zM7.86 6v-.14a.71.71 0 1 1 1.43 0V6H7.86z" fill="${t.bgColor}" stroke="${r}" stroke-width="2"/>
  </svg>
`},ws=t=>(t.fgColor,`
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="${t.bgColor}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" >
 <g transform="scale(0.833) translate(2, 2)">
    <path d="M8 18L12 22L16 18"/>
    <path d="M12 2V22"/>
  </g>
</svg>
  `),ys=t=>(t.fgColor,`
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="${t.bgColor}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" >
  <g transform="scale(0.833) translate(-4, 2)">
    <path d="M8 6L12 2L16 6"/>
    <path d="M12 2V22"/>
  </g>
</svg>
`),bs={headerRowID:Ui,headerNumber:Xi,headerCode:_i,headerString:Yi,headerBoolean:qi,headerAudioUri:Ji,headerVideoUri:Qi,headerEmoji:ji,headerImage:es,headerUri:Ir,headerPhone:ts,headerMarkdown:os,headerDate:ns,headerTime:rs,headerEmail:ls,headerReference:is,headerIfThenElse:ss,headerSingleValue:cs,headerLookup:as,headerTextTemplate:us,headerMath:ds,headerRollup:fs,headerJoinStrings:hs,headerSplitString:gs,headerGeoDistance:ms,headerArray:vs,rowOwnerOverlay:ps,protectedColumnOverlay:Cs,renameIcon:Zi,headerArrowDown:ws,headerArrowUp:ys},xs=tn("div")({name:"SearchWrapper",class:"slyseh9",propsAsIs:!1}),ks=l.createElement("svg",{className:"button-icon",viewBox:"0 0 512 512"},l.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"48",d:"M112 244l144-144 144 144M256 120v292"})),Rs=l.createElement("svg",{className:"button-icon",viewBox:"0 0 512 512"},l.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"48",d:"M112 268l144 144 144-144M256 392V100"})),Ms=l.createElement("svg",{className:"button-icon",viewBox:"0 0 512 512"},l.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M368 368L144 144M368 144L144 368"})),Ss=10,Es=t=>{const{canvasRef:r,cellYOffset:c,rows:g,columns:w,searchInputRef:k,searchValue:I,searchResults:x,onSearchValueChange:M,getCellsForSelection:L,onSearchResultsChanged:m,showSearch:b=!1,onSearchClose:S}=t,[W]=l.useState(()=>"search-box-"+Math.round(Math.random()*1e3)),[_,O]=l.useState(""),ce=I??_,me=l.useCallback(F=>{O(F),M==null||M(F)},[M]),[A,z]=l.useState(),J=l.useRef(A);J.current=A,l.useEffect(()=>{x!==void 0&&(x.length>0?z(F=>({rowsSearched:g,results:x.length,selectedIndex:(F==null?void 0:F.selectedIndex)??-1})):z(void 0))},[g,x]);const de=l.useRef();de.current===void 0&&(de.current=new AbortController);const X=l.useRef(),[q,te]=l.useState([]),ie=x??q,K=l.useCallback(()=>{X.current!==void 0&&(window.cancelAnimationFrame(X.current),X.current=void 0),de.current!==void 0&&de.current.abort(),de.current=new AbortController},[]),Oe=l.useRef(c);Oe.current=c;const Fe=l.useCallback(F=>{const re=new RegExp(F.replace(/([$()*+.?[\\\]^{|}-])/g,"\\$1"),"i");let we=Oe.current,ye=Math.min(10,g),Je=0;z(void 0),te([]);const Se=[],Qe=async()=>{var Zt;if(L===void 0)return;const wt=performance.now(),yt=g-Je;let je=L({x:0,y:we,width:w.length,height:Math.min(ye,yt,g-we)},de.current.signal);typeof je=="function"&&(je=await je());let vo=!1;for(const[it,st]of je.entries())for(const[xt,Le]of st.entries()){let De;switch(Le.kind){case Q.Text:case Q.Number:De=Le.displayData;break;case Q.Uri:case Q.Markdown:De=Le.data;break;case Q.Boolean:De=typeof Le.data=="boolean"?Le.data.toString():void 0;break;case Q.Image:case Q.Bubble:De=Le.data.join("üê≥");break;case Q.Custom:De=Le.copyData;break}De!==void 0&&re.test(De)&&(Se.push([xt,it+we]),vo=!0)}const on=performance.now();vo&&te([...Se]),Je+=je.length,jo(Je<=g);const po=((Zt=J.current)==null?void 0:Zt.selectedIndex)??-1;z({results:Se.length,rowsSearched:Je,selectedIndex:po}),m==null||m(Se,po),we+ye>=g?we=0:we+=ye;const qt=on-wt,bt=Math.max(qt,1),nn=Ss/bt;ye=Math.ceil(ye*nn),Je<g&&Se.length<1e3&&(X.current=window.requestAnimationFrame(Qe))};K(),X.current=window.requestAnimationFrame(Qe)},[K,w.length,L,m,g]),Ie=l.useCallback(()=>{var F;S==null||S(),z(void 0),te([]),m==null||m([],-1),K(),(F=r==null?void 0:r.current)==null||F.focus()},[K,r,S,m]),rt=l.useCallback(F=>{me(F.target.value),x===void 0&&(F.target.value===""?(z(void 0),te([]),K()):Fe(F.target.value))},[Fe,K,me,x]);l.useEffect(()=>{k.current!==null&&(me(""),z(void 0),q.length>0&&(te([]),m==null||m([],-1)),b?k.current.focus({preventScroll:!0}):K())},[b,k]);const Xe=l.useCallback(F=>{var we;if((we=F==null?void 0:F.stopPropagation)==null||we.call(F),A===void 0||A.results===0)return;const re=(A.selectedIndex+1)%A.results;z({...A,selectedIndex:re}),m==null||m(ie,re)},[A,m,ie]),Gt=l.useCallback(F=>{var we;if((we=F==null?void 0:F.stopPropagation)==null||we.call(F),A===void 0||A.results===0)return;let re=(A.selectedIndex-1)%A.results;re<0&&(re+=A.results),z({...A,selectedIndex:re}),m==null||m(ie,re)},[m,ie,A]),Ye=l.useCallback(F=>{(F.ctrlKey||F.metaKey)&&F.nativeEvent.code==="KeyF"||F.key==="Escape"?(Ie(),F.stopPropagation(),F.preventDefault()):F.key==="Enter"&&(F.shiftKey?Gt():Xe())},[Ie,Xe,Gt]);l.useEffect(()=>()=>{K()},[K]);const[lt,go]=l.useState(!1);l.useEffect(()=>{if(b)go(!0);else{const F=setTimeout(()=>go(!1),150);return()=>clearTimeout(F)}},[b]);const mo=l.useMemo(()=>{if(!b&&!lt)return null;let F;A!==void 0&&(F=A.results>=1e3?"over 1000":`${A.results} result${A.results!==1?"s":""}`,A.selectedIndex>=0&&(F=`${A.selectedIndex+1} of ${F}`));const re=Je=>{Je.stopPropagation()},ye={width:`${g>0?Math.floor(((A==null?void 0:A.rowsSearched)??0)/g*100):0}%`};return l.createElement(xs,{className:"gdg-search-bar"+(b?"":" out"),onMouseDown:re,onMouseMove:re,onMouseUp:re,onClick:re},l.createElement("div",{className:"gdg-search-bar-inner"},l.createElement("input",{id:W,"aria-hidden":!b,"data-testid":"search-input",ref:k,onChange:rt,value:ce,tabIndex:b?void 0:-1,onKeyDownCapture:Ye}),l.createElement("button",{type:"button","aria-label":"Previous Result","aria-hidden":!b,tabIndex:b?void 0:-1,onClick:Gt,disabled:((A==null?void 0:A.results)??0)===0},ks),l.createElement("button",{type:"button","aria-label":"Next Result","aria-hidden":!b,tabIndex:b?void 0:-1,onClick:Xe,disabled:((A==null?void 0:A.results)??0)===0},Rs),S!==void 0&&l.createElement("button",{type:"button","aria-label":"Close Search","aria-hidden":!b,"data-testid":"search-close-button",tabIndex:b?void 0:-1,onClick:Ie},Ms)),A!==void 0?l.createElement(l.Fragment,null,l.createElement("div",{className:"gdg-search-status"},l.createElement("div",{"data-testid":"search-result-area"},F)),l.createElement("div",{className:"gdg-search-progress",style:ye})):l.createElement("div",{className:"gdg-search-status"},l.createElement("label",{htmlFor:W},"Type to search")))},[b,lt,A,g,W,k,rt,ce,Ye,Gt,Xe,S,Ie]);return l.createElement(l.Fragment,null,l.createElement(Bi,{prelightCells:ie,accessibilityHeight:t.accessibilityHeight,canvasRef:t.canvasRef,cellXOffset:t.cellXOffset,cellYOffset:t.cellYOffset,className:t.className,clientSize:t.clientSize,columns:t.columns,disabledRows:t.disabledRows,enableGroups:t.enableGroups,groupLevels:t.groupLevels,groupHeaderHeights:t.groupHeaderHeights,fillHandle:t.fillHandle,firstColAccessible:t.firstColAccessible,nonGrowWidth:t.nonGrowWidth,fixedShadowX:t.fixedShadowX,fixedShadowY:t.fixedShadowY,freezeColumns:t.freezeColumns,getCellContent:t.getCellContent,getCellRenderer:t.getCellRenderer,getGroupDetails:t.getGroupDetails,getRowThemeOverride:t.getRowThemeOverride,groupHeaderHeight:t.groupHeaderHeight,headerHeight:t.headerHeight,highlightRegions:t.highlightRegions,imageWindowLoader:t.imageWindowLoader,initialSize:t.initialSize,isFilling:t.isFilling,isFocused:t.isFocused,lockColumns:t.lockColumns,maxColumnWidth:t.maxColumnWidth,minColumnWidth:t.minColumnWidth,onHeaderMenuClick:t.onHeaderMenuClick,onHeaderIndicatorClick:t.onHeaderIndicatorClick,onMouseMove:t.onMouseMove,onVisibleRegionChanged:t.onVisibleRegionChanged,overscrollX:t.overscrollX,overscrollY:t.overscrollY,preventDiagonalScrolling:t.preventDiagonalScrolling,rightElement:t.rightElement,rightElementProps:t.rightElementProps,rowHeight:t.rowHeight,rows:t.rows,scrollRef:t.scrollRef,selection:t.selection,theme:t.theme,freezeTrailingRows:t.freezeTrailingRows,hasAppendRow:t.hasAppendRow,translateX:t.translateX,translateY:t.translateY,verticalBorder:t.verticalBorder,onColumnProposeMove:t.onColumnProposeMove,drawFocusRing:t.drawFocusRing,drawCell:t.drawCell,drawHeader:t.drawHeader,experimental:t.experimental,gridRef:t.gridRef,headerIcons:t.headerIcons,isDraggable:t.isDraggable,onCanvasBlur:t.onCanvasBlur,onCanvasFocused:t.onCanvasFocused,onCellFocused:t.onCellFocused,onColumnMoved:t.onColumnMoved,onColumnResize:t.onColumnResize,onColumnResizeEnd:t.onColumnResizeEnd,onColumnResizeStart:t.onColumnResizeStart,onContextMenu:t.onContextMenu,onDragEnd:t.onDragEnd,onDragLeave:t.onDragLeave,onDragOverCell:t.onDragOverCell,onDragStart:t.onDragStart,onDrop:t.onDrop,onItemHovered:t.onItemHovered,onKeyDown:t.onKeyDown,onKeyUp:t.onKeyUp,onMouseDown:t.onMouseDown,onMouseUp:t.onMouseUp,onRowMoved:t.onRowMoved,smoothScrollX:t.smoothScrollX,smoothScrollY:t.smoothScrollY,resizeIndicator:t.resizeIndicator}),mo)},Ts=()=>t=>Math.max(16,t.targetHeight-10),zs=tn("input")({name:"RenameInput",class:"r1fzhvm4",propsAsIs:!1,vars:{"r1fzhvm4-0":[Ts(),"px"]}}),Is=t=>{const{bounds:r,group:c,onClose:g,canvasBounds:w,onFinish:k}=t,[I,x]=ge.useState(c);return ge.createElement(Ci,{style:{position:"absolute",left:r.x-w.left+1,top:r.y-w.top,width:r.width-2,height:r.height},className:"c181oggi",onClickOutside:g},ge.createElement(zs,{targetHeight:r.height,"data-testid":"group-rename-input",value:I,onBlur:g,onFocus:M=>M.target.setSelectionRange(0,I.length),onChange:M=>x(M.target.value),onKeyDown:M=>{M.key==="Enter"?k(I):M.key==="Escape"&&g()},autoFocus:!0}))},Fn=150;function Ls(t,r,c,g){var k;const w=g(r);return((k=w==null?void 0:w.measure)==null?void 0:k.call(w,t,r,c))??Fn}function Lr(t,r,c,g,w,k,I,x,M){let L=0;const m=w===void 0?[]:w.map(W=>{const _=Ls(t,W[g],r,M);return L=Math.max(L,_),_});if(m.length>5&&x){L=0;let W=0;for(const O of m)W+=O;const _=W/m.length;for(let O=0;O<m.length;O++)m[O]>=_*2?m[O]=0:L=Math.max(L,m[O])}const b=t.font;t.font=r.headerFontFull,L=Math.max(L,t.measureText(c.title).width+r.cellHorizontalPadding*2+(c.icon===void 0?0:28)),t.font=b;const S=Math.max(Math.ceil(k),Math.min(Math.floor(I),Math.ceil(L)));return{...c,width:S}}function Ds(t,r,c,g,w,k,I,x,M){const L=l.useRef(r),m=l.useRef(c),b=l.useRef(I);L.current=r,m.current=c,b.current=I;const[S,W]=l.useMemo(()=>{if(typeof window>"u")return[null,null];const A=document.createElement("canvas");return A.style.display="none",A.style.opacity="0",A.style.position="fixed",[A,A.getContext("2d",{alpha:!1})]},[]);l.useLayoutEffect(()=>(S&&document.documentElement.append(S),()=>{S==null||S.remove()}),[S]);const _=l.useRef({}),O=l.useRef(),[ce,me]=l.useState();return l.useLayoutEffect(()=>{const A=m.current;if(A===void 0||t.every(Zo))return;let z=Math.max(1,10-Math.floor(t.length/1e4)),J=0;z<L.current&&z>1&&(z--,J=1);const de={x:0,y:0,width:t.length,height:Math.min(L.current,z)},X={x:0,y:L.current-1,width:t.length,height:1};(async()=>{const te=A(de,M.signal),ie=J>0?A(X,M.signal):void 0;let K;typeof te=="object"?K=te:K=await yr(te),ie!==void 0&&(typeof ie=="object"?K=[...K,...ie]:K=[...K,...await yr(ie)]),O.current=t,me(K)})()},[M.signal,t]),l.useMemo(()=>{let z=t.every(Zo)?t:W===null?t.map(q=>Zo(q)?q:{...q,width:Fn}):(W.font=b.current.baseFontFull,t.map((q,te)=>{if(Zo(q))return q;if(_.current[q.id]!==void 0)return{...q,width:_.current[q.id]};if(ce===void 0||O.current!==t||q.id===void 0)return{...q,width:Fn};const ie=Lr(W,I,q,te,ce,w,k,!0,x);return _.current[q.id]=ie.width,ie})),J=0,de=0;const X=[];for(const[q,te]of z.entries())J+=te.width,te.grow!==void 0&&te.grow>0&&(de+=te.grow,X.push(q));if(J<g&&X.length>0){const q=[...z],te=g-J;let ie=te;for(let K=0;K<X.length;K++){const Oe=X[K],Fe=(z[Oe].grow??0)/de,Ie=K===X.length-1?ie:Math.min(ie,Math.floor(te*Fe));q[Oe]={...z[Oe],growOffset:Ie,width:z[Oe].width+Ie},ie-=Ie}z=q}return{sizedColumns:z,nonGrowWidth:J}},[g,t,W,ce,I,w,k,x])}function Hs(t,r){return t===void 0?!1:t.length>1&&t.startsWith("_")?Number.parseInt(t.slice(1))===r.keyCode:t.length===1&&t>="a"&&t<="z"?t.toUpperCase().codePointAt(0)===r.keyCode:t===r.key}function B(t,r,c){const g=Dr(t,r);return g&&(c.didMatch=!0),g}function Dr(t,r){if(t.length===0)return!1;if(t.includes("|")){const M=t.split("|");for(const L of M)if(Dr(L,r))return!0;return!1}let c=!1,g=!1,w=!1,k=!1;const I=t.split("+"),x=I.pop();if(!Hs(x,r))return!1;if(I[0]==="any")return!0;for(const M of I)switch(M){case"ctrl":c=!0;break;case"shift":g=!0;break;case"alt":w=!0;break;case"meta":k=!0;break;case"primary":en.value?k=!0:c=!0;break}return r.altKey===w&&r.ctrlKey===c&&r.shiftKey===g&&r.metaKey===k}function Fs(t,r,c,g,w,k,I){const x=ge.useCallback((m,b,S,W)=>{var z;(k==="cell"||k==="multi-cell")&&m!==void 0&&(m={...m,range:{x:m.cell[0],y:m.cell[1],width:1,height:1}}),!I&&m!==void 0&&m.range.width>1&&(m={...m,range:{...m.range,width:1,x:m.cell[0]}});const _=c==="mixed"&&(S||W==="drag")||c==="additive",O=(g==="mixed"||g==="additive")&&_,ce=S||(w==="mixed"||w==="additive")&&_;let me={current:m===void 0?void 0:{...m,rangeStack:W==="drag"?((z=t.current)==null?void 0:z.rangeStack)??[]:[]},columns:O?t.columns:oe.empty(),rows:ce?t.rows:oe.empty()};S&&(k==="multi-rect"||k==="multi-cell")&&me.current!==void 0&&t.current!==void 0&&(me={...me,current:{...me.current,rangeStack:[...t.current.rangeStack,t.current.range]}}),r(me,b)},[g,t,c,k,I,w,r]),M=ge.useCallback((m,b,S)=>{m=m??t.rows,b!==void 0&&(m=m.add(b));let W;if(w==="exclusive"&&m.length>0)W={current:void 0,columns:oe.empty(),rows:m};else{const _=S&&c==="mixed"||c==="additive",O=S&&g==="mixed"||g==="additive";W={current:_?t.current:void 0,columns:O?t.columns:oe.empty(),rows:m}}r(W,!1)},[g,t,c,w,r]),L=ge.useCallback((m,b,S)=>{m=m??t.columns,b!==void 0&&(m=m.add(b));let W;if(g==="exclusive"&&m.length>0)W={current:void 0,rows:oe.empty(),columns:m};else{const _=S&&c==="mixed"||c==="additive",O=S&&w==="mixed"||w==="additive";W={current:_?t.current:void 0,rows:O?t.rows:oe.empty(),columns:m}}r(W,!1)},[g,t,c,w,r]);return[x,M,L]}function $s(t,r,c,g,w){const k=l.useCallback(L=>{if(t===!0){const m=[];for(let b=L.y;b<L.y+L.height;b++){const S=[];for(let W=L.x;W<L.x+L.width;W++)W<0||b>=w?S.push({kind:Q.Loading,allowOverlay:!1}):S.push(r([W,b]));m.push(S)}return m}return(t==null?void 0:t(L,g.signal))??[]},[g.signal,r,t,w]),I=t!==void 0?k:void 0,x=l.useCallback(L=>{if(I===void 0)return[];const m={...L,x:L.x-c};if(m.x<0){m.x=0,m.width--;const b=I(m,g.signal);return typeof b=="function"?async()=>(await b()).map(S=>[{kind:Q.Loading,allowOverlay:!1},...S]):b.map(S=>[{kind:Q.Loading,allowOverlay:!1},...S])}return I(m,g.signal)},[g.signal,I,c]);return[t!==void 0?x:void 0,I]}function Er(t){return typeof t=="string"?t:`${t}px`}const As=()=>t=>t.innerWidth,Gs=()=>t=>t.innerHeight,Ks=tn("div")({name:"Wrapper",class:"w2q57ts",propsAsIs:!1,vars:{"w2q57ts-0":[As()],"w2q57ts-1":[Gs()]}}),Ps=t=>{const{inWidth:r,inHeight:c,children:g,...w}=t;return l.createElement(Ks,{innerHeight:Er(c),innerWidth:Er(r),...w},g)},Ns=2,Ws=1300;function Vs(t,r,c){const g=ge.useRef(0),[w,k]=t??[0,0];ge.useEffect(()=>{if(w===0&&k===0){g.current=0;return}let I=!1,x=0;const M=L=>{var m;if(!I){if(x===0)x=L;else{const b=L-x;g.current=Math.min(1,g.current+b/Ws);const S=g.current**1.618*b*Ns;(m=r.current)==null||m.scrollBy(w*S,k*S),x=L,c==null||c()}window.requestAnimationFrame(M)}};return window.requestAnimationFrame(M),()=>{I=!0}},[r,w,k,c])}function Os({rowHeight:t,headerHeight:r,groupHeaderHeight:c,theme:g,overscrollX:w,overscrollY:k,scaleToRem:I,remSize:x}){const[M,L,m,b,S,W]=ge.useMemo(()=>{if(!I||x===16)return[t,r,c,g,w,k];const _=x/16,O=t,ce=zr();return[typeof O=="number"?O*_:me=>Math.ceil(O(me)*_),Math.ceil(r*_),Math.ceil(c*_),{...g,headerIconSize:((g==null?void 0:g.headerIconSize)??ce.headerIconSize)*_,cellHorizontalPadding:((g==null?void 0:g.cellHorizontalPadding)??ce.cellHorizontalPadding)*_,cellVerticalPadding:((g==null?void 0:g.cellVerticalPadding)??ce.cellVerticalPadding)*_},Math.ceil((w??0)*_),Math.ceil((k??0)*_)]},[c,r,w,k,x,t,I,g]);return{rowHeight:M,headerHeight:L,groupHeaderHeight:m,theme:b,overscrollX:S,overscrollY:W}}const vt={downFill:!1,rightFill:!1,clear:!0,closeOverlay:!0,acceptOverlayDown:!0,acceptOverlayUp:!0,acceptOverlayLeft:!0,acceptOverlayRight:!0,copy:!0,paste:!0,cut:!0,search:!1,delete:!0,activateCell:!0,scrollToSelectedCell:!0,goToFirstCell:!0,goToFirstColumn:!0,goToFirstRow:!0,goToLastCell:!0,goToLastColumn:!0,goToLastRow:!0,goToNextPage:!0,goToPreviousPage:!0,selectToFirstCell:!0,selectToFirstColumn:!0,selectToFirstRow:!0,selectToLastCell:!0,selectToLastColumn:!0,selectToLastRow:!0,selectAll:!0,selectRow:!0,selectColumn:!0,goUpCell:!0,goRightCell:!0,goDownCell:!0,goLeftCell:!0,goUpCellRetainSelection:!0,goRightCellRetainSelection:!0,goDownCellRetainSelection:!0,goLeftCellRetainSelection:!0,selectGrowUp:!0,selectGrowRight:!0,selectGrowDown:!0,selectGrowLeft:!0};function U(t,r){return t===!0?r:t===!1?"":t}function Tr(t){const r=en.value;return{activateCell:U(t.activateCell," |Enter|shift+Enter"),clear:U(t.clear,"any+Escape"),closeOverlay:U(t.closeOverlay,"any+Escape"),acceptOverlayDown:U(t.acceptOverlayDown,"Enter"),acceptOverlayUp:U(t.acceptOverlayUp,"shift+Enter"),acceptOverlayLeft:U(t.acceptOverlayLeft,"shift+Tab"),acceptOverlayRight:U(t.acceptOverlayRight,"Tab"),copy:t.copy,cut:t.cut,delete:U(t.delete,r?"Backspace|Delete":"Delete"),downFill:U(t.downFill,"primary+_68"),scrollToSelectedCell:U(t.scrollToSelectedCell,"primary+Enter"),goDownCell:U(t.goDownCell,"ArrowDown"),goDownCellRetainSelection:U(t.goDownCellRetainSelection,"alt+ArrowDown"),goLeftCell:U(t.goLeftCell,"ArrowLeft|shift+Tab"),goLeftCellRetainSelection:U(t.goLeftCellRetainSelection,"alt+ArrowLeft"),goRightCell:U(t.goRightCell,"ArrowRight|Tab"),goRightCellRetainSelection:U(t.goRightCellRetainSelection,"alt+ArrowRight"),goUpCell:U(t.goUpCell,"ArrowUp"),goUpCellRetainSelection:U(t.goUpCellRetainSelection,"alt+ArrowUp"),goToFirstCell:U(t.goToFirstCell,"primary+Home"),goToFirstColumn:U(t.goToFirstColumn,"Home|primary+ArrowLeft"),goToFirstRow:U(t.goToFirstRow,"primary+ArrowUp"),goToLastCell:U(t.goToLastCell,"primary+End"),goToLastColumn:U(t.goToLastColumn,"End|primary+ArrowRight"),goToLastRow:U(t.goToLastRow,"primary+ArrowDown"),goToNextPage:U(t.goToNextPage,"PageDown"),goToPreviousPage:U(t.goToPreviousPage,"PageUp"),paste:t.paste,rightFill:U(t.rightFill,"primary+_82"),search:U(t.search,"primary+f"),selectAll:U(t.selectAll,"primary+a"),selectColumn:U(t.selectColumn,"ctrl+ "),selectGrowDown:U(t.selectGrowDown,"shift+ArrowDown"),selectGrowLeft:U(t.selectGrowLeft,"shift+ArrowLeft"),selectGrowRight:U(t.selectGrowRight,"shift+ArrowRight"),selectGrowUp:U(t.selectGrowUp,"shift+ArrowUp"),selectRow:U(t.selectRow,"shift+ "),selectToFirstCell:U(t.selectToFirstCell,"primary+shift+Home"),selectToFirstColumn:U(t.selectToFirstColumn,"primary+shift+ArrowLeft"),selectToFirstRow:U(t.selectToFirstRow,"primary+shift+ArrowUp"),selectToLastCell:U(t.selectToLastCell,"primary+shift+End"),selectToLastColumn:U(t.selectToLastColumn,"primary+shift+ArrowRight"),selectToLastRow:U(t.selectToLastRow,"primary+shift+ArrowDown")}}function Bs(t){const r=wi(t);return ge.useMemo(()=>{if(r===void 0)return Tr(vt);const c={...r,goToNextPage:(r==null?void 0:r.goToNextPage)??(r==null?void 0:r.pageDown)??vt.goToNextPage,goToPreviousPage:(r==null?void 0:r.goToPreviousPage)??(r==null?void 0:r.pageUp)??vt.goToPreviousPage,goToFirstCell:(r==null?void 0:r.goToFirstCell)??(r==null?void 0:r.first)??vt.goToFirstCell,goToLastCell:(r==null?void 0:r.goToLastCell)??(r==null?void 0:r.last)??vt.goToLastCell,selectToFirstCell:(r==null?void 0:r.selectToFirstCell)??(r==null?void 0:r.first)??vt.selectToFirstCell,selectToLastCell:(r==null?void 0:r.selectToLastCell)??(r==null?void 0:r.last)??vt.selectToLastCell};return Tr({...vt,...c})},[r])}function Us(t){function r(g,w,k){if(typeof g=="number")return{headerIndex:g,isCollapsed:!1,depth:w,path:k};const I={headerIndex:g.headerIndex,isCollapsed:g.isCollapsed,depth:w,path:k};return g.subGroups!==void 0&&(I.subGroups=g.subGroups.map((x,M)=>r(x,w+1,[...k,M])).sort((x,M)=>x.headerIndex-M.headerIndex)),I}return t.map((g,w)=>r(g,0,[w])).sort((g,w)=>g.headerIndex-w.headerIndex)}function An(t,r){const c=[];function g(x,M,L=!1){let m=M!==null?M-x.headerIndex:r-x.headerIndex;if(x.subGroups!==void 0&&(m=x.subGroups[0].headerIndex-x.headerIndex),m--,c.push({rowIndex:-1,headerIndex:x.headerIndex,contentIndex:-1,skip:L,isCollapsed:x.isCollapsed,depth:x.depth,path:x.path,rows:m}),x.subGroups)for(let b=0;b<x.subGroups.length;b++){const S=b<x.subGroups.length-1?x.subGroups[b+1].headerIndex:M;g(x.subGroups[b],S,L||x.isCollapsed)}}const w=Us(t.groups);for(let x=0;x<w.length;x++){const M=x<w.length-1?w[x+1].headerIndex:null;g(w[x],M)}let k=0,I=0;for(const x of c)x.contentIndex=I,I+=x.rows,x.rowIndex=k,k+=x.isCollapsed?1:x.rows+1;return c.filter(x=>x.skip===!1).map(x=>{const{skip:M,...L}=x;return L})}function $n(t,r){if(r===void 0||An.length===0)return{path:[t],originalIndex:t,isGroupHeader:!1,groupIndex:t,contentIndex:t,groupRows:-1};let c=t;for(const g of r){if(c===0)return{path:[...g.path,-1],originalIndex:g.headerIndex,isGroupHeader:!0,groupIndex:-1,contentIndex:-1,groupRows:g.rows};if(g.isCollapsed)c--;else{if(c<=g.rows)return{path:[...g.path,c-1],originalIndex:g.headerIndex+c,isGroupHeader:!1,groupIndex:c-1,contentIndex:g.contentIndex+c-1,groupRows:g.rows};c=c-g.rows-1}}return{path:[t],originalIndex:t,isGroupHeader:!1,groupIndex:t,contentIndex:t,groupRows:-1}}function _s(t,r,c,g){const w=ge.useMemo(()=>t===void 0?void 0:An(t,r),[t,r]),k=ge.useMemo(()=>w==null?void 0:w.reduce((m,b)=>(m[b.rowIndex]=b,m),{}),[w]),I=ge.useMemo(()=>w===void 0?r:w.reduce((m,b)=>m+(b.isCollapsed?1:b.rows+1),0),[w,r]),x=ge.useMemo(()=>t===void 0||typeof c=="number"&&t.height===c?c:m=>k!=null&&k[m]?t.height:typeof c=="number"?c:c(m),[k,t,c]),M=ge.useCallback(m=>{if(w===void 0)return m;let b=m;for(const S of w){if(b===0)return;if(b--,!S.isCollapsed){if(b<S.rows)return S.contentIndex+b;b-=S.rows}}return m},[w]),L=Ct(g??(t==null?void 0:t.themeOverride),ge.useCallback(m=>{if(t===void 0)return g==null?void 0:g(m,m,m);if(g===void 0&&(t==null?void 0:t.themeOverride)===void 0)return;const{isGroupHeader:b,contentIndex:S,groupIndex:W}=$n(m,w);return b?t.themeOverride:g==null?void 0:g(m,W,S)},[w,g,t]));return t===void 0?{rowHeight:x,rows:r,rowNumberMapper:M,getRowThemeOverride:L}:{rowHeight:x,rows:I,rowNumberMapper:M,getRowThemeOverride:L}}function Xs(t,r){const c=ge.useMemo(()=>t===void 0?void 0:An(t,r),[t,r]);return{getRowGroupingForPath:Fr,updateRowGroupingByPath:Hr,mapper:ge.useCallback(g=>{if(typeof g=="number")return $n(g,c);const w=$n(g[1],c);return{...w,originalIndex:[g[0],w.originalIndex]}},[c])}}function Hr(t,r,c){const[g,...w]=r;return w[0]===-1?t.map((k,I)=>I===g?{...k,...c}:k):t.map((k,I)=>I===g?{...k,subGroups:Hr(k.subGroups??[],w,c)}:k)}function Fr(t,r){const[c,...g]=r;return g[0]===-1?t[c]:Fr(t[c].subGroups??[],g)}function Ys(t,r){const[c]=l.useState(()=>({value:t,callback:r,facade:{get current(){return c.value},set current(g){const w=c.value;w!==g&&(c.value=g,c.callback(g,w))}}}));return c.callback=r,c.facade}function qs(t,r,c,g,w){const[k,I]=l.useMemo(()=>[r!==void 0&&typeof c=="number"?Math.floor(r/c):0,r!==void 0&&typeof c=="number"?-(r%c):0],[r,c]),x=l.useMemo(()=>({x:g.current.x,y:k,width:g.current.width??1,height:g.current.height??1,ty:I}),[g,I,k]),[M,L,m]=yi(x),b=l.useRef(w);b.current=w;const S=Ys(null,O=>{O!==null&&r!==void 0?O.scrollTop=r:O!==null&&t!==void 0&&(O.scrollLeft=t)}),W=(M.height??1)>1;l.useLayoutEffect(()=>{if(r!==void 0&&S.current!==null&&W){if(S.current.scrollTop===r)return;S.current.scrollTop=r,S.current.scrollTop!==r&&m(),b.current()}},[r,W,m,S]);const _=(M.width??1)>1;return l.useLayoutEffect(()=>{if(t!==void 0&&S.current!==null&&_){if(S.current.scrollLeft===t)return;S.current.scrollLeft=t,S.current.scrollLeft!==t&&m(),b.current()}},[t,_,m,S]),{visibleRegion:M,setVisibleRegion:L,scrollRef:S}}const Zs=tn("textarea")({name:"GhostInputBox",class:"gxeqqyx",propsAsIs:!1}),Js=(t,r)=>{const{onInput:c,onCompositionStart:g,onCompositionEnd:w,onKeyDown:k,onKeyUp:I,onFocus:x,onBlur:M,disabled:L=!1}=t,m=l.useRef(null),b=l.useRef(!1),S=l.useRef({width:0,height:0}),W=l.useCallback(()=>{const z=m.current;if(!z||z.style.opacity==="0")return;const J=S.current.width,de=S.current.height;z.style.width=`${J}px`,z.style.height=`${de}px`;const X=Math.max(J,z.scrollWidth+2),q=Math.max(de,z.scrollHeight+2);z.style.width=`${X}px`,z.style.height=`${q}px`},[]);l.useImperativeHandle(r,()=>({focus:()=>{var z;(z=m.current)==null||z.focus({preventScroll:!0})},blur:()=>{var z;(z=m.current)==null||z.blur()},clear:()=>{m.current&&(m.current.value="",m.current.setSelectionRange(0,0))},getValue:()=>{var z;return((z=m.current)==null?void 0:z.value)??""},setValue:z=>{if(m.current){m.current.value=z;const J=z.length;m.current.setSelectionRange(J,J)}},setPosition:(z,J,de,X)=>{const q=m.current;q&&(S.current={width:de,height:X},q.style.left=`${z}px`,q.style.top=`${J}px`,q.style.width=`${de}px`,q.style.height=`${X}px`)},setVisible:z=>{const J=m.current;J&&(z?(J.style.opacity="1",J.style.pointerEvents="auto",J.style.zIndex="10000"):(J.style.left="-9999px",J.style.top="0",J.style.width="1px",J.style.height="1px",J.style.opacity="0",J.style.pointerEvents="none",J.style.zIndex="0"))}}));const _=l.useCallback(z=>{const J=z.currentTarget;c(J.value,b.current),W()},[c,W]),O=l.useCallback(()=>{b.current=!0,g()},[g]),ce=l.useCallback(z=>{b.current=!1,w(z.currentTarget.value)},[w]),me=l.useCallback(z=>{k(z)},[k]),A=l.useCallback(z=>{I==null||I(z)},[I]);return l.createElement(Zs,{ref:m,defaultValue:"",tabIndex:L?-1:0,disabled:L,onInput:_,onCompositionStart:O,onCompositionEnd:ce,onKeyDown:me,onKeyUp:A,onFocus:x,onBlur:M,"aria-label":"Grid input",wrap:"off",rows:1,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1})},Qs=l.memo(l.forwardRef(Js)),js=l.lazy(async()=>await vi(()=>import("./image-window-loader-DJOs-Z_J.js").then(t=>t.$),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url));let ec=0;function tc(t){return Oi(Sr(Sr(t).filter(r=>r.span!==void 0).map(r=>{var c,g;return Yt((((c=r.span)==null?void 0:c[0])??0)+1,(((g=r.span)==null?void 0:g[1])??0)+1)})))}function Qo(t,r){return t===void 0||r===0||t.columns.length===0&&t.current===void 0?t:{current:t.current===void 0?void 0:{cell:[t.current.cell[0]+r,t.current.cell[1]],range:{...t.current.range,x:t.current.range.x+r},rangeStack:t.current.rangeStack.map(c=>({...c,x:c.x+r}))},rows:t.rows,columns:t.columns.offset(r)}}const pt={kind:Q.Loading,allowOverlay:!1},Hn={columns:oe.empty(),rows:oe.empty(),current:void 0},oc=(t,r)=>{var pr,Cr,wr;const[c,g]=l.useState(Hn),[w,k]=l.useState(),I=l.useRef(null),x=l.useRef(null),[M,L]=l.useState(),m=l.useRef(void 0),b=l.useRef(null),[S,W]=l.useState(!1),_=l.useRef(S);_.current=S;const O=l.useRef(w);O.current=w;const ce=typeof window>"u"?null:window,{imageEditorOverride:me,getRowThemeOverride:A,markdownDivCreateNode:z,width:J,height:de,columns:X,rows:q,getCellContent:te,onCellClicked:ie,onCellActivated:K,onFillPattern:Oe,onFinishedEditing:Fe,coercePasteValue:Ie,drawHeader:rt,drawCell:Xe,editorBloom:Gt,onHeaderClicked:Ye,onColumnProposeMove:lt,rangeSelectionColumnSpanning:go=!0,spanRangeBehavior:mo="default",onGroupHeaderClicked:F,onCellContextMenu:re,className:we,onHeaderContextMenu:ye,getCellsForSelection:Je,onGroupHeaderContextMenu:Se,onGroupHeaderRenamed:Qe,onCellEdited:wt,onCellsEdited:yt,onSearchResultsChanged:je,searchResults:vo,onSearchValueChange:on,searchValue:po,onKeyDown:qt,onKeyUp:bt,keybindings:nn,editOnType:Zt=!0,onRowAppended:it,onColumnAppended:st,onColumnMoved:xt,validateCell:Le,highlightRegions:De,rangeSelect:kt="rect",columnSelect:He="multi",rowSelect:$e="multi",rangeSelectionBlending:$r="exclusive",columnSelectionBlending:Ar="exclusive",rowSelectionBlending:Gr="exclusive",onDelete:rn,onDragStart:Co,onMouseMove:wo,onPaste:Rt,copyHeaders:Gn=!1,freezeColumns:et=0,cellActivationBehavior:yo="second-click",rowSelectionMode:ln="auto",columnSelectionMode:Jt="auto",onHeaderMenuClick:bo,onHeaderIndicatorClick:xo,getGroupDetails:ko,rowGrouping:ct,onSearchClose:sn,onItemHovered:Ro,onSelectionCleared:at,showSearch:Kr,onVisibleRegionChanged:Mo,gridSelection:Mt,onGridSelectionChange:cn,minColumnWidth:Pr=50,maxColumnWidth:Nr=500,maxColumnAutoWidth:Wr,provideEditor:Vr,trailingRowOptions:j,freezeTrailingRows:tt=0,allowedFillDirections:Kn="orthogonal",scrollOffsetX:Or,scrollOffsetY:Br,verticalBorder:Kt,onDragOverCell:Ur,onDrop:_r,onColumnResize:Qt,onColumnResizeEnd:jt,onColumnResizeStart:eo,customRenderers:So,fillHandle:Xr,experimental:fe,fixedShadowX:Yr,fixedShadowY:qr,headerIcons:Zr,imageWindowLoader:Jr,initialSize:Qr,isDraggable:jr,onDragLeave:el,onRowMoved:to,overscrollX:tl,overscrollY:ol,preventDiagonalScrolling:nl,rightElement:rl,rightElementProps:ll,trapFocus:Pn=!1,smoothScrollX:il,smoothScrollY:sl,scaleToRem:cl=!1,rowHeight:al=34,headerHeight:Nn=36,groupHeaderHeight:ul=Nn,theme:dl,isOutsideClick:fl,renderers:an,resizeIndicator:hl,scrollToActiveCell:Wn=!0,drawFocusRing:Vn=!0,portalElementRef:Eo,onRowStatus:To,onRowId:zo}=t,On=Vn==="no-editor"?w===void 0:Vn,P=typeof t.rowMarkers=="string"?void 0:t.rowMarkers,gl=(P==null?void 0:P.rowNumber)??!1;let Io=(P==null?void 0:P.kind)??t.rowMarkers??"none",ot=gl;(Io==="both"||Io==="checkbox-and-number")&&(Io="checkbox",ot=!0);const Ae=Io,ml=(P==null?void 0:P.width)??t.rowMarkerWidth,un=(P==null?void 0:P.startIndex)??t.rowMarkerStartIndex??1,dn=(P==null?void 0:P.theme)??t.rowMarkerTheme,fn=P==null?void 0:P.headerTheme,Bn=P==null?void 0:P.headerAlwaysVisible,Lo=$e!=="multi"||(P==null?void 0:P.headerDisabled)===!0,Pt=(P==null?void 0:P.checkboxStyle)??"square",vl=(P==null?void 0:P.rowStatus)??!1,Un=(P==null?void 0:P.rowStatusWidth)??40,Do=P==null?void 0:P.rowStatusTheme,pl=(P==null?void 0:P.rowId)??!1,_n=(P==null?void 0:P.rowIdWidth)??80,Ho=P==null?void 0:P.rowIdTheme,Nt=Math.max(Pr,20),Fo=Math.max(Nr,Nt),Cl=Math.max(Wr??Fo,Nt),Xn=l.useMemo(()=>typeof window>"u"?{fontSize:"16px"}:window.getComputedStyle(document.documentElement),[]),{rows:$,rowNumberMapper:hn,rowHeight:wl,getRowThemeOverride:nt}=_s(ct,q,al,A),yl=l.useMemo(()=>Number.parseFloat(Xn.fontSize),[Xn]),{rowHeight:ut,headerHeight:Yn,groupHeaderHeight:gn,theme:qn,overscrollX:bl,overscrollY:xl}=Os({groupHeaderHeight:ul,headerHeight:Nn,overscrollX:tl,overscrollY:ol,remSize:yl,rowHeight:wl,scaleToRem:cl,theme:dl}),dt=Bs(nn),St=ml??(q>1e4?48:q>1e3?44:q>100?36:32),qe=Ae!=="none",oo=vl===!0,no=pl===!0,d=(qe?ot?2:1:0)+(oo?1:0)+(no?1:0),se=j!==void 0,ro=(j==null?void 0:j.sticky)===!0,[kl,Zn]=l.useState(!1),Rl=Kr??kl,Ml=l.useCallback(()=>{sn!==void 0?sn():Zn(!1)},[sn]),h=l.useMemo(()=>Mt===void 0?void 0:Qo(Mt,d),[Mt,d])??c,Ge=l.useRef(new AbortController);l.useEffect(()=>()=>Ge==null?void 0:Ge.current.abort(),[]);const[ve,Sl]=$s(Je,te,d,Ge.current,$),El=l.useCallback((e,o,n)=>{if(Le===void 0)return!0;const i=[e[0]-d,e[1]];return Le==null?void 0:Le(i,o,n)},[d,Le]),$o=l.useRef(Mt),Ke=l.useCallback((e,o)=>{o&&(e=bi(e,ve,d,mo,Ge.current)),cn!==void 0?($o.current=Qo(e,-d),cn($o.current)):g(e)},[cn,ve,d,mo]),Wt=Ct(Qt,l.useCallback((e,o,n,i)=>{Qt==null||Qt(X[n-d],o,n-d,i)},[Qt,d,X])),Tl=Ct(jt,l.useCallback((e,o,n,i)=>{jt==null||jt(X[n-d],o,n-d,i)},[jt,d,X])),zl=Ct(eo,l.useCallback((e,o,n,i)=>{eo==null||eo(X[n-d],o,n-d,i)},[eo,d,X])),Il=Ct(rt,l.useCallback((e,o)=>(rt==null?void 0:rt({...e,columnIndex:e.columnIndex-d},o))??!1,[rt,d])),Ll=Ct(Xe,l.useCallback((e,o)=>(Xe==null?void 0:Xe({...e,col:e.col-d},o))??!1,[Xe,d])),ft=l.useCallback(e=>{if(rn!==void 0){const o=rn(Qo(e,-d));return typeof o=="boolean"?o:Qo(o,d)}return!0},[rn,d]),[pe,Re,he]=Fs(h,Ke,$r,Ar,Gr,kt,go),be=l.useMemo(()=>Ln(zr(),qn),[qn]),[mn,Dl]=l.useState([0,0,0]),Jn=l.useMemo(()=>{if(an===void 0)return{};const e={};for(const o of an)e[o.kind]=o;return e},[an]),Me=l.useCallback(e=>e.kind!==Q.Custom?Jn[e.kind]:So==null?void 0:So.find(o=>o.isMatch(e)),[So,Jn]);let{sizedColumns:Pe,nonGrowWidth:Qn}=Ds(X,$,Sl,mn[0]-(d===0?0:St)-mn[2],Nt,Cl,be,Me,Ge.current);Ae!=="none"&&(Qn+=St);const lo=l.useMemo(()=>{let e=0;for(const o of Pe)o.group!==void 0&&(typeof o.group=="string"?e=Math.max(e,1):e=Math.max(e,o.group.length));return e},[Pe]),jn=lo>0,er=l.useMemo(()=>lo===0?[]:Array(lo).fill(gn),[lo,gn]),Hl=er.reduce((e,o)=>e+o,0),io=Yn+Hl,tr=h.rows.length,or=Ae==="none"?void 0:tr===0?!1:tr===$?!0:void 0,Z=l.useMemo(()=>{const e=[];return Ae!=="none"&&(ot&&e.push({title:"",width:St,icon:void 0,hasMenu:!1,style:"normal",themeOverride:dn,rowMarker:Pt,rowMarkerChecked:!1,headerRowMarkerTheme:fn,headerRowMarkerAlwaysVisible:!1,headerRowMarkerDisabled:!0}),e.push({title:"",width:St,icon:void 0,hasMenu:!1,style:"normal",themeOverride:dn,rowMarker:Pt,rowMarkerChecked:or,headerRowMarkerTheme:fn,headerRowMarkerAlwaysVisible:Bn,headerRowMarkerDisabled:Lo})),oo&&e.push({title:"",width:Un,icon:void 0,hasMenu:!1,style:"normal",themeOverride:Do}),no&&e.push({title:"ID",width:_n,icon:void 0,hasMenu:!1,style:"normal",themeOverride:Ho}),[...e,...Pe]},[oo,Un,Do,no,_n,Ho,Ae,Pe,St,dn,Pt,or,fn,Bn,Lo,ot]),Ee=l.useRef({height:1,width:1,x:0,y:0}),Ao=l.useRef(!1),{setVisibleRegion:nr,visibleRegion:Et,scrollRef:ee}=qs(Or,Br,ut,Ee,()=>Ao.current=!0);Ee.current=Et;const Fl=Et.x+d,Go=Et.y,ae=l.useRef(null),xe=l.useCallback(e=>{var o;e===!0?(o=b.current)==null||o.focus():window.requestAnimationFrame(()=>{var n;(n=b.current)==null||n.focus()})},[]),ke=se?$+1:$,Ne=l.useCallback(e=>{console.log("[mangledOnCellsEdited] items:",e),console.log("[mangledOnCellsEdited] rowMarkerOffset:",d);const o=d===0?e:e.map(i=>({...i,location:[i.location[0]-d,i.location[1]]}));console.log("[mangledOnCellsEdited] mangledItems:",o),console.log("[mangledOnCellsEdited] onCellsEdited:",yt);const n=yt==null?void 0:yt(o);if(console.log("[mangledOnCellsEdited] onCellsEdited result:",n),n!==!0){console.log("[mangledOnCellsEdited] calling onCellEdited for each item, onCellEdited:",wt);for(const i of o)console.log("[mangledOnCellsEdited] calling onCellEdited with:",i.location,i.value),wt==null||wt(i.location,i.value)}return n},[wt,yt,d]),[Tt,vn]=l.useState(),Ko=h.current!==void 0&&h.current.range.width*h.current.range.height>1?h.current.range:void 0,Vt=On?(pr=h.current)==null?void 0:pr.cell:void 0,Po=Vt==null?void 0:Vt[0],No=Vt==null?void 0:Vt[1],$l=l.useMemo(()=>{if((De===void 0||De.length===0)&&(Ko??Po??No??Tt)===void 0)return;const e=[];if(De!==void 0)for(const o of De){const n=Z.length-o.range.x-d;n>0&&e.push({color:o.color,range:{...o.range,x:o.range.x+d,width:Math.min(n,o.range.width)},style:o.style})}return Tt!==void 0&&e.push({color:br(be.accentColor,0),range:Tt,style:"dashed"}),Ko!==void 0&&e.push({color:br(be.accentColor,.5),range:Ko,style:"solid-outline"}),Po!==void 0&&No!==void 0&&e.push({color:be.accentColor,range:{x:Po,y:No,width:1,height:1},style:"solid-outline"}),e.length>0?e:void 0},[Tt,Ko,Po,No,De,Z.length,be.accentColor,d]),rr=l.useRef(Z);rr.current=Z;const Ce=l.useCallback(([e,o],n=!1)=>{var p,y,R,C,V,D,N,G,T;const i=se&&o===ke-1;let s=0,f=-1,a=-1,u=-1,v=-1;if(qe&&ot&&(f=s++),qe&&(a=s++),oo&&(u=s++),no&&(v=s++),e===f){if(i)return pt;const E=hn(o);return E===void 0?pt:{kind:Ht.Marker,allowOverlay:!1,checkboxStyle:Pt,checked:!1,markerKind:"number",row:un+E,drawHandle:!1,cursor:void 0,disabled:((p=t.disabledRows)==null?void 0:p.call(t,o))===!0}}if(e===a){if(i)return pt;const E=hn(o);if(E===void 0)return pt;let Y;return ot?Y=Ae==="checkbox-visible"?"checkbox-visible":"checkbox":Ae==="clickable-number"?Y="number":Y=Ae,{kind:Ht.Marker,allowOverlay:!1,checkboxStyle:Pt,checked:(h==null?void 0:h.rows.hasIndex(o))===!0,markerKind:Y,row:un+E,drawHandle:to!==void 0,cursor:ot?void 0:Ae==="clickable-number"?"pointer":void 0,disabled:((y=t.disabledRows)==null?void 0:y.call(t,o))===!0}}if(e===u){if(i)return pt;const E=To==null?void 0:To(o);return{kind:Ht.RowStatus,allowOverlay:!1,status:E,themeOverride:Do}}if(e===v){if(i)return pt;const E=zo==null?void 0:zo(o);return{kind:Ht.RowId,allowOverlay:!1,rowId:E,themeOverride:Ho}}if(i){const Y=e===d?(j==null?void 0:j.hint)??"":"",H=rr.current[e];if(((R=H==null?void 0:H.trailingRowOptions)==null?void 0:R.disabled)===!0)return pt;{const ue=((C=H==null?void 0:H.trailingRowOptions)==null?void 0:C.hint)??Y,Te=((V=H==null?void 0:H.trailingRowOptions)==null?void 0:V.addIcon)??(j==null?void 0:j.addIcon);return{kind:Ht.NewRow,hint:ue,allowOverlay:!1,icon:Te}}}else{const E=e-d;if(n||(fe==null?void 0:fe.strict)===!0){const H=Ee.current,ue=H.x>E||E>H.x+H.width||H.y>o||o>H.y+H.height||o>=yn.current,Te=E===((N=(D=H.extras)==null?void 0:D.selected)==null?void 0:N[0])&&o===((G=H.extras)==null?void 0:G.selected[1]);let ze=!1;if(((T=H.extras)==null?void 0:T.freezeRegions)!==void 0){for(const Ve of H.extras.freezeRegions)if(xi(Ve,E,o)){ze=!0;break}}if(ue&&!Te&&!ze)return pt}let Y=te([E,o]);return d!==0&&Y.span!==void 0&&(Y={...Y,span:[Y.span[0]+d,Y.span[1]+d]}),Y}},[se,ke,oo,To,Do,no,zo,Ho,qe,hn,Pt,h==null?void 0:h.rows,Ae,un,to,d,j==null?void 0:j.hint,j==null?void 0:j.addIcon,fe==null?void 0:fe.strict,te,ot]),pn=l.useCallback(e=>{let o=(ko==null?void 0:ko(e))??{name:e};return Qe!==void 0&&e!==""&&(o={icon:o.icon,name:o.name,overrideTheme:o.overrideTheme,actions:[...o.actions??[],{title:"Rename",icon:"renameIcon",onClick:n=>xn({group:o.name,bounds:n.bounds})}]}),o},[ko,Qe]),Wo=l.useCallback(e=>{var u;const[o,n]=e.cell,i=Z[o],s=(i==null?void 0:i.group)!==void 0?(u=pn(i.group))==null?void 0:u.overrideTheme:void 0,f=i==null?void 0:i.themeOverride,a=nt==null?void 0:nt(n);k({...e,theme:Ln(be,s,f,a,e.content.themeOverride)})},[nt,Z,pn,be]),Be=l.useCallback((e,o,n)=>{var a,u,v,p;if(h.current===void 0)return;const[i,s]=h.current.cell,f=Ce([i,s]);if(f.kind!==Q.Boolean&&f.allowOverlay){let y=f;if(n!==void 0)switch(y.kind){case Q.Number:{const C=ki(()=>n==="-"?-0:Number.parseFloat(n),0);y={...y,data:Number.isNaN(C)?0:C};break}case Q.Text:case Q.Markdown:case Q.Uri:y={...y,data:n};break}Wo({target:e,content:y,initialValue:n,cell:[i,s],highlight:n===void 0,forceEditMode:n!==void 0,activation:o}),n!==void 0&&((a=b.current)==null||a.setPosition(e.x,e.y,e.width,e.height),n.length>0&&((u=b.current)==null||u.setValue(n)),(v=b.current)==null||v.setVisible(!0),W(!0))}else f.kind===Q.Boolean&&o.inputType==="keyboard"&&f.readonly!==!0&&(Ne([{location:h.current.cell,value:{...f,data:Ri(f.data)}}]),(p=ae.current)==null||p.damage([{cell:h.current.cell}]))},[Ce,h,Ne,Wo]),lr=l.useCallback((e,o)=>{var s;const n=(s=ae.current)==null?void 0:s.getBounds(e,o);if(n===void 0||ee.current===null)return;const i=Ce([e,o]);i.allowOverlay&&Wo({target:n,content:i,initialValue:void 0,highlight:!0,cell:[e,o],forceEditMode:!0,activation:{inputType:"keyboard",key:"Enter"}})},[Ce,ee,Wo]),le=l.useCallback((e,o,n="both",i=0,s=0,f=void 0)=>{if(ee.current!==null){const a=ae.current,u=x.current,v=typeof e!="number"?e.unit==="cell"?e.amount:void 0:e,p=typeof o!="number"?o.unit==="cell"?o.amount:void 0:o,y=typeof e!="number"&&e.unit==="px"?e.amount:void 0,R=typeof o!="number"&&o.unit==="px"?o.amount:void 0;if(a!==null&&u!==null){let C={x:0,y:0,width:0,height:0},V=0,D=0;if((v!==void 0||p!==void 0)&&(C=a.getBounds((v??0)+d,p??0)??C,C.width===0||C.height===0))return;const N=u.getBoundingClientRect(),G=N.width/u.offsetWidth;if(y!==void 0&&(C={...C,x:y-N.left-ee.current.scrollLeft,width:1}),R!==void 0&&(C={...C,y:R+N.top-ee.current.scrollTop,height:1}),C!==void 0){const T={x:C.x-i,y:C.y-s,width:C.width+2*i,height:C.height+2*s};let E=0;for(let In=0;In<et;In++)E+=Pe[In].width;let Y=0;const H=tt+(ro?1:0);H>0&&(Y=Mi(ke,H,ut));let ue=E*G+N.left+d*St*G,Te=N.right,ze=N.top+io*G,Ve=N.bottom-Y*G;const Yo=C.width+i*2;switch(f==null?void 0:f.hAlign){case"start":Te=ue+Yo;break;case"end":ue=Te-Yo;break;case"center":ue=Math.floor((ue+Te)/2)-Yo/2,Te=ue+Yo;break}const qo=C.height+s*2;switch(f==null?void 0:f.vAlign){case"start":Ve=ze+qo;break;case"end":ze=Ve-qo;break;case"center":ze=Math.floor((ze+Ve)/2)-qo/2,Ve=ze+qo;break}ue>T.x?V=T.x-ue:Te<T.x+T.width&&(V=T.x+T.width-Te),ze>T.y?D=T.y-ze:Ve<T.y+T.height&&(D=T.y+T.height-Ve),n==="vertical"||typeof e=="number"&&e<et?V=0:(n==="horizontal"||typeof o=="number"&&o>=ke-H)&&(D=0),(V!==0||D!==0)&&(G!==1&&(V/=G,D/=G),ee.current.scrollTo({left:V+ee.current.scrollLeft,top:D+ee.current.scrollTop,behavior:(f==null?void 0:f.behavior)??"auto"}))}}}},[d,tt,St,ee,io,et,Pe,ke,ro,ut]),Cn=l.useRef(lr),wn=l.useRef(te);Cn.current=lr,wn.current=te;const yn=l.useRef($);yn.current=$;const ir=l.useRef(Z.length);ir.current=Z.length;const ht=l.useCallback(async(e,o=!0,n)=>{var p;const i=Z[e];if(((p=i==null?void 0:i.trailingRowOptions)==null?void 0:p.disabled)===!0)return;const s=it==null?void 0:it();let f,a=!0;s!==void 0&&(f=await s,f==="top"&&(a=!1),typeof f=="number"&&(a=!1));let u=0;const v=()=>{if(yn.current<=$){u<500&&window.setTimeout(v,u),u=50+u*2;return}const y=typeof f=="number"?f:a?$:0;Xo.current(e-d,y,"both",0,20,n?{behavior:n}:void 0),pe({cell:[e,y],range:{x:e,y,width:1,height:1}},!1,!1,"edit");const R=wn.current([e-d,y]);R.allowOverlay&&Ft(R)&&R.readonly!==!0&&o&&window.setTimeout(()=>{Cn.current(e,y)},0)};v()},[Z,it,d,$,pe]),Vo=l.useCallback(async(e,o=!0)=>{const n=st==null?void 0:st();let i,s=!0;n!==void 0&&(i=await n,i==="left"&&(s=!1),typeof i=="number"&&(s=!1));let f=0;const a=()=>{if(ir.current<=Z.length){f<500&&window.setTimeout(a,f),f=50+f*2;return}const u=typeof i=="number"?i:s?Z.length:0;le(u-d,e),pe({cell:[u,e],range:{x:u,y:e,width:1,height:1}},!1,!1,"edit");const v=wn.current([u-d,e]);v.allowOverlay&&Ft(v)&&v.readonly!==!0&&o&&window.setTimeout(()=>{Cn.current(u,e)},0)};a()},[Z,st,d,le,pe]),Ot=l.useCallback(e=>{var n,i;const o=((i=(n=Pe[e])==null?void 0:n.trailingRowOptions)==null?void 0:i.targetColumn)??(j==null?void 0:j.targetColumn);if(typeof o=="number")return o+(qe?1:0);if(typeof o=="object"){const s=X.indexOf(o);if(s>=0)return s+(qe?1:0)}},[Pe,X,qe,j==null?void 0:j.targetColumn]),gt=l.useRef(void 0),Bt=l.useRef(void 0),so=l.useCallback((e,o)=>{var s;const[n,i]=o;return Ln(be,(s=Z[n])==null?void 0:s.themeOverride,nt==null?void 0:nt(i),e.themeOverride)},[nt,Z,be]),{mapper:zt}=Xs(ct,q),Ue=ct==null?void 0:ct.navigationBehavior,co=l.useCallback(e=>{var p,y,R;const o=en.value?e.metaKey:e.ctrlKey,n=o&&$e==="multi",[i,s]=e.location,f=h.columns,a=h.rows,[u,v]=((p=h.current)==null?void 0:p.cell)??[];if(e.kind==="cell"){if(Bt.current=void 0,It.current=[i,s],i===(ot?1:0)&&qe){if(se===!0&&s===$||Ae==="number"||$e==="none")return;const D=Ce(e.location);if(D.kind!==Ht.Marker||D.disabled===!0)return;if(to!==void 0){const T=Me(D);jo((T==null?void 0:T.kind)===Ht.Marker);const E=(y=T==null?void 0:T.onClick)==null?void 0:y.call(T,{...e,cell:D,posX:e.localEventX,posY:e.localEventY,bounds:e.bounds,theme:so(D,e.location),preventDefault:()=>{}});if(E===void 0||E.checked===D.checked)return}k(void 0),xe();const N=a.hasIndex(s),G=gt.current;if($e==="multi"&&(e.shiftKey||e.isLongTouch===!0)&&G!==void 0&&a.hasIndex(G)){const T=[Math.min(G,s),Math.max(G,s)+1];n||ln==="multi"?Re(void 0,T,!0):Re(oe.fromSingleSelection(T),void 0,n)}else $e==="multi"&&(n||e.isTouch||ln==="multi")?N?Re(a.remove(s),void 0,!0):(Re(void 0,s,!0),gt.current=s):N&&a.length===1?Re(oe.empty(),void 0,o):(Re(oe.fromSingleSelection(s),void 0,o),gt.current=s)}else if(i>=d&&se&&s===$){const D=Ot(i);ht(D??i)}else if(u!==i||v!==s){const D=Ce(e.location),N=Me(D);if((N==null?void 0:N.onSelect)!==void 0){let E=!1;if(N.onSelect({...e,cell:D,posX:e.localEventX,posY:e.localEventY,bounds:e.bounds,preventDefault:()=>E=!0,theme:so(D,e.location)}),E)return}if(Ue==="block"&&zt(s).isGroupHeader)return;const G=ro&&s===$,T=ro&&h!==void 0&&((R=h.current)==null?void 0:R.cell[1])===$;if((e.shiftKey||e.isLongTouch===!0)&&u!==void 0&&v!==void 0&&h.current!==void 0&&!T){if(G)return;const E=Math.min(i,u),Y=Math.max(i,u),H=Math.min(s,v),ue=Math.max(s,v);pe({...h.current,range:{x:E,y:H,width:Y-E+1,height:ue-H+1}},!0,o,"click"),gt.current=void 0,xe()}else{const E=h.rows.length>0;pe({cell:[i,s],range:{x:i,y:s,width:1,height:1}},!0,o||E,"click"),gt.current=void 0,k(void 0),xe()}}}else if(e.kind==="header")if(It.current=[i,s],k(void 0),qe&&i===0)gt.current=void 0,Bt.current=void 0,!Lo&&$e==="multi"&&(a.length!==$?Re(oe.fromSingleSelection([0,$]),void 0,o):Re(oe.empty(),void 0,o),xe());else{const C=Bt.current;if(He==="multi"&&(e.shiftKey||e.isLongTouch===!0)&&C!==void 0&&f.hasIndex(C)){const V=[Math.min(C,i),Math.max(C,i)+1];o||e.isTouch||Jt==="multi"?he(void 0,V,o):he(oe.fromSingleSelection(V),void 0,o)}else He==="multi"&&(o||e.isTouch||Jt==="multi")?(f.hasIndex(i)?he(f.remove(i),void 0,o):he(void 0,i,o),Bt.current=i):He!=="none"&&(f.hasIndex(i)?he(f.remove(i),void 0,o):he(oe.fromSingleSelection(i),void 0,o),Bt.current=i);gt.current=void 0,xe()}else e.kind===Xt?It.current=[i,s]:e.kind===xr&&!e.isMaybeScrollbar&&(Ke(Hn,!1),k(void 0),xe(),at==null||at(),gt.current=void 0,Bt.current=void 0)},[$e,He,h,qe,d,se,$,Ae,Ce,to,xe,ln,Jt,Me,so,Re,Ot,ht,Ue,zt,ro,pe,Lo,he,Ke,at]),ao=l.useRef(!1),It=l.useRef(void 0),sr=l.useRef(Et),We=l.useRef(void 0),Al=l.useCallback(e=>{if(Ut.current=!1,sr.current=Ee.current,e.button!==0&&e.button!==1){We.current=void 0;return}const o=performance.now();We.current={button:e.button,time:o,location:e.location},(e==null?void 0:e.kind)==="header"&&(ao.current=!0);const n=e.kind==="cell"&&e.isFillHandle;!n&&e.kind!=="cell"&&e.isEdge||(L({previousSelection:h,fillHandle:n}),It.current=void 0,!e.isTouch&&e.button===0&&!n?co(e):!e.isTouch&&e.button===1&&(It.current=e.location))},[h,co]),[bn,xn]=l.useState(),cr=l.useCallback(e=>{if(e.kind!==Xt||He!=="multi")return;const o=en.value?e.metaKey:e.ctrlKey,[n,i]=e.location,s=h.columns;if(n<d)return;const f=Z[n];let a=n,u=n;const v=i<=-2?-(i+2):0,p=Array.isArray(f.group)?f.group.length:1,y=(R,C)=>p>1?Ki(R,C,v,p):Pi(R,C);for(let R=n-1;R>=d&&y(f.group,Z[R].group);R--)a--;for(let R=n+1;R<Z.length&&y(f.group,Z[R].group);R++)u++;if(xe(),o||e.isTouch||Jt==="multi")if(s.hasAll([a,u+1])){let R=s;for(let C=a;C<=u;C++)R=R.remove(C);he(R,void 0,o)}else he(void 0,[a,u+1],o);else he(oe.fromSingleSelection([a,u+1]),void 0,o)},[He,xe,h.columns,Z,d,he,Jt]),Ut=l.useRef(!1),Oo=l.useCallback(async e=>{if(ve!==void 0&&Wt!==void 0){const o=Ee.current.y,n=Ee.current.height;let i=ve({x:e,y:o,width:1,height:Math.min(n,$-o)},Ge.current.signal);typeof i!="object"&&(i=await i());const s=Pe[e-d],a=document.createElement("canvas").getContext("2d",{alpha:!1});if(a!==null){a.font=be.baseFontFull;const u=Lr(a,be,s,0,i,Nt,Fo,!1,Me);Wt==null||Wt(s,u.width,e,u.width)}}},[Pe,ve,Fo,be,Nt,Wt,d,$,Me]),[Gl,kn]=l.useState(),_t=l.useCallback(async(e,o)=>{var u,v;const n=(u=e.current)==null?void 0:u.range;if(n===void 0||ve===void 0||o.current===void 0)return;const i=o.current.range;if(Oe!==void 0){let p=!1;if(Oe({fillDestination:{...i,x:i.x-d},patternSource:{...n,x:n.x-d},preventDefault:()=>p=!0}),p)return}let s=ve(n,Ge.current.signal);typeof s!="object"&&(s=await s());const f=s,a=[];for(let p=0;p<i.width;p++)for(let y=0;y<i.height;y++){const R=[i.x+p,i.y+y];if(Si(R,n))continue;const C=f[y%n.height][p%n.width];Jo(C)||!Ft(C)||a.push({location:R,value:{...C}})}Ne(a),(v=ae.current)==null||v.damage(a.map(p=>({cell:p.location})))},[ve,Ne,Oe,d]),ar=l.useCallback(()=>{if(h.current===void 0||h.current.range.width<=1)return;const e={...h,current:{...h.current,range:{...h.current.range,width:1}}};_t(e,h)},[_t,h]),ur=l.useCallback(()=>{if(h.current===void 0||h.current.range.height<=1)return;const e={...h,current:{...h.current,range:{...h.current.range,height:1}}};_t(e,h)},[_t,h]),Kl=l.useCallback((e,o)=>{var y,R;const n=M;if(L(void 0),vn(void 0),kn(void 0),ao.current=!1,o)return;if((n==null?void 0:n.fillHandle)===!0&&h.current!==void 0&&((y=n.previousSelection)==null?void 0:y.current)!==void 0){if(Tt===void 0)return;const C={...h,current:{...h.current,range:Ei(n.previousSelection.current.range,Tt)}};_t(n.previousSelection,C),Ke(C,!0);return}const[i,s]=e.location,[f,a]=It.current??[],u=()=>{Ut.current=!0},v=C=>{var D,N,G;const V=C.isTouch||f===i&&a===s;if(V&&(ie==null||ie([i-d,s],{...C,preventDefault:u})),C.button===1)return!Ut.current;if(!Ut.current){const T=Ce(e.location),E=Me(T);if(E!==void 0&&E.onClick!==void 0&&V){const H=E.onClick({...C,cell:T,posX:C.localEventX,posY:C.localEventY,bounds:C.bounds,theme:so(T,e.location),preventDefault:u});H!==void 0&&!Jo(H)&&$t(H)&&(Ne([{location:C.location,value:H}]),(D=ae.current)==null||D.damage([{cell:C.location}]))}if(Ut.current||h.current===void 0)return!1;let Y=!1;switch(T.activationBehaviorOverride??yo){case"double-click":case"second-click":{if(((G=(N=n==null?void 0:n.previousSelection)==null?void 0:N.current)==null?void 0:G.cell)===void 0)break;const[H,ue]=h.current.cell,[Te,ze]=n.previousSelection.current.cell;Y=i===H&&i===Te&&s===ue&&s===ze&&(C.isDoubleClick===!0||yo==="second-click");break}case"single-click":{Y=!0;break}}if(Y){const ue={inputType:"pointer",pointerActivation:C.isDoubleClick===!0?"double-click":T.activationBehaviorOverride??yo,pointerType:C.isTouch?"touch":"mouse"};return K==null||K([i-d,s],ue),Be(C.bounds,ue),!0}}return!1},p=e.location[0]-d;if(e.isTouch){const C=Ee.current,V=sr.current;if(C.x!==V.x||C.y!==V.y)return;if(e.isLongTouch===!0){if(e.kind==="cell"&&Ti((R=h.current)==null?void 0:R.cell,e.location)){re==null||re([p,e.location[1]],{...e,preventDefault:u});return}else if(e.kind==="header"&&h.columns.hasIndex(i)){ye==null||ye(p,{...e,preventDefault:u});return}else if(e.kind===Xt){if(p<0)return;Se==null||Se(p,{...e,preventDefault:u});return}}e.kind==="cell"?v(e)||co(e):e.kind===Xt?F==null||F(p,{...e,preventDefault:u}):(e.kind===zi&&(Ye==null||Ye(p,{...e,preventDefault:u})),co(e));return}if(e.kind==="header"){if(p<0)return;e.isEdge?e.isDoubleClick===!0&&Oo(i):e.button===0&&i===f&&s===a&&(Ye==null||Ye(p,{...e,preventDefault:u}))}if(e.kind===Xt){if(p<0)return;e.button===0&&i===f&&s===a&&(F==null||F(p,{...e,preventDefault:u}),Ut.current||cr(e))}e.kind==="cell"&&(e.button===0||e.button===1)&&v(e),It.current=void 0},[M,h,d,Tt,_t,Ke,ie,Ce,Me,yo,so,Ne,K,Be,re,ye,Se,co,F,Ye,Oo,cr]),Pl=l.useCallback(e=>{const o={...e,location:[e.location[0]-d,e.location[1]]};wo==null||wo(o),M!==void 0&&e.buttons===0&&(L(void 0),vn(void 0),kn(void 0),ao.current=!1),kn(n=>{var i;return ao.current?[e.scrollEdge[0],0]:e.scrollEdge[0]===(n==null?void 0:n[0])&&e.scrollEdge[1]===n[1]?n:M===void 0||(((i=We.current)==null?void 0:i.location[0])??0)<d?void 0:e.scrollEdge})},[M,wo,d]),Nl=l.useCallback((e,o)=>{bo==null||bo(e-d,o)},[bo,d]),Wl=l.useCallback((e,o)=>{xo==null||xo(e-d,o)},[xo,d]);l.useEffect(()=>{if(w===void 0)return;const e=i=>{const s=[];let f=i.parentElement;for(;f&&f!==document.documentElement;){const a=window.getComputedStyle(f),u=a.overflow+a.overflowY+a.overflowX;(u.includes("scroll")||u.includes("auto"))&&s.push(f),f=f.parentElement}return s},o=i=>{const s=i.target;ee.current&&!ee.current.contains(s)&&k(void 0)},n=[];if(ee.current){const i=e(ee.current);n.push(...i)}return n.forEach(i=>{i.addEventListener("scroll",o)}),window.addEventListener("scroll",o),document.addEventListener("scroll",o,!0),()=>{n.forEach(i=>{i.removeEventListener("scroll",o)}),window.removeEventListener("scroll",o),document.removeEventListener("scroll",o,!0)}},[w,k,ee]);const Ze=(Cr=h==null?void 0:h.current)==null?void 0:Cr.cell,Vl=l.useCallback((e,o,n,i,s,f)=>{if(Ao.current=!1,w!==void 0){const y=Ee.current;(y.x!==e.x||y.y!==e.y)&&k(void 0)}let a=Ze;a!==void 0&&(a=[a[0]-d,a[1]]);const u=et===0?void 0:{x:0,y:e.y,width:et,height:e.height},v=[];u!==void 0&&v.push(u),tt>0&&(v.push({x:e.x-d,y:$-tt,width:e.width,height:tt}),et>0&&v.push({x:0,y:$-tt,width:et,height:tt}));const p={x:e.x-d,y:e.y,width:e.width,height:se&&e.y+e.height>=$?e.height-1:e.height,tx:s,ty:f,extras:{selected:a,freezeRegion:u,freezeRegions:v}};Ee.current=p,nr(p),Dl([o,n,i]),Mo==null||Mo(p,p.tx,p.ty,p.extras)},[Ze,w,d,se,$,et,tt,k,nr,Mo]),Ol=Ct(lt,l.useCallback((e,o)=>(lt==null?void 0:lt(e-d,o-d))!==!1,[lt,d])),Bl=Ct(xt,l.useCallback((e,o)=>{xt==null||xt(e-d,o-d),He!=="none"&&he(oe.fromSingleSelection(o),void 0,!0)},[He,xt,d,he])),Rn=l.useRef(!1),Ul=l.useCallback(e=>{if(e.location[0]===0&&d>0){e.preventDefault();return}Co==null||Co({...e,location:[e.location[0]-d,e.location[1]]}),e.defaultPrevented()||(Rn.current=!0),L(void 0)},[Co,d]),_l=l.useCallback(()=>{Rn.current=!1},[]),dr=ct==null?void 0:ct.selectionBehavior,Bo=l.useCallback(e=>{if(dr!=="block-spanning")return;const{isGroupHeader:o,path:n,groupRows:i}=zt(e);if(o)return[e,e];const s=n[n.length-1],f=e-s,a=e+i-s-1;return[f,a]},[zt,dr]),Mn=l.useRef(void 0),Sn=l.useCallback(e=>{var o,n,i;if(!Ii(e,Mn.current)&&(Mn.current=e,!(((o=We==null?void 0:We.current)==null?void 0:o.button)!==void 0&&We.current.button>=1))){if(e.buttons!==0&&M!==void 0&&((n=We.current)==null?void 0:n.location[0])===0&&d===1&&$e==="multi"&&M.previousSelection&&!M.previousSelection.rows.hasIndex(We.current.location[1])&&h.rows.hasIndex(We.current.location[1])){const s=Math.min(We.current.location[1],e.location[1]),f=Math.max(We.current.location[1],e.location[1])+1;Re(oe.fromSingleSelection([s,f]),void 0,!1)}else if(e.buttons!==0&&M!==void 0&&h.current!==void 0&&!Rn.current&&!ao.current&&(kt==="rect"||kt==="multi-rect")){const[s,f]=h.current.cell;let[a,u]=e.location;if(u<0&&(u=Ee.current.y),M.fillHandle===!0&&((i=M.previousSelection)==null?void 0:i.current)!==void 0){const v=M.previousSelection.current.range;u=Math.min(u,se?$-1:$);const p=Li(v,a,u,Kn);vn(p)}else{if(se&&f===$)return;if(se&&u===$)if(e.kind===xr)u--;else return;a=Math.max(a,d);const y=Bo(f);u=y===void 0?u:At(u,y[0],y[1]);const R=a-s,C=u-f,V={x:R>=0?s:a,y:C>=0?f:u,width:Math.abs(R)+1,height:Math.abs(C)+1};pe({...h.current,range:V},!0,!1,"drag")}}Ro==null||Ro({...e,location:[e.location[0]-d,e.location[1]]})}},[M,d,$e,h,kt,Ro,Re,se,$,Kn,Bo,pe]),Xl=l.useCallback(()=>{var a,u;const e=Mn.current;if(e===void 0)return;const[o,n]=e.scrollEdge;let[i,s]=e.location;const f=Ee.current;o===-1?i=((u=(a=f.extras)==null?void 0:a.freezeRegion)==null?void 0:u.x)??f.x:o===1&&(i=f.x+f.width),n===-1?s=Math.max(0,f.y):n===1&&(s=Math.min($-1,f.y+f.height)),i=At(i,0,Z.length-1),s=At(s,0,$-1),Sn({...e,location:[i,s]})},[Z.length,Sn,$]);Vs(Gl,ee,Xl);const _e=l.useCallback(e=>{if(h.current===void 0)return;const[o,n]=e,[i,s]=h.current.cell,f=h.current.range;let a=f.x,u=f.x+f.width,v=f.y,p=f.y+f.height;const[y,R]=Bo(s)??[0,$-1],C=R+1;if(n!==0)switch(n){case 2:{p=C,v=s,le(0,p,"vertical");break}case-2:{v=y,p=s+1,le(0,v,"vertical");break}case 1:{v<s?(v++,le(0,v,"vertical")):(p=Math.min(C,p+1),le(0,p,"vertical"));break}case-1:{p>s+1?(p--,le(0,p,"vertical")):(v=Math.max(y,v-1),le(0,v,"vertical"));break}default:kr()}if(o!==0)if(o===2)u=Z.length,a=i,le(u-1-d,0,"horizontal");else if(o===-2)a=d,u=i+1,le(a-d,0,"horizontal");else{let V=[];if(ve!==void 0){const D=ve({x:a,y:v,width:u-a-d,height:p-v},Ge.current.signal);typeof D=="object"&&(V=tc(D))}if(o===1){let D=!1;if(a<i){if(V.length>0){const N=Yt(a+1,i+1).find(G=>!V.includes(G-d));N!==void 0&&(a=N,D=!0)}else a++,D=!0;D&&le(a,0,"horizontal")}D||(u=Math.min(Z.length,u+1),le(u-1-d,0,"horizontal"))}else if(o===-1){let D=!1;if(u>i+1){if(V.length>0){const N=Yt(u-1,i,-1).find(G=>!V.includes(G-d));N!==void 0&&(u=N,D=!0)}else u--,D=!0;D&&le(u-d,0,"horizontal")}D||(a=Math.max(d,a-1),le(a-d,0,"horizontal"))}else kr()}pe({cell:h.current.cell,range:{x:a,y:v,width:u-a,height:p-v}},!0,!1,"keyboard-select")},[ve,Bo,h,Z.length,d,$,le,pe]),En=l.useRef(Wn);En.current=Wn;const mt=l.useCallback((e,o,n,i)=>{const s=ke-(n?0:1);e=At(e,d,Pe.length-1+d),o=At(o,0,s);const f=Ze==null?void 0:Ze[0],a=Ze==null?void 0:Ze[1];if(e===f&&o===a)return!1;if(i&&h.current!==void 0){const u=[...h.current.rangeStack];(h.current.range.width>1||h.current.range.height>1)&&u.push(h.current.range),Ke({...h,current:{cell:[e,o],range:{x:e,y:o,width:1,height:1},rangeStack:u}},!0)}else pe({cell:[e,o],range:{x:e,y:o,width:1,height:1}},!0,!1,"keyboard-nav");return m.current!==void 0&&m.current[0]===e&&m.current[1]===o&&(m.current=void 0),En.current&&le(e-d,o,"both",0,20),!0},[ke,d,Pe.length,Ze,h,le,Ke,pe]),uo=l.useCallback((e,o)=>{var v,p,y,R;const n=O.current,i=_.current;console.log("[onFinishEditing] isGhostMode:",i),console.log("[onFinishEditing] currentOverlay:",n),console.log("[onFinishEditing] ghostInputRef.current:",b.current),console.log("[onFinishEditing] ghostText:",(v=b.current)==null?void 0:v.getValue());let s=e;const f=((p=b.current)==null?void 0:p.getValue())??"";if(console.log("[onFinishEditing] ghostText from GhostInput:",f),(n==null?void 0:n.cell)!==void 0&&f.length>0&&n.content!==void 0){console.log("[onFinishEditing] Using ghostText from GhostInput");const C=n.content;if(console.log("[onFinishEditing] cellContent.kind:",C.kind),C.kind===Q.Text)s={...C,data:f,displayData:f};else if(C.kind===Q.Number){const V=Number.parseFloat(f),D=Number.isNaN(V)?0:V;s={...C,data:D,displayData:D.toLocaleString()}}else C.kind===Q.Uri?s={...C,data:f,displayData:f}:C.kind===Q.Markdown&&(s={...C,data:f})}if(s!==void 0&&f.length===0)if(s.kind===Q.Text&&s.data!==s.displayData)s={...s,displayData:s.data};else if(s.kind===Q.Number){const C=s.data!==void 0?s.data.toLocaleString():"0";s.displayData!==C&&(s={...s,displayData:C})}else s.kind===Q.Uri&&s.data!==s.displayData&&(s={...s,displayData:s.data});console.log("[onFinishEditing] finalValue:",s),console.log("[onFinishEditing] isEditableGridCell:",s!==void 0?$t(s):"N/A"),console.log("[onFinishEditing] condition check - cell:",n==null?void 0:n.cell,"finalValue:",s!==void 0,"isEditable:",s!==void 0&&$t(s)),(n==null?void 0:n.cell)!==void 0&&s!==void 0&&$t(s)&&(console.log("[onFinishEditing] CALLING mangledOnCellsEdited with:",{location:n.cell,value:s}),Ne([{location:n.cell,value:s}]),window.requestAnimationFrame(()=>{var C;(C=ae.current)==null||C.damage([{cell:n.cell}])})),(y=b.current)==null||y.clear(),(R=b.current)==null||R.setVisible(!1),W(!1),xe(!0),O.current=void 0,k(void 0);const[a,u]=o;if(h.current!==void 0&&(a!==0||u!==0)){const C=h.current.cell[1]===ke-1;if(C&&u===1){Fe==null||Fe(e,[0,0]);return}const V=h.current.cell[0]===Z.length-1&&e!==void 0;let D=!0;if(C&&u===1&&it!==void 0){D=!1;const N=h.current.cell[0]+a,G=Ot(N);ht(G??N,!1)}if(V&&a===1&&st!==void 0){D=!1;const N=h.current.cell[1]+u;Vo(N,!1)}if(D){const N=At(h.current.cell[0]+a,d,Z.length-1),G=At(h.current.cell[1]+u,0,ke-1);mt(N,G,C,!1),window.requestAnimationFrame(()=>{var T;(T=b.current)==null||T.focus()})}}Fe==null||Fe(e,o)},[xe,h,Fe,Ne,ke,mt,Z.length,ht,Vo,it,st,Ot,d]),Yl=l.useMemo(()=>`gdg-overlay-${ec++}`,[]),Lt=l.useCallback(e=>{var n,i,s,f;xe();const o=[];for(let a=e.x;a<e.x+e.width;a++)for(let u=e.y;u<e.y+e.height;u++){const v=te([a-d,u]);if(!v.allowOverlay&&v.kind!==Q.Boolean)continue;let p;if(v.kind===Q.Custom){const y=Me(v),R=(n=y==null?void 0:y.provideEditor)==null?void 0:n.call(y,{...v,location:[a-d,u]});(y==null?void 0:y.onDelete)!==void 0?p=y.onDelete(v):Di(R)&&(p=(i=R==null?void 0:R.deletedValue)==null?void 0:i.call(R,v))}else if($t(v)&&v.allowOverlay||v.kind===Q.Boolean){const y=Me(v);p=(s=y==null?void 0:y.onDelete)==null?void 0:s.call(y,v)}p!==void 0&&!Jo(p)&&$t(p)&&o.push({location:[a,u],value:p})}Ne(o),(f=ae.current)==null||f.damage(o.map(a=>({cell:a.location})))},[xe,te,Me,Ne,d]),fo=w!==void 0,fr=l.useCallback(e=>{var N,G,T;const o=()=>{e.stopPropagation(),e.preventDefault()},n={didMatch:!1},{bounds:i}=e,s=h.columns,f=h.rows,a=dt;if(!fo&&B(a.clear,e,n)){const E=((N=h.current)==null?void 0:N.cell)??[d,0];Ke({columns:oe.empty(),rows:oe.empty(),current:{cell:E,range:{x:E[0],y:E[1],width:1,height:1},rangeStack:[]}},!1),at==null||at(),xe()}else if(!fo&&B(a.selectAll,e,n))Ke({columns:oe.empty(),rows:oe.empty(),current:{cell:((G=h.current)==null?void 0:G.cell)??[d,0],range:{x:d,y:0,width:X.length,height:$},rangeStack:[]}},!1);else if(B(a.search,e,n))(T=I==null?void 0:I.current)==null||T.focus({preventScroll:!0}),Zn(!0);else if(B(a.delete,e,n)){const E=(ft==null?void 0:ft(h))??!0;if(E!==!1){const Y=E===!0?h:E;if(Y.current!==void 0){Lt(Y.current.range);for(const H of Y.current.rangeStack)Lt(H)}for(const H of Y.rows)Lt({x:d,y:H,width:X.length,height:1});for(const H of Y.columns)Lt({x:H,y:0,width:1,height:$})}}if(n.didMatch)return o(),!0;if(h.current===void 0)return!1;let[u,v]=h.current.cell;const[,p]=h.current.cell;let y=!1,R=!1;if(B(a.scrollToSelectedCell,e,n))Xo.current(u-d,v);else if(He!=="none"&&B(a.selectColumn,e,n))s.hasIndex(u)?he(s.remove(u),void 0,!0):He==="single"?he(oe.fromSingleSelection(u),void 0,!0):he(void 0,u,!0);else if($e!=="none"&&B(a.selectRow,e,n))f.hasIndex(v)?Re(f.remove(v),void 0,!0):$e==="single"?Re(oe.fromSingleSelection(v),void 0,!0):Re(void 0,v,!0);else if(!fo&&i!==void 0&&B(a.activateCell,e,n))if(v===$&&se)window.setTimeout(()=>{const E=Ot(u);ht(E??u)},0);else{const E={inputType:"keyboard",key:e.key};K==null||K([u-d,v],E),Be(i,E)}else h.current.range.height>1&&B(a.downFill,e,n)?ur():h.current.range.width>1&&B(a.rightFill,e,n)?ar():B(a.goToNextPage,e,n)?v+=Math.max(1,Ee.current.height-4):B(a.goToPreviousPage,e,n)?v-=Math.max(1,Ee.current.height-4):B(a.goToFirstCell,e,n)?(k(void 0),v=0,u=0):B(a.goToLastCell,e,n)?(k(void 0),v=Number.MAX_SAFE_INTEGER,u=Number.MAX_SAFE_INTEGER):B(a.selectToFirstCell,e,n)?(k(void 0),_e([-2,-2])):B(a.selectToLastCell,e,n)?(k(void 0),_e([2,2])):fo?(B(a.closeOverlay,e,n)&&k(void 0),B(a.acceptOverlayDown,e,n)&&(k(void 0),v++),B(a.acceptOverlayUp,e,n)&&(k(void 0),v--),B(a.acceptOverlayLeft,e,n)&&(k(void 0),u--),B(a.acceptOverlayRight,e,n)&&(k(void 0),u++)):(B(a.goDownCell,e,n)?v+=1:B(a.goUpCell,e,n)?v-=1:B(a.goRightCell,e,n)?u+=1:B(a.goLeftCell,e,n)?u-=1:B(a.goDownCellRetainSelection,e,n)?(v+=1,y=!0):B(a.goUpCellRetainSelection,e,n)?(v-=1,y=!0):B(a.goRightCellRetainSelection,e,n)?(u+=1,y=!0):B(a.goLeftCellRetainSelection,e,n)?(u-=1,y=!0):B(a.goToLastRow,e,n)?v=$-1:B(a.goToFirstRow,e,n)?v=Number.MIN_SAFE_INTEGER:B(a.goToLastColumn,e,n)?u=Number.MAX_SAFE_INTEGER:B(a.goToFirstColumn,e,n)?u=Number.MIN_SAFE_INTEGER:(kt==="rect"||kt==="multi-rect")&&(B(a.selectGrowDown,e,n)?_e([0,1]):B(a.selectGrowUp,e,n)?_e([0,-1]):B(a.selectGrowRight,e,n)?_e([1,0]):B(a.selectGrowLeft,e,n)?_e([-1,0]):B(a.selectToLastRow,e,n)?_e([0,2]):B(a.selectToFirstRow,e,n)?_e([0,-2]):B(a.selectToLastColumn,e,n)?_e([2,0]):B(a.selectToFirstColumn,e,n)&&_e([-2,0])),R=n.didMatch);if(Ue!==void 0&&Ue!=="normal"&&v!==p){const E=Ue==="skip-up"||Ue==="skip"||Ue==="block",Y=Ue==="skip-down"||Ue==="skip"||Ue==="block",H=v<p;if(H&&E){for(;v>=0&&zt(v).isGroupHeader;)v--;v<0&&(v=p)}else if(!H&&Y){for(;v<$&&zt(v).isGroupHeader;)v++;v>=$&&(v=p)}}const V=mt(u,v,!1,y),D=n.didMatch;return D&&(V||!R||Pn)&&o(),D},[Ue,fo,h,dt,He,$e,kt,d,zt,$,mt,Ke,at,X.length,ft,Pn,Lt,he,Re,se,Ot,ht,K,Be,ur,ar,_e]),Dt=l.useCallback(e=>{let o=!1;if(qt!==void 0&&qt({...e,...e.location&&{location:[e.location[0]-d,e.location[1]]},cancel:()=>{o=!0}}),o||fr(e)||h.current===void 0)return;const[n,i]=h.current.cell,s=Ee.current,f=e.keyCode===229,a=Zt&&!e.metaKey&&!e.ctrlKey&&e.key.length===1&&/[\p{L}\p{M}\p{N}\p{S}\p{P}]/u.test(e.key);if((f||a)&&e.bounds!==void 0&&Ft(te([n-d,Math.max(0,Math.min(i,$-1))]))){if((!se||i!==$)&&(s.y>i||i>s.y+s.height||s.x>n||n>s.x+s.width))return;if(e.stopPropagation(),e.preventDefault(),f){const u={inputType:"keyboard",key:""};K==null||K([n-d,i],u),Be(e.bounds,u,"")}else{const u={inputType:"keyboard",key:e.key};K==null||K([n-d,i],u),Be(e.bounds,u,e.key)}}},[Zt,qt,fr,h,te,d,$,se,K,Be]),ql=l.useCallback((e,o)=>{var n;if(console.log("[onGhostInput] value:",e,"composing:",o,"overlay:",O.current!==void 0),O.current!==void 0){console.log("[onGhostInput] overlay already open, returning");return}if(!o&&e.length>0&&h.current!==void 0){const[i,s]=h.current.cell,f=Ce([i,s]);if(f.allowOverlay&&Ft(f)&&f.readonly!==!0){const a=(n=ae.current)==null?void 0:n.getBounds(i,s);if(a!==void 0){const u={inputType:"keyboard",key:e};K==null||K([i-d,s],u),Be(a,u,e)}}}},[h,Ce,d,K,Be]),Zl=l.useCallback(()=>{var i,s,f,a,u;if(console.log("[onGhostCompositionStart] called"),console.log("[onGhostCompositionStart] gridSelection.current:",h.current),console.log("[onGhostCompositionStart] overlayRef.current:",O.current),h.current===void 0)return;const[e,o]=h.current.cell,n=(i=O.current)==null?void 0:i.cell;if(n!==void 0&&(n[0]!==e||n[1]!==o)&&(console.log("[onGhostCompositionStart] Different cell detected, closing previous overlay"),(s=b.current)==null||s.clear(),(f=b.current)==null||f.setVisible(!1),W(!1),O.current=void 0,k(void 0)),O.current===void 0){const v=Ce([e,o]);if(v.allowOverlay&&Ft(v)&&v.readonly!==!0){const p=(a=ae.current)==null?void 0:a.getBounds(e,o);if(p!==void 0){(u=b.current)==null||u.clear();const y={inputType:"keyboard",key:""};K==null||K([e-d,o],y),Be(p,y,"")}}}},[h,Ce,d,K,Be]),Jl=l.useCallback(e=>{},[]),Ql=l.useCallback(e=>{var f,a;if(console.log("[onGhostKeyDown] key:",e.key,"isComposing:",e.nativeEvent.isComposing),e.nativeEvent.isComposing){console.log("[onGhostKeyDown] IGNORED due to isComposing");return}if(O.current!==void 0&&_.current){const u=e.key;if(u==="Escape"){e.preventDefault(),e.stopPropagation(),uo(void 0,[0,0]);return}if(u==="Enter"&&!e.shiftKey){e.preventDefault(),e.stopPropagation(),uo(void 0,[0,1]);return}if(u==="Tab"){e.preventDefault(),e.stopPropagation(),uo(void 0,e.shiftKey?[-1,0]:[1,0]);return}}if(e.key.length===1&&!e.ctrlKey&&!e.metaKey&&!e.altKey)return;if(O.current!==void 0&&_.current){const u=e.key;if(u==="Backspace"||u==="Delete"||(u==="ArrowLeft"||u==="ArrowRight"||u==="ArrowUp"||u==="ArrowDown"||u==="Home"||u==="End"))return}const o=(f=h.current)==null?void 0:f.cell,n=o!==void 0?(a=ae.current)==null?void 0:a.getBounds(o[0],o[1]):void 0;let i=!1;const s={bounds:n,cancel:()=>{i=!0},stopPropagation:()=>e.stopPropagation(),preventDefault:()=>e.preventDefault(),ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,altKey:e.altKey,key:e.key,keyCode:e.keyCode,rawEvent:e,location:o};Dt(s),i&&(e.preventDefault(),e.stopPropagation())},[h,Dt,uo]),jl=l.useCallback(e=>{var s,f;const o=(s=h.current)==null?void 0:s.cell,i={bounds:o!==void 0?(f=ae.current)==null?void 0:f.getBounds(o[0],o[1]):void 0,cancel:()=>{},stopPropagation:()=>e.stopPropagation(),preventDefault:()=>e.preventDefault(),ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,altKey:e.altKey,key:e.key,keyCode:e.keyCode,rawEvent:e,location:o};bt==null||bt(i)},[h,bt]),ei=l.useCallback(()=>{zn(!0)},[]),ti=l.useCallback(()=>{zn(!1)},[]),oi=l.useCallback((e,o)=>{const n=e.location[0]-d;if(e.kind==="header"&&(ye==null||ye(n,{...e,preventDefault:o})),e.kind===Xt){if(n<0)return;Se==null||Se(n,{...e,preventDefault:o})}if(e.kind==="cell"){const[i,s]=e.location;re==null||re([n,s],{...e,preventDefault:o}),Hi(h,e.location)||mt(i,s,!1,!1)}},[h,re,Se,ye,d,mt]),Tn=l.useCallback(async e=>{var a,u,v;if(!dt.paste)return;function o(p,y,R,C){var D,N;const V=typeof R=="object"?(R==null?void 0:R.join(`
`))??"":(R==null?void 0:R.toString())??"";if(!Jo(p)&&Ft(p)&&p.readonly!==!0){const G=Ie==null?void 0:Ie(V,p);if(G!==void 0&&$t(G))return{location:y,value:G};const T=Me(p);if(T===void 0)return;if(T.kind===Q.Custom){jo(p.kind===Q.Custom);const E=(D=T.onPaste)==null?void 0:D.call(T,V,p.data);return E===void 0?void 0:{location:y,value:{...p,data:E}}}else{const E=(N=T.onPaste)==null?void 0:N.call(T,V,p,{formatted:C,formattedString:typeof C=="string"?C:C==null?void 0:C.join(`
`),rawValue:R});return E===void 0?void 0:(jo(E.kind===p.kind),{location:y,value:E})}}}const n=h.columns,i=h.rows,s=((a=ee.current)==null?void 0:a.contains(document.activeElement))===!0||((u=x.current)==null?void 0:u.contains(document.activeElement))===!0;let f;if(h.current!==void 0?f=[h.current.range.x,h.current.range.y]:n.length===1?f=[n.first()??0,0]:i.length===1&&(f=[d,i.first()??0]),s&&f!==void 0){let p,y;const R="text/plain",C="text/html";if(navigator.clipboard.read!==void 0){const G=await navigator.clipboard.read();for(const T of G){if(T.types.includes(C)){const Y=await(await T.getType(C)).text(),H=Rr(Y);if(H!==void 0){p=H;break}}T.types.includes(R)&&(y=await(await T.getType(R)).text())}}else if(navigator.clipboard.readText!==void 0)y=await navigator.clipboard.readText();else if(e!==void 0&&(e==null?void 0:e.clipboardData)!==null){if(e.clipboardData.types.includes(C)){const G=e.clipboardData.getData(C);p=Rr(G)}p===void 0&&e.clipboardData.types.includes(R)&&(y=e.clipboardData.getData(R))}else return;const[V,D]=f,N=[];do{if(Rt===void 0){const G=Ce(f),T=y??(p==null?void 0:p.map(Y=>Y.map(H=>H.rawValue).join("	")).join("	"))??"",E=o(G,f,T,void 0);E!==void 0&&N.push(E);break}if(p===void 0){if(y===void 0)return;p=Fi(y)}if(Rt===!1||typeof Rt=="function"&&(Rt==null?void 0:Rt([f[0]-d,f[1]],p.map(G=>G.map(T=>{var E;return((E=T.rawValue)==null?void 0:E.toString())??""}))))!==!0)return;for(const[G,T]of p.entries()){if(G+D>=$)break;for(const[E,Y]of T.entries()){const H=[E+V,G+D],[ue,Te]=H;if(ue>=Z.length||Te>=ke)continue;const ze=Ce(H),Ve=o(ze,H,Y.rawValue,Y.formatted);Ve!==void 0&&N.push(Ve)}}}while(!1);Ne(N),(v=ae.current)==null||v.damage(N.map(G=>({cell:G.location})))}},[Ie,Me,Ce,h,dt.paste,ee,Z.length,Ne,ke,Rt,d,$]);Dn("paste",Tn,ce,!1,!0);const ho=l.useCallback(async(e,o)=>{var a,u;if(!dt.copy)return;const n=o===!0||((a=ee.current)==null?void 0:a.contains(document.activeElement))===!0||((u=x.current)==null?void 0:u.contains(document.activeElement))===!0,i=h.columns,s=h.rows,f=(v,p)=>{if(!Gn)Mr(v,p,e);else{const y=p.map(R=>({kind:Q.Text,data:X[R].title,displayData:X[R].title,allowOverlay:!1}));Mr([y,...v],p,e)}};if(n&&ve!==void 0){if(h.current!==void 0){let v=ve(h.current.range,Ge.current.signal);typeof v!="object"&&(v=await v()),f(v,Yt(h.current.range.x-d,h.current.range.x+h.current.range.width-d))}else if(s!==void 0&&s.length>0){const p=[...s].map(y=>{const R=ve({x:d,y,width:X.length,height:1},Ge.current.signal);return typeof R=="object"?R[0]:R().then(C=>C[0])});if(p.some(y=>y instanceof Promise)){const y=await Promise.all(p);f(y,Yt(X.length))}else f(p,Yt(X.length))}else if(i.length>0){const v=[],p=[];for(const y of i){let R=ve({x:y,y:0,width:1,height:$},Ge.current.signal);typeof R!="object"&&(R=await R()),v.push(R),p.push(y-d)}if(v.length===1)f(v[0],p);else{const y=v.reduce((R,C)=>R.map((V,D)=>[...V,...C[D]]));f(y,p)}}}},[X,ve,h,dt.copy,d,ee,$,Gn]);Dn("copy",ho,ce,!1,!1);const ni=l.useCallback(async e=>{var n,i;if(!(!dt.cut||!(((n=ee.current)==null?void 0:n.contains(document.activeElement))===!0||((i=x.current)==null?void 0:i.contains(document.activeElement))===!0))&&(await ho(e),h.current!==void 0)){let s={current:{cell:h.current.cell,range:h.current.range,rangeStack:[]},rows:oe.empty(),columns:oe.empty()};const f=ft==null?void 0:ft(s);if(f===!1||(s=f===!0?s:f,s.current===void 0))return;Lt(s.current.range)}},[Lt,h,dt.cut,ho,ee,ft]);Dn("cut",ni,ce,!1,!1);const ri=l.useCallback((e,o)=>{if(je!==void 0){d!==0&&(e=e.map(s=>[s[0]-d,s[1]])),je(e,o);return}if(e.length===0||o===-1)return;const[n,i]=e[o];m.current!==void 0&&m.current[0]===n&&m.current[1]===i||(m.current=[n,i],mt(n,i,!1,!1))},[je,d,mt]),[Uo,_o]=((wr=Mt==null?void 0:Mt.current)==null?void 0:wr.cell)??[],Xo=l.useRef(le);Xo.current=le,l.useLayoutEffect(()=>{var e,o,n,i;En.current&&!Ao.current&&Uo!==void 0&&_o!==void 0&&(Uo!==((o=(e=$o.current)==null?void 0:e.current)==null?void 0:o.cell[0])||_o!==((i=(n=$o.current)==null?void 0:n.current)==null?void 0:i.cell[1]))&&Xo.current(Uo,_o),Ao.current=!1},[Uo,_o]);const hr=h.current!==void 0&&(h.current.cell[0]>=Z.length||h.current.cell[1]>=ke);l.useLayoutEffect(()=>{hr&&Ke(Hn,!1)},[hr,Ke]);const li=l.useMemo(()=>se===!0&&(j==null?void 0:j.tint)===!0?oe.fromSingleSelection(ke-1):oe.empty(),[ke,se,j==null?void 0:j.tint]),ii=l.useCallback(e=>typeof Kt=="boolean"?Kt:(Kt==null?void 0:Kt(e-d))??!0,[d,Kt]),si=l.useMemo(()=>{if(bn===void 0||x.current===null)return null;const{bounds:e,group:o}=bn,n=x.current.getBoundingClientRect();return l.createElement(Is,{bounds:e,group:o,canvasBounds:n,onClose:()=>xn(void 0),onFinish:i=>{xn(void 0),Qe==null||Qe(o,i)}})},[Qe,bn]),ci=Math.min(Z.length,et+d);l.useImperativeHandle(r,()=>({appendRow:(e,o)=>ht(e+d,o),appendColumn:(e,o)=>Vo(e,o),updateCells:e=>{var o;return d!==0&&(e=e.map(n=>({cell:[n.cell[0]+d,n.cell[1]]}))),(o=ae.current)==null?void 0:o.damage(e)},getBounds:(e,o)=>{var n;if(!((x==null?void 0:x.current)===null||(ee==null?void 0:ee.current)===null)){if(e===void 0&&o===void 0){const i=x.current.getBoundingClientRect(),s=i.width/ee.current.clientWidth;return{x:i.x-ee.current.scrollLeft*s,y:i.y-ee.current.scrollTop*s,width:ee.current.scrollWidth*s,height:ee.current.scrollHeight*s}}return(n=ae.current)==null?void 0:n.getBounds((e??0)+d,o)}},focus:()=>{var e;return(e=ae.current)==null?void 0:e.focus()},emit:async e=>{switch(e){case"delete":Dt({bounds:void 0,cancel:()=>{},stopPropagation:()=>{},preventDefault:()=>{},ctrlKey:!1,key:"Delete",keyCode:46,metaKey:!1,shiftKey:!1,altKey:!1,rawEvent:void 0,location:void 0});break;case"fill-right":Dt({bounds:void 0,cancel:()=>{},stopPropagation:()=>{},preventDefault:()=>{},ctrlKey:!0,key:"r",keyCode:82,metaKey:!1,shiftKey:!1,altKey:!1,rawEvent:void 0,location:void 0});break;case"fill-down":Dt({bounds:void 0,cancel:()=>{},stopPropagation:()=>{},preventDefault:()=>{},ctrlKey:!0,key:"d",keyCode:68,metaKey:!1,shiftKey:!1,altKey:!1,rawEvent:void 0,location:void 0});break;case"copy":await ho(void 0,!0);break;case"paste":await Tn();break}},scrollTo:le,remeasureColumns:e=>{for(const o of e)Oo(o+d)},getMouseArgsForPosition:(e,o,n)=>{if((ae==null?void 0:ae.current)===null)return;const i=ae.current.getMouseArgsForPosition(e,o,n);if(i!==void 0)return{...i,location:[i.location[0]-d,i.location[1]]}}}),[ht,Vo,Oo,ee,ho,Dt,Tn,d,le]);const[gr,mr]=Ze??[],ai=l.useCallback(e=>{const[o,n]=e;if(n===-1){He!=="none"&&(he(oe.fromSingleSelection(o),void 0,!1),xe());return}gr===o&&mr===n||(pe({cell:e,range:{x:o,y:n,width:1,height:1}},!0,!1,"keyboard-nav"),le(o,n))},[He,xe,le,gr,mr,pe,he]),[ui,zn]=l.useState(!1),vr=l.useRef(Vi(e=>{zn(e)},5)),di=l.useCallback(()=>{vr.current(!0),h.current===void 0&&h.columns.length===0&&h.rows.length===0&&M===void 0&&pe({cell:[d,Go],range:{x:d,y:Go,width:1,height:1}},!0,!1,"keyboard-select")},[Go,h,M,d,pe]),fi=l.useCallback(()=>{vr.current(!1)},[]),[hi,gi]=l.useMemo(()=>{let e;const o=(fe==null?void 0:fe.scrollbarWidthOverride)??$i(),n=$+(se?1:0);if(typeof ut=="number")e=io+n*ut;else{let s=0;const f=Math.min(n,10);for(let a=0;a<f;a++)s+=ut(a);s=Math.floor(s/f),e=io+n*s}e+=o;const i=Z.reduce((s,f)=>f.width+s,0)+o;return[`${Math.min(1e5,i)}px`,`${Math.min(1e5,e)}px`]},[Z,fe==null?void 0:fe.scrollbarWidthOverride,ut,$,se,io]),mi=l.useMemo(()=>Ai(be),[be]);return l.createElement(Gi.Provider,{value:be},l.createElement(Ps,{style:mi,className:we,inWidth:J??hi,inHeight:de??gi},l.createElement(Es,{fillHandle:Xr,drawFocusRing:On,experimental:fe,fixedShadowX:Yr,fixedShadowY:qr,getRowThemeOverride:nt,headerIcons:Zr,imageWindowLoader:Jr,initialSize:Qr,isDraggable:jr,onDragLeave:el,onRowMoved:to,overscrollX:bl,overscrollY:xl,preventDiagonalScrolling:nl,rightElement:rl,rightElementProps:ll,smoothScrollX:il,smoothScrollY:sl,className:we,enableGroups:jn,onCanvasFocused:di,onCanvasBlur:fi,canvasRef:x,onContextMenu:oi,theme:be,cellXOffset:Fl,cellYOffset:Go,accessibilityHeight:Et.height,onDragEnd:_l,columns:Z,nonGrowWidth:Qn,drawHeader:Il,onColumnProposeMove:Ol,drawCell:Ll,disabledRows:li,freezeColumns:ci,lockColumns:d,firstColAccessible:d===0,getCellContent:Ce,minColumnWidth:Nt,maxColumnWidth:Fo,searchInputRef:I,showSearch:Rl,onSearchClose:Ml,highlightRegions:$l,getCellsForSelection:ve,getGroupDetails:pn,headerHeight:Yn,isFocused:ui,groupHeaderHeight:jn?gn:0,groupLevels:lo,groupHeaderHeights:er,freezeTrailingRows:tt+(se&&(j==null?void 0:j.sticky)===!0?1:0),hasAppendRow:se,onColumnResize:Wt,onColumnResizeEnd:Tl,onColumnResizeStart:zl,onCellFocused:ai,onColumnMoved:Bl,onDragStart:Ul,onHeaderMenuClick:Nl,onHeaderIndicatorClick:Wl,onItemHovered:Sn,isFilling:(M==null?void 0:M.fillHandle)===!0,onMouseMove:Pl,onKeyDown:Dt,onKeyUp:bt,onMouseDown:Al,onMouseUp:Kl,onDragOverCell:Ur,onDrop:_r,onSearchResultsChanged:ri,onVisibleRegionChanged:Vl,clientSize:mn,rowHeight:ut,searchResults:vo,searchValue:po,onSearchValueChange:on,rows:ke,scrollRef:ee,selection:h,translateX:Et.tx,translateY:Et.ty,verticalBorder:ii,gridRef:ae,getCellRenderer:Me,resizeIndicator:hl}),si,w!==void 0&&l.createElement(l.Suspense,{fallback:null},l.createElement(js,{...w,validateCell:El,bloom:Gt,id:Yl,getCellRenderer:Me,className:(fe==null?void 0:fe.isSubGrid)===!0?"click-outside-ignore":void 0,provideEditor:Vr,imageEditorOverride:me,portalElementRef:Eo,onFinishEditing:uo,markdownDivCreateNode:z,isOutsideClick:fl,customEventTarget:fe==null?void 0:fe.eventTarget,isGhostMode:S}))),(()=>{const e=(Eo==null?void 0:Eo.current)??document.getElementById("portal");return e===null?null:pi.createPortal(l.createElement(Qs,{ref:b,onInput:ql,onCompositionStart:Zl,onCompositionEnd:Jl,onKeyDown:Ql,onKeyUp:jl,onFocus:ei,onBlur:ti}),e)})())},nc=l.forwardRef(oc),rc=(t,r)=>{const c=l.useMemo(()=>({...bs,...t.headerIcons}),[t.headerIcons]),g=l.useMemo(()=>t.renderers??Ni,[t.renderers]),w=l.useMemo(()=>t.imageWindowLoader??new Wi,[t.imageWindowLoader]);return l.createElement(nc,{...t,renderers:g,headerIcons:c,ref:r,imageWindowLoader:w})},gc=l.forwardRef(rc);export{gc as D,vt as k,Xs as u};
