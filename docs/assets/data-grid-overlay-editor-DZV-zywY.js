import{r as t}from"./iframe-Czk7Ezmu.js";import{r as ne}from"./index-CxYjbY7H.js";import{h as H,G as w,k as ie,l as se,T as ae,C as oe,n as de}from"./data-editor-all-B2dKqFWA.js";import{s as le}from"./marked.esm-x-GbY7TD.js";import"./preload-helper-C1FmrZbK.js";import"./throttle-DLfHZc2H.js";import"./flatten-D5dxJWzP.js";const ue=()=>r=>r.targetX,ce=()=>r=>r.targetY,fe=()=>r=>r.targetWidth,me=()=>r=>r.targetHeight,ge=()=>r=>r.targetY+10,pe=()=>r=>Math.max(0,(r.targetHeight-28)/2),he=le("div")({name:"DataGridOverlayEditorStyle",class:"gdg-d19meir1",propsAsIs:!1,vars:{"d19meir1-0":[ce(),"px"],"d19meir1-1":[ue(),"px"],"d19meir1-2":[fe(),"px"],"d19meir1-3":[me(),"px"],"d19meir1-4":[ge(),"px"],"d19meir1-5":[pe(),"px"]}});function Ee(){const[r,s]=t.useState();return[r??void 0,s]}function ye(){const[r,s]=Ee(),[i,y]=t.useState(0),[p,S]=t.useState(!0);t.useLayoutEffect(()=>{if(r===void 0||!("IntersectionObserver"in window))return;const a=new IntersectionObserver(d=>{d.length!==0&&S(d[0].isIntersecting)},{threshold:1});return a.observe(r),()=>a.disconnect()},[r]),t.useEffect(()=>{if(p||r===void 0)return;let a;const d=()=>{const{right:T}=r.getBoundingClientRect();y(h=>Math.min(h+window.innerWidth-T-10,0)),a=requestAnimationFrame(d)};return a=requestAnimationFrame(d),()=>{a!==void 0&&cancelAnimationFrame(a)}},[r,p]);const R=t.useMemo(()=>({transform:`translateX(${i}px)`}),[i]);return{ref:s,style:R}}const Re=r=>{const{target:s,content:i,onFinishEditing:y,forceEditMode:p,initialValue:S,imageEditorOverride:R,markdownDivCreateNode:a,highlight:d,className:T,theme:h,id:q,cell:E,bloom:c,portalElementRef:C,validateCell:l,getCellRenderer:_,provideEditor:x,isOutsideClick:B,customEventTarget:V,activation:I}=r,[o,$]=t.useState(p?i:void 0),D=t.useRef(o??i);D.current=o??i;const[v,M]=t.useState(()=>l===void 0?!0:!(H(i)&&(l==null?void 0:l(E,i,D.current))===!1)),f=t.useCallback((e,n)=>{y(v?e:void 0,n)},[v,y]),F=t.useCallback(e=>{if((e==null?void 0:e.kind)===w.Text&&(N.current=e.data),l!==void 0&&e!==void 0&&H(e)){const n=l(E,e,D.current);n===!1?M(!1):(typeof n=="object"&&(e=n),M(!0))}$(e)},[E,l]),b=t.useRef(!1),m=t.useRef(void 0),k=t.useRef(!1),N=t.useRef(""),z=t.useCallback(()=>{f(o,[0,0]),b.current=!0},[o,f]),J=t.useCallback((e,n)=>{f(e,n??m.current??[0,0]),b.current=!0},[f]),Q=t.useCallback(async e=>{let n=!1;e.nativeEvent.isComposing||k.current||(e.key==="Escape"?(e.stopPropagation(),e.preventDefault(),m.current=[0,0]):e.key==="Enter"&&!e.shiftKey?(e.stopPropagation(),e.preventDefault(),m.current=[0,1],n=!0):e.key==="Tab"&&(e.stopPropagation(),e.preventDefault(),m.current=[e.shiftKey?-1:1,0],n=!0),m.current!==void 0&&window.setTimeout(()=>{b.current||(f(n?o:void 0,m.current??[0,0]),b.current=!0)},0))},[f,o]),U=t.useCallback(()=>{k.current=!0},[]),Z=t.useCallback(e=>{if(k.current=!1,e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement){N.current=e.target.value;const n=o??i;if(n.kind===w.Text){const g={...n,data:e.target.value};F(g)}}setTimeout(()=>{k.current=!1},10)},[o,i,F]),P=o??i,[u,ee]=t.useMemo(()=>{var g,j;if(ie(i))return[];const e={...i,location:E,activation:I},n=x==null?void 0:x(e);return n!==void 0?[n,!1]:[(j=(g=_(i))==null?void 0:g.provideEditor)==null?void 0:j.call(g,e),!1]},[E,i,_,x,I]),{ref:te,style:re}=ye();let A=!0,K,L=!0,O;if(u!==void 0){A=u.disablePadding!==!0,L=u.disableStyling!==!0;const e=se(u);e&&(O=u.styleOverride);const n=e?u.editor:u;K=t.createElement(n,{portalElementRef:C,isHighlighted:d,activation:I,onChange:F,value:P,initialValue:S,onFinishedEditing:J,validatedSelection:H(P)?P.selectionRange:void 0,forceEditMode:p,target:s,imageEditorOverride:R,markdownDivCreateNode:a,isValid:v,theme:h})}O={...O,...re};const W=(C==null?void 0:C.current)??document.getElementById("portal");if(W===null)return console.error('Cannot open Data Grid overlay editor, because portal not found. Please, either provide a portalElementRef or add `<div id="portal" />` as the last child of your `<body>`.'),null;let G=L?"gdg-style":"gdg-unstyle";v||(G+=" gdg-invalid"),A&&(G+=" gdg-pad");const X=(c==null?void 0:c[0])??1,Y=(c==null?void 0:c[1])??1;return ne.createPortal(t.createElement(ae.Provider,{value:h},t.createElement(oe,{style:de(h),className:T,onClickOutside:z,isOutsideClick:B,customEventTarget:V},t.createElement(he,{ref:te,id:q,className:G,style:O,as:ee===!0?"label":void 0,targetX:s.x-X,targetY:s.y-Y,targetWidth:s.width+X*2,targetHeight:s.height+Y*2},t.createElement("div",{className:"gdg-clip-region",onKeyDown:Q,onCompositionStart:U,onCompositionEnd:Z},K)))),W)};export{Re as default};
